{"remainingRequest":"D:\\work\\eui\\node_modules\\babel-loader\\lib\\index.js??ref--4-1!D:\\work\\eui\\src\\components\\search_bar\\query\\ast.ts","dependencies":[{"path":"D:\\work\\eui\\src\\components\\search_bar\\query\\ast.ts","mtime":1649070093748},{"path":"D:\\work\\eui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1636976621750},{"path":"D:\\work\\eui\\node_modules\\babel-loader\\lib\\index.js","mtime":1649070120649}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZvci1lYWNoIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucmVkdWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc29tZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5mcmVlemUiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC52YWx1ZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5tYXRjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2giOwoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pOyBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpZiAoaSAlIDIpIHsgb3duS2V5cyhPYmplY3Qoc291cmNlKSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KTsgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgeyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOyB9IGVsc2UgeyBvd25LZXlzKE9iamVjdChzb3VyY2UpKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IH0gcmV0dXJuIHRhcmdldDsgfQoKZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgeyByZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZCgpOyB9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQoKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpOyB9CgpmdW5jdGlvbiBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobywgbWluTGVuKSB7IGlmICghbykgcmV0dXJuOyBpZiAodHlwZW9mIG8gPT09ICJzdHJpbmciKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTsgdmFyIG4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpOyBpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTsgaWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKSByZXR1cm4gQXJyYXkuZnJvbShvKTsgaWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTsgfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7IGlmICh0eXBlb2YgU3ltYm9sICE9PSAidW5kZWZpbmVkIiAmJiBTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGl0ZXIpKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTsgfQoKZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikgeyBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkoYXJyKTsgfQoKZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4pIHsgaWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykgeyBhcnIyW2ldID0gYXJyW2ldOyB9IHJldHVybiBhcnIyOyB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9CgpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgeyBpZiAoa2V5IGluIG9iaikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOyB9IGVsc2UgeyBvYmpba2V5XSA9IHZhbHVlOyB9IHJldHVybiBvYmo7IH0KCi8qCiAqIExpY2Vuc2VkIHRvIEVsYXN0aWNzZWFyY2ggQi5WLiB1bmRlciBvbmUgb3IgbW9yZSBjb250cmlidXRvcgogKiBsaWNlbnNlIGFncmVlbWVudHMuIFNlZSB0aGUgTk9USUNFIGZpbGUgZGlzdHJpYnV0ZWQgd2l0aAogKiB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24gcmVnYXJkaW5nIGNvcHlyaWdodAogKiBvd25lcnNoaXAuIEVsYXN0aWNzZWFyY2ggQi5WLiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyCiAqIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOyB5b3UgbWF5CiAqIG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwppbXBvcnQgeyBpc0FycmF5LCBpc05pbCB9IGZyb20gJy4uLy4uLy4uL3NlcnZpY2VzL3ByZWRpY2F0ZSc7CmltcG9ydCB7IGRhdGVWYWx1ZXNFcXVhbCwgaXNEYXRlVmFsdWUgfSBmcm9tICcuL2RhdGVfdmFsdWUnOwpleHBvcnQgdmFyIE1hdGNoID0gT2JqZWN0LmZyZWV6ZSh7CiAgTVVTVDogJ211c3QnLAogIE1VU1RfTk9UOiAnbXVzdF9ub3QnLAogIGlzTXVzdDogZnVuY3Rpb24gaXNNdXN0KG1hdGNoKSB7CiAgICByZXR1cm4gbWF0Y2ggPT09IE1hdGNoLk1VU1Q7CiAgfSwKICBpc011c3RDbGF1c2U6IGZ1bmN0aW9uIGlzTXVzdENsYXVzZShjbGF1c2UpIHsKICAgIHJldHVybiBNYXRjaC5pc011c3QoY2xhdXNlLm1hdGNoKTsKICB9Cn0pOwpleHBvcnQgdmFyIE9wZXJhdG9yID0gT2JqZWN0LmZyZWV6ZSh7CiAgRVE6ICdlcScsCiAgRVhBQ1Q6ICdleGFjdCcsCiAgR1Q6ICdndCcsCiAgR1RFOiAnZ3RlJywKICBMVDogJ2x0JywKICBMVEU6ICdsdGUnLAogIGlzRVE6IGZ1bmN0aW9uIGlzRVEobWF0Y2gpIHsKICAgIHJldHVybiBtYXRjaCA9PT0gT3BlcmF0b3IuRVE7CiAgfSwKICBpc0VRQ2xhdXNlOiBmdW5jdGlvbiBpc0VRQ2xhdXNlKGNsYXVzZSkgewogICAgcmV0dXJuIEZpZWxkLmlzSW5zdGFuY2UoY2xhdXNlKSAmJiBPcGVyYXRvci5pc0VRKGNsYXVzZS5vcGVyYXRvcik7CiAgfSwKICBpc0VYQUNUOiBmdW5jdGlvbiBpc0VYQUNUKG1hdGNoKSB7CiAgICByZXR1cm4gbWF0Y2ggPT09IE9wZXJhdG9yLkVYQUNUOwogIH0sCiAgaXNFWEFDVENsYXVzZTogZnVuY3Rpb24gaXNFWEFDVENsYXVzZShjbGF1c2UpIHsKICAgIHJldHVybiBGaWVsZC5pc0luc3RhbmNlKGNsYXVzZSkgJiYgT3BlcmF0b3IuaXNFWEFDVChjbGF1c2Uub3BlcmF0b3IpOwogIH0sCiAgaXNSYW5nZTogZnVuY3Rpb24gaXNSYW5nZShtYXRjaCkgewogICAgcmV0dXJuIE9wZXJhdG9yLmlzR1QobWF0Y2gpIHx8IE9wZXJhdG9yLmlzR1RFKG1hdGNoKSB8fCBPcGVyYXRvci5pc0xUKG1hdGNoKSB8fCBPcGVyYXRvci5pc0xURShtYXRjaCk7CiAgfSwKICBpc1JhbmdlQ2xhdXNlOiBmdW5jdGlvbiBpc1JhbmdlQ2xhdXNlKGNsYXVzZSkgewogICAgcmV0dXJuIEZpZWxkLmlzSW5zdGFuY2UoY2xhdXNlKSAmJiBPcGVyYXRvci5pc1JhbmdlKGNsYXVzZS5vcGVyYXRvcik7CiAgfSwKICBpc0dUOiBmdW5jdGlvbiBpc0dUKG1hdGNoKSB7CiAgICByZXR1cm4gbWF0Y2ggPT09IE9wZXJhdG9yLkdUOwogIH0sCiAgaXNHVENsYXVzZTogZnVuY3Rpb24gaXNHVENsYXVzZShjbGF1c2UpIHsKICAgIHJldHVybiBGaWVsZC5pc0luc3RhbmNlKGNsYXVzZSkgJiYgT3BlcmF0b3IuaXNHVChjbGF1c2Uub3BlcmF0b3IpOwogIH0sCiAgaXNHVEU6IGZ1bmN0aW9uIGlzR1RFKG1hdGNoKSB7CiAgICByZXR1cm4gbWF0Y2ggPT09IE9wZXJhdG9yLkdURTsKICB9LAogIGlzR1RFQ2xhdXNlOiBmdW5jdGlvbiBpc0dURUNsYXVzZShjbGF1c2UpIHsKICAgIHJldHVybiBGaWVsZC5pc0luc3RhbmNlKGNsYXVzZSkgJiYgT3BlcmF0b3IuaXNHVEUoY2xhdXNlLm9wZXJhdG9yKTsKICB9LAogIGlzTFQ6IGZ1bmN0aW9uIGlzTFQobWF0Y2gpIHsKICAgIHJldHVybiBtYXRjaCA9PT0gT3BlcmF0b3IuTFQ7CiAgfSwKICBpc0xUQ2xhdXNlOiBmdW5jdGlvbiBpc0xUQ2xhdXNlKGNsYXVzZSkgewogICAgcmV0dXJuIEZpZWxkLmlzSW5zdGFuY2UoY2xhdXNlKSAmJiBPcGVyYXRvci5pc0xUKGNsYXVzZS5vcGVyYXRvcik7CiAgfSwKICBpc0xURTogZnVuY3Rpb24gaXNMVEUobWF0Y2gpIHsKICAgIHJldHVybiBtYXRjaCA9PT0gT3BlcmF0b3IuTFRFOwogIH0sCiAgaXNMVEVDbGF1c2U6IGZ1bmN0aW9uIGlzTFRFQ2xhdXNlKGNsYXVzZSkgewogICAgcmV0dXJuIEZpZWxkLmlzSW5zdGFuY2UoY2xhdXNlKSAmJiBPcGVyYXRvci5pc0xURShjbGF1c2Uub3BlcmF0b3IpOwogIH0KfSk7CnZhciBUZXJtID0gT2JqZWN0LmZyZWV6ZSh7CiAgVFlQRTogJ3Rlcm0nLAogIGlzSW5zdGFuY2U6IGZ1bmN0aW9uIGlzSW5zdGFuY2UoY2xhdXNlKSB7CiAgICByZXR1cm4gY2xhdXNlLnR5cGUgPT09IFRlcm0uVFlQRTsKICB9LAogIG11c3Q6IGZ1bmN0aW9uIG11c3QodmFsdWUpIHsKICAgIHJldHVybiB7CiAgICAgIHR5cGU6IFRlcm0uVFlQRSwKICAgICAgdmFsdWU6IHZhbHVlLAogICAgICBtYXRjaDogTWF0Y2guTVVTVAogICAgfTsKICB9LAogIG11c3ROb3Q6IGZ1bmN0aW9uIG11c3ROb3QodmFsdWUpIHsKICAgIHJldHVybiB7CiAgICAgIHR5cGU6IFRlcm0uVFlQRSwKICAgICAgdmFsdWU6IHZhbHVlLAogICAgICBtYXRjaDogTWF0Y2guTVVTVF9OT1QKICAgIH07CiAgfQp9KTsKdmFyIEdyb3VwID0gT2JqZWN0LmZyZWV6ZSh7CiAgVFlQRTogJ2dyb3VwJywKICBpc0luc3RhbmNlOiBmdW5jdGlvbiBpc0luc3RhbmNlKGNsYXVzZSkgewogICAgcmV0dXJuIGNsYXVzZS50eXBlID09PSBHcm91cC5UWVBFOwogIH0sCiAgbXVzdDogZnVuY3Rpb24gbXVzdCh2YWx1ZSkgewogICAgcmV0dXJuIHsKICAgICAgdHlwZTogR3JvdXAuVFlQRSwKICAgICAgdmFsdWU6IHZhbHVlLAogICAgICBtYXRjaDogTWF0Y2guTVVTVAogICAgfTsKICB9LAogIG11c3ROb3Q6IGZ1bmN0aW9uIG11c3ROb3QodmFsdWUpIHsKICAgIHJldHVybiB7CiAgICAgIHR5cGU6IEdyb3VwLlRZUEUsCiAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgbWF0Y2g6IE1hdGNoLk1VU1RfTk9UCiAgICB9OwogIH0KfSk7CnZhciBGaWVsZCA9IE9iamVjdC5mcmVlemUoewogIFRZUEU6ICdmaWVsZCcsCiAgaXNJbnN0YW5jZTogZnVuY3Rpb24gaXNJbnN0YW5jZShjbGF1c2UpIHsKICAgIHJldHVybiBjbGF1c2UudHlwZSA9PT0gRmllbGQuVFlQRTsKICB9LAogIG11c3Q6IHsKICAgIGVxOiBmdW5jdGlvbiBlcShmaWVsZCwgdmFsdWUpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiBGaWVsZC5UWVBFLAogICAgICAgIGZpZWxkOiBmaWVsZCwKICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgbWF0Y2g6IE1hdGNoLk1VU1QsCiAgICAgICAgb3BlcmF0b3I6IE9wZXJhdG9yLkVRCiAgICAgIH07CiAgICB9LAogICAgZXhhY3Q6IGZ1bmN0aW9uIGV4YWN0KGZpZWxkLCB2YWx1ZSkgewogICAgICByZXR1cm4gewogICAgICAgIHR5cGU6IEZpZWxkLlRZUEUsCiAgICAgICAgZmllbGQ6IGZpZWxkLAogICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICBtYXRjaDogTWF0Y2guTVVTVCwKICAgICAgICBvcGVyYXRvcjogT3BlcmF0b3IuRVhBQ1QKICAgICAgfTsKICAgIH0sCiAgICBndDogZnVuY3Rpb24gZ3QoZmllbGQsIHZhbHVlKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogRmllbGQuVFlQRSwKICAgICAgICBmaWVsZDogZmllbGQsCiAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgIG1hdGNoOiBNYXRjaC5NVVNULAogICAgICAgIG9wZXJhdG9yOiBPcGVyYXRvci5HVAogICAgICB9OwogICAgfSwKICAgIGd0ZTogZnVuY3Rpb24gZ3RlKGZpZWxkLCB2YWx1ZSkgewogICAgICByZXR1cm4gewogICAgICAgIHR5cGU6IEZpZWxkLlRZUEUsCiAgICAgICAgZmllbGQ6IGZpZWxkLAogICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICBtYXRjaDogTWF0Y2guTVVTVCwKICAgICAgICBvcGVyYXRvcjogT3BlcmF0b3IuR1RFCiAgICAgIH07CiAgICB9LAogICAgbHQ6IGZ1bmN0aW9uIGx0KGZpZWxkLCB2YWx1ZSkgewogICAgICByZXR1cm4gewogICAgICAgIHR5cGU6IEZpZWxkLlRZUEUsCiAgICAgICAgZmllbGQ6IGZpZWxkLAogICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICBtYXRjaDogTWF0Y2guTVVTVCwKICAgICAgICBvcGVyYXRvcjogT3BlcmF0b3IuTFQKICAgICAgfTsKICAgIH0sCiAgICBsdGU6IGZ1bmN0aW9uIGx0ZShmaWVsZCwgdmFsdWUpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiBGaWVsZC5UWVBFLAogICAgICAgIGZpZWxkOiBmaWVsZCwKICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgbWF0Y2g6IE1hdGNoLk1VU1QsCiAgICAgICAgb3BlcmF0b3I6IE9wZXJhdG9yLkxURQogICAgICB9OwogICAgfQogIH0sCiAgbXVzdE5vdDogewogICAgZXE6IGZ1bmN0aW9uIGVxKGZpZWxkLCB2YWx1ZSkgewogICAgICByZXR1cm4gewogICAgICAgIHR5cGU6IEZpZWxkLlRZUEUsCiAgICAgICAgZmllbGQ6IGZpZWxkLAogICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICBtYXRjaDogTWF0Y2guTVVTVF9OT1QsCiAgICAgICAgb3BlcmF0b3I6IE9wZXJhdG9yLkVRCiAgICAgIH07CiAgICB9LAogICAgZXhhY3Q6IGZ1bmN0aW9uIGV4YWN0KGZpZWxkLCB2YWx1ZSkgewogICAgICByZXR1cm4gewogICAgICAgIHR5cGU6IEZpZWxkLlRZUEUsCiAgICAgICAgZmllbGQ6IGZpZWxkLAogICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICBtYXRjaDogTWF0Y2guTVVTVF9OT1QsCiAgICAgICAgb3BlcmF0b3I6IE9wZXJhdG9yLkVYQUNUCiAgICAgIH07CiAgICB9LAogICAgZ3Q6IGZ1bmN0aW9uIGd0KGZpZWxkLCB2YWx1ZSkgewogICAgICByZXR1cm4gewogICAgICAgIHR5cGU6IEZpZWxkLlRZUEUsCiAgICAgICAgZmllbGQ6IGZpZWxkLAogICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICBtYXRjaDogTWF0Y2guTVVTVF9OT1QsCiAgICAgICAgb3BlcmF0b3I6IE9wZXJhdG9yLkdUCiAgICAgIH07CiAgICB9LAogICAgZ3RlOiBmdW5jdGlvbiBndGUoZmllbGQsIHZhbHVlKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogRmllbGQuVFlQRSwKICAgICAgICBmaWVsZDogZmllbGQsCiAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgIG1hdGNoOiBNYXRjaC5NVVNUX05PVCwKICAgICAgICBvcGVyYXRvcjogT3BlcmF0b3IuR1RFCiAgICAgIH07CiAgICB9LAogICAgbHQ6IGZ1bmN0aW9uIGx0KGZpZWxkLCB2YWx1ZSkgewogICAgICByZXR1cm4gewogICAgICAgIHR5cGU6IEZpZWxkLlRZUEUsCiAgICAgICAgZmllbGQ6IGZpZWxkLAogICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICBtYXRjaDogTWF0Y2guTVVTVF9OT1QsCiAgICAgICAgb3BlcmF0b3I6IE9wZXJhdG9yLkxUCiAgICAgIH07CiAgICB9LAogICAgbHRlOiBmdW5jdGlvbiBsdGUoZmllbGQsIHZhbHVlKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogRmllbGQuVFlQRSwKICAgICAgICBmaWVsZDogZmllbGQsCiAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgIG1hdGNoOiBNYXRjaC5NVVNUX05PVCwKICAgICAgICBvcGVyYXRvcjogT3BlcmF0b3IuTFRFCiAgICAgIH07CiAgICB9CiAgfQp9KTsKdmFyIElzID0gT2JqZWN0LmZyZWV6ZSh7CiAgVFlQRTogJ2lzJywKICBpc0luc3RhbmNlOiBmdW5jdGlvbiBpc0luc3RhbmNlKGNsYXVzZSkgewogICAgcmV0dXJuIGNsYXVzZS50eXBlID09PSBJcy5UWVBFOwogIH0sCiAgbXVzdDogZnVuY3Rpb24gbXVzdChmbGFnKSB7CiAgICByZXR1cm4gewogICAgICB0eXBlOiBJcy5UWVBFLAogICAgICBmbGFnOiBmbGFnLAogICAgICBtYXRjaDogTWF0Y2guTVVTVAogICAgfTsKICB9LAogIG11c3ROb3Q6IGZ1bmN0aW9uIG11c3ROb3QoZmxhZykgewogICAgcmV0dXJuIHsKICAgICAgdHlwZTogSXMuVFlQRSwKICAgICAgZmxhZzogZmxhZywKICAgICAgbWF0Y2g6IE1hdGNoLk1VU1RfTk9UCiAgICB9OwogIH0KfSk7Cgp2YXIgdmFsdWVzRXF1YWwgPSBmdW5jdGlvbiB2YWx1ZXNFcXVhbCh2MSwgdjIpIHsKICBpZiAoaXNEYXRlVmFsdWUodjEpKSB7CiAgICByZXR1cm4gZGF0ZVZhbHVlc0VxdWFsKHYxLCB2Mik7CiAgfQoKICByZXR1cm4gdjEgPT09IHYyOwp9OwoKdmFyIGFycmF5SW5jbHVkZXNWYWx1ZSA9IGZ1bmN0aW9uIGFycmF5SW5jbHVkZXNWYWx1ZShhcnJheSwgdmFsdWUpIHsKICByZXR1cm4gYXJyYXkuc29tZShmdW5jdGlvbiAoaXRlbSkgewogICAgcmV0dXJuIHZhbHVlc0VxdWFsKGl0ZW0sIHZhbHVlKTsKICB9KTsKfTsKLyoqCiAqIFRoZSBBU1Qgc3RydWN0dXJlIGlzIGFuIGFycmF5IG9mIGNsYXVzZXMuIFRoZXJlIGFyZSAzIHR5cGVzIG9mIGNsYXVzZXMgdGhhdCBhcmUgc3VwcG9ydGVkOgogKgogKiA6dGVybToKICogSG9sZHMgYSBWQUxVRSBhbmQgYW4gT0NDVVIuIFRoZSBPQ0NVUiBpbmRpY2F0ZXMgd2hldGhlciB0aGUgdmFsdWUgbXVzdCBtYXRjaCBvciBtdXN0IG5vdCBtYXRjaC4gRGVmYXVsdAogKiBjbGF1c2VzIGFyZSBub3QgYXNzb2NpYXRlZCB3aXRoIGFueSBzcGVjaWZpYyBmaWVsZCAtIHdoZW4gZXhlY3V0aW5nIHRoZSBzZWFyY2gsIG9uZSBjYW4gc3BlY2lmeSB3aGF0IGFyZQogKiB0aGUgZGVmYXVsdCBmaWVsZHMgdGhhdCB0aGUgZGVmYXVsdCBjbGF1c2VzIHdpbGwgYmUgbWF0Y2hlZCBhZ2FpbnN0LgogKgogKiA6ZmllbGQ6CiAqIExpa2UgdGhlIGB0ZXJtYCBjbGF1c2UsIGhvbGRzIGEgVkFMVUUgYW5kIGFuIE1BVENILCBidXQgdGhpcyBjbGF1c2UgYWxzbyBzcGVjaWZpZXMgdGhlIGZpZWxkIHRoYXQgdGhlCiAqIHZhbHVlIHdpbGwgYmUgbWF0Y2hlZCBhZ2FpbnN0LgogKgogKiA6aXM6CiAqIEhvbGRzIGEgRkxBRyBhbmQgaW5kaWNhdGVzIHdoZXRoZXIgdGhpcyBmbGFnIG11c3QgYmUgYXBwbGllZCBvciBtdXN0IG5vdCBiZSBhcHBsaWVkLiBUeXBpY2FsbHkgdGhpcyBjbGF1c2UKICogbWF0Y2hlcyBhZ2FpbnN0IGJvb2xlYW4gdmFsdWVzIG9mIGEgcmVjb3JkIChlLmcuICJpczpvbmxpbmUiLCAiaXM6aW50ZXJuYWwiLCAiaXM6b24iLCBldGMuLikKICoKICogVGhpcyBBU1QgaXMgaW1tdXRhYmxlIC0gZXZlcnkgIm11dGF0aW5nIiBvcGVyYXRpb24gcmV0dXJucyBhIG5ld2x5IG11dGF0ZWQgQVNULgogKi8KCgpleHBvcnQgdmFyIF9BU1QgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIF9jcmVhdGVDbGFzcyhfQVNULCBudWxsLCBbewogICAga2V5OiAiY3JlYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGUoY2xhdXNlcykgewogICAgICByZXR1cm4gbmV3IF9BU1QoY2xhdXNlcyk7CiAgICB9CiAgfV0pOwoKICBmdW5jdGlvbiBfQVNUKCkgewogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICB2YXIgY2xhdXNlcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogW107CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIF9BU1QpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiX2NsYXVzZXMiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiX2luZGV4ZWRDbGF1c2VzIiwgdm9pZCAwKTsKCiAgICB0aGlzLl9jbGF1c2VzID0gY2xhdXNlczsKICAgIHRoaXMuX2luZGV4ZWRDbGF1c2VzID0gewogICAgICBmaWVsZDoge30sCiAgICAgIGlzOiB7fSwKICAgICAgdGVybTogW10sCiAgICAgIGdyb3VwOiBbXQogICAgfTsKICAgIGNsYXVzZXMuZm9yRWFjaChmdW5jdGlvbiAoY2xhdXNlKSB7CiAgICAgIHN3aXRjaCAoY2xhdXNlLnR5cGUpIHsKICAgICAgICBjYXNlIEZpZWxkLlRZUEU6CiAgICAgICAgICBpZiAoIV90aGlzLl9pbmRleGVkQ2xhdXNlcy5maWVsZFtjbGF1c2UuZmllbGRdKSB7CiAgICAgICAgICAgIF90aGlzLl9pbmRleGVkQ2xhdXNlcy5maWVsZFtjbGF1c2UuZmllbGRdID0gW107CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMuX2luZGV4ZWRDbGF1c2VzLmZpZWxkW2NsYXVzZS5maWVsZF0ucHVzaChjbGF1c2UpOwoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIElzLlRZUEU6CiAgICAgICAgICBfdGhpcy5faW5kZXhlZENsYXVzZXMuaXNbY2xhdXNlLmZsYWddID0gY2xhdXNlOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgVGVybS5UWVBFOgogICAgICAgICAgX3RoaXMuX2luZGV4ZWRDbGF1c2VzLnRlcm0ucHVzaChjbGF1c2UpOwoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIEdyb3VwLlRZUEU6CiAgICAgICAgICBfdGhpcy5faW5kZXhlZENsYXVzZXMuZ3JvdXAucHVzaChjbGF1c2UpOwoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgLy8gQHRzLWlnbm9yZSBUUyBrbm93cyB3ZSBoYXZlIGV4aGF1c3RlZCB0aGUgbWF0Y2gKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5rbm93biBxdWVyeSBjbGF1c2UgdHlwZSBbIi5jb25jYXQoY2xhdXNlLnR5cGUsICJdIikpOwogICAgICB9CiAgICB9KTsKICB9CgogIF9jcmVhdGVDbGFzcyhfQVNULCBbewogICAga2V5OiAiZ2V0VGVybUNsYXVzZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFRlcm1DbGF1c2VzKCkgewogICAgICByZXR1cm4gdGhpcy5faW5kZXhlZENsYXVzZXMudGVybTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRUZXJtQ2xhdXNlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRUZXJtQ2xhdXNlKHZhbHVlKSB7CiAgICAgIHZhciBjbGF1c2VzID0gdGhpcy5nZXRUZXJtQ2xhdXNlcygpOwogICAgICByZXR1cm4gY2xhdXNlcy5maW5kKGZ1bmN0aW9uIChjbGF1c2UpIHsKICAgICAgICByZXR1cm4gdmFsdWVzRXF1YWwoY2xhdXNlLnZhbHVlLCB2YWx1ZSk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImdldEZpZWxkTmFtZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEZpZWxkTmFtZXMoKSB7CiAgICAgIHJldHVybiBPYmplY3Qua2V5cyh0aGlzLl9pbmRleGVkQ2xhdXNlcy5maWVsZCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0RmllbGRDbGF1c2VzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRGaWVsZENsYXVzZXMoZmllbGQpIHsKICAgICAgcmV0dXJuIGZpZWxkID8gdGhpcy5faW5kZXhlZENsYXVzZXMuZmllbGRbZmllbGRdIDogdGhpcy5fY2xhdXNlcy5maWx0ZXIoRmllbGQuaXNJbnN0YW5jZSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0RmllbGRDbGF1c2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEZpZWxkQ2xhdXNlKGZpZWxkLCBwcmVkaWNhdGUpIHsKICAgICAgdmFyIGNsYXVzZXMgPSB0aGlzLmdldEZpZWxkQ2xhdXNlcyhmaWVsZCk7CgogICAgICBpZiAoY2xhdXNlcykgewogICAgICAgIHJldHVybiBjbGF1c2VzLmZpbmQocHJlZGljYXRlKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImhhc09yRmllbGRDbGF1c2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGhhc09yRmllbGRDbGF1c2UoZmllbGQsIHZhbHVlKSB7CiAgICAgIHZhciBjbGF1c2UgPSB0aGlzLmdldEZpZWxkQ2xhdXNlKGZpZWxkLCBmdW5jdGlvbiAoY2xhdXNlKSB7CiAgICAgICAgcmV0dXJuIGlzQXJyYXkoY2xhdXNlLnZhbHVlKTsKICAgICAgfSk7CgogICAgICBpZiAoIWNsYXVzZSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSAvLyBXZSBjYW4gYXBwbHkgdGhpcyB0eXBlIGNhc3QgZHVlIHRvIHRoZSBgaXNBcnJheWAgZmlsdGVyIGFib3ZlCgoKICAgICAgcmV0dXJuIGlzTmlsKHZhbHVlKSB8fCBhcnJheUluY2x1ZGVzVmFsdWUoY2xhdXNlLnZhbHVlLCB2YWx1ZSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0T3JGaWVsZENsYXVzZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0T3JGaWVsZENsYXVzZShmaWVsZCwgdmFsdWUpIHsKICAgICAgcmV0dXJuIHRoaXMuZ2V0RmllbGRDbGF1c2UoZmllbGQsIGZ1bmN0aW9uIChjbGF1c2UpIHsKICAgICAgICByZXR1cm4gaXNBcnJheShjbGF1c2UudmFsdWUpICYmIChpc05pbCh2YWx1ZSkgfHwgYXJyYXlJbmNsdWRlc1ZhbHVlKGNsYXVzZS52YWx1ZSwgdmFsdWUpKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiYWRkT3JGaWVsZFZhbHVlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRPckZpZWxkVmFsdWUoZmllbGQsIHZhbHVlKSB7CiAgICAgIHZhciBtdXN0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiB0cnVlOwogICAgICB2YXIgb3BlcmF0b3IgPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1szXSA6IE9wZXJhdG9yLkVROwogICAgICB2YXIgZXhpc3RpbmdDbGF1c2UgPSB0aGlzLmdldE9yRmllbGRDbGF1c2UoZmllbGQpOwoKICAgICAgaWYgKCFleGlzdGluZ0NsYXVzZSkgewogICAgICAgIHZhciBuZXdDbGF1c2UgPSBtdXN0ID8gRmllbGQubXVzdFtvcGVyYXRvcl0oZmllbGQsIFt2YWx1ZV0pIDogRmllbGQubXVzdE5vdFtvcGVyYXRvcl0oZmllbGQsIFt2YWx1ZV0pOwogICAgICAgIHJldHVybiBuZXcgX0FTVChbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHRoaXMuX2NsYXVzZXMpLCBbbmV3Q2xhdXNlXSkpOwogICAgICB9CgogICAgICB2YXIgY2xhdXNlcyA9IHRoaXMuX2NsYXVzZXMubWFwKGZ1bmN0aW9uIChjbGF1c2UpIHsKICAgICAgICBpZiAoY2xhdXNlID09PSBleGlzdGluZ0NsYXVzZSkgewogICAgICAgICAgY2xhdXNlLnZhbHVlLnB1c2godmFsdWUpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGNsYXVzZTsKICAgICAgfSk7CgogICAgICByZXR1cm4gbmV3IF9BU1QoY2xhdXNlcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVtb3ZlT3JGaWVsZFZhbHVlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVPckZpZWxkVmFsdWUoZmllbGQsIHZhbHVlKSB7CiAgICAgIHZhciBleGlzdGluZ0NsYXVzZSA9IHRoaXMuZ2V0T3JGaWVsZENsYXVzZShmaWVsZCwgdmFsdWUpOwoKICAgICAgaWYgKCFleGlzdGluZ0NsYXVzZSkgewogICAgICAgIHJldHVybiBuZXcgX0FTVChfdG9Db25zdW1hYmxlQXJyYXkodGhpcy5fY2xhdXNlcykpOwogICAgICB9CgogICAgICB2YXIgY2xhdXNlcyA9IHRoaXMuX2NsYXVzZXMucmVkdWNlKGZ1bmN0aW9uIChjbGF1c2VzLCBjbGF1c2UpIHsKICAgICAgICBpZiAoY2xhdXNlICE9PSBleGlzdGluZ0NsYXVzZSkgewogICAgICAgICAgY2xhdXNlcy5wdXNoKGNsYXVzZSk7CiAgICAgICAgICByZXR1cm4gY2xhdXNlczsKICAgICAgICB9CgogICAgICAgIHZhciBmaWx0ZXJlZFZhbHVlID0gY2xhdXNlLnZhbHVlLmZpbHRlcihmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgICByZXR1cm4gIXZhbHVlc0VxdWFsKHZhbCwgdmFsdWUpOwogICAgICAgIH0pOwoKICAgICAgICBpZiAoZmlsdGVyZWRWYWx1ZS5sZW5ndGggPT09IDApIHsKICAgICAgICAgIHJldHVybiBjbGF1c2VzOwogICAgICAgIH0KCiAgICAgICAgY2xhdXNlcy5wdXNoKF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgY2xhdXNlKSwge30sIHsKICAgICAgICAgIHZhbHVlOiBmaWx0ZXJlZFZhbHVlCiAgICAgICAgfSkpOwogICAgICAgIHJldHVybiBjbGF1c2VzOwogICAgICB9LCBbXSk7CgogICAgICByZXR1cm4gbmV3IF9BU1QoY2xhdXNlcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVtb3ZlT3JGaWVsZENsYXVzZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZU9yRmllbGRDbGF1c2VzKGZpZWxkKSB7CiAgICAgIHZhciBjbGF1c2VzID0gdGhpcy5fY2xhdXNlcy5maWx0ZXIoZnVuY3Rpb24gKGNsYXVzZSkgewogICAgICAgIHJldHVybiAhRmllbGQuaXNJbnN0YW5jZShjbGF1c2UpIHx8IGNsYXVzZS5maWVsZCAhPT0gZmllbGQgfHwgIWlzQXJyYXkoY2xhdXNlLnZhbHVlKTsKICAgICAgfSk7CgogICAgICByZXR1cm4gbmV3IF9BU1QoY2xhdXNlcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAiaGFzU2ltcGxlRmllbGRDbGF1c2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGhhc1NpbXBsZUZpZWxkQ2xhdXNlKGZpZWxkLCB2YWx1ZSkgewogICAgICB2YXIgY2xhdXNlID0gdGhpcy5nZXRGaWVsZENsYXVzZShmaWVsZCwgZnVuY3Rpb24gKGNsYXVzZSkgewogICAgICAgIHJldHVybiAhaXNBcnJheShjbGF1c2UudmFsdWUpOwogICAgICB9KTsKCiAgICAgIGlmICghY2xhdXNlKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gaXNOaWwodmFsdWUpIHx8IHZhbHVlc0VxdWFsKGNsYXVzZS52YWx1ZSwgdmFsdWUpOwogICAgfQogIH0sIHsKICAgIGtleTogImdldFNpbXBsZUZpZWxkQ2xhdXNlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTaW1wbGVGaWVsZENsYXVzZShmaWVsZCwgdmFsdWUpIHsKICAgICAgcmV0dXJuIHRoaXMuZ2V0RmllbGRDbGF1c2UoZmllbGQsIGZ1bmN0aW9uIChjbGF1c2UpIHsKICAgICAgICByZXR1cm4gIWlzQXJyYXkoY2xhdXNlLnZhbHVlKSAmJiAoaXNOaWwodmFsdWUpIHx8IHZhbHVlc0VxdWFsKGNsYXVzZS52YWx1ZSwgdmFsdWUpKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiYWRkU2ltcGxlRmllbGRWYWx1ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkU2ltcGxlRmllbGRWYWx1ZShmaWVsZCwgdmFsdWUpIHsKICAgICAgdmFyIG11c3QgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IHRydWU7CiAgICAgIHZhciBvcGVyYXRvciA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzNdIDogT3BlcmF0b3IuRVE7CiAgICAgIHZhciBjbGF1c2UgPSBtdXN0ID8gRmllbGQubXVzdFtvcGVyYXRvcl0oZmllbGQsIHZhbHVlKSA6IEZpZWxkLm11c3ROb3Rbb3BlcmF0b3JdKGZpZWxkLCB2YWx1ZSk7CiAgICAgIHJldHVybiB0aGlzLmFkZENsYXVzZShjbGF1c2UpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbW92ZVNpbXBsZUZpZWxkVmFsdWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZVNpbXBsZUZpZWxkVmFsdWUoZmllbGQsIHZhbHVlKSB7CiAgICAgIHZhciBleGlzdGluZ0NsYXVzZSA9IHRoaXMuZ2V0U2ltcGxlRmllbGRDbGF1c2UoZmllbGQsIHZhbHVlKTsKCiAgICAgIGlmICghZXhpc3RpbmdDbGF1c2UpIHsKICAgICAgICByZXR1cm4gbmV3IF9BU1QoX3RvQ29uc3VtYWJsZUFycmF5KHRoaXMuX2NsYXVzZXMpKTsKICAgICAgfQoKICAgICAgdmFyIGNsYXVzZXMgPSB0aGlzLl9jbGF1c2VzLmZpbHRlcihmdW5jdGlvbiAoY2xhdXNlKSB7CiAgICAgICAgcmV0dXJuIGNsYXVzZSAhPT0gZXhpc3RpbmdDbGF1c2U7CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIG5ldyBfQVNUKGNsYXVzZXMpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbW92ZVNpbXBsZUZpZWxkQ2xhdXNlcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlU2ltcGxlRmllbGRDbGF1c2VzKGZpZWxkKSB7CiAgICAgIHZhciBjbGF1c2VzID0gdGhpcy5fY2xhdXNlcy5maWx0ZXIoZnVuY3Rpb24gKGNsYXVzZSkgewogICAgICAgIHJldHVybiAhRmllbGQuaXNJbnN0YW5jZShjbGF1c2UpIHx8IGNsYXVzZS5maWVsZCAhPT0gZmllbGQgfHwgaXNBcnJheShjbGF1c2UudmFsdWUpOwogICAgICB9KTsKCiAgICAgIHJldHVybiBuZXcgX0FTVChjbGF1c2VzKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRJc0NsYXVzZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldElzQ2xhdXNlcygpIHsKICAgICAgcmV0dXJuIE9iamVjdC52YWx1ZXModGhpcy5faW5kZXhlZENsYXVzZXMuaXMpOwogICAgfQogIH0sIHsKICAgIGtleTogImdldElzQ2xhdXNlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRJc0NsYXVzZShmbGFnKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbmRleGVkQ2xhdXNlcy5pc1tmbGFnXTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW1vdmVJc0NsYXVzZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlSXNDbGF1c2UoZmxhZykgewogICAgICByZXR1cm4gbmV3IF9BU1QodGhpcy5fY2xhdXNlcy5maWx0ZXIoZnVuY3Rpb24gKGNsYXVzZSkgewogICAgICAgIHJldHVybiAhSXMuaXNJbnN0YW5jZShjbGF1c2UpIHx8IGNsYXVzZS5mbGFnICE9PSBmbGFnOwogICAgICB9KSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0R3JvdXBDbGF1c2VzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRHcm91cENsYXVzZXMoKSB7CiAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKHRoaXMuX2luZGV4ZWRDbGF1c2VzLmdyb3VwKTsKICAgIH0KICAgIC8qKgogICAgICogQ3JlYXRlcyBhbmQgcmV0dXJucyBhIG5ldyBBU1Qgd2l0aCB0aGUgZ2l2ZW4gY2xhdXNlIGFkZGVkIHRvIHRoZSBjdXJyZW50IGNsYXVzZXMuIElmCiAgICAgKiB0aGUgY3VycmVudCBjbGF1c2VzIGFscmVhZHkgaW5jbHVkZSBhIHNpbWlsYXIgY2xhdXNlLCBpdCB3aWxsIGJlIChpbi1wbGFjZSkgcmVwbGFjZWQgYnkKICAgICAqIHRoZSBnaXZlbiBjbGF1c2UuIFdoZXRoZXIgYSBjbGF1c2UgaXMgc2ltaWxhciB0byB0aGUgZ2l2ZW4gb25lIGRlcGVuZHMgb24gdGhlIHR5cGUgb2YgdGhlIGNsYXVzZS4KICAgICAqIFR3byBjbGF1c2VzIGFyZSBzaW1pbGFyIGlmOgogICAgICoKICAgICAqIC0gdGhleSBhcmUgYm90aCBvZiB0aGUgc2FtZSB0eXBlCiAgICAgKiAtIGlmIHRoZXkgYXJlIGBkZWZhdWx0YCBjbGF1c2VzLCB0aGV5IG11c3QgaGF2ZSB0aGUgc2FtZSB2YWx1ZQogICAgICogLSBpZiB0aGV5IGFyZSBgdGVybWAgY2xhdXNlcywgdGhleSBtdXN0IGhhdmUgdGhlIHNhbWUgZmllbGRzIGFuZCB2YWx1ZXMKICAgICAqIC0gaWYgdGhleSBhcmUgYGlzYCBjbGF1c2VzLCB0aGV5IG11c3QgaGF2ZSB0aGUgc2FtZSBmbGFncwogICAgICoKICAgICAqIFRoZSByZWFzb25pbmcgYmVoaW5kIG5vdCBpbmNsdWRpbmcgdGhlIGBtYXRjaGAgYXR0cmlidXRlcyBvZiB0aGUgY2xhdXNlcyBpbiB0aGUgcnVsZXMgYWJvdmUsIHN0ZW1zCiAgICAgKiBpbiB0aGUgZmFjdCB0aGF0IHRoZSBBU1QgY2xhdXNlcyBhcmUgQU5EZWQsIGFuZCBoYXZpbmcgdHdvIHNpbWlsYXIgY2xhdXNlcyB3aXRoIHR3byBkaWZmZXJlbnQKICAgICAqIG1hdGNoIGF0dHJpYnV0ZXMgY3JlYXRlcyBhIGxvZ2ljYWxseSBjb250cmFkaWN0ZWQgQVNUIChlLmcuIHdoYXQgZG9lcyBpdCBtZWFuIHRvCiAgICAgKiAiKG11c3QgaGF2ZSB4KSBBTkQgKG11c3Qgbm90IGhhdmUgeCkiPykKICAgICAqCiAgICAgKiBub3RlOiAgaW4tcGxhY2UgcmVwbGFjZW1lbnQgbWVhbnMgdGhlIGdpdmVuIGNsYXVzZSB3aWxsIGJlIHBsYWNlZCBpbiB0aGUgc2FtZSBwb3NpdGlvbiBhcyB0aGUgb25lIGl0CiAgICAgKiAgICAgICAgcmVwbGFjZWQKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJhZGRDbGF1c2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFkZENsYXVzZShuZXdDbGF1c2UpIHsKICAgICAgdmFyIGFkZGVkID0gZmFsc2U7CgogICAgICB2YXIgbmV3Q2xhdXNlcyA9IHRoaXMuX2NsYXVzZXMucmVkdWNlKGZ1bmN0aW9uIChjbGF1c2VzLCBjbGF1c2UpIHsKICAgICAgICBpZiAobmV3Q2xhdXNlLnR5cGUgIT09IGNsYXVzZS50eXBlKSB7CiAgICAgICAgICBjbGF1c2VzLnB1c2goY2xhdXNlKTsKICAgICAgICAgIHJldHVybiBjbGF1c2VzOwogICAgICAgIH0KCiAgICAgICAgc3dpdGNoIChuZXdDbGF1c2UudHlwZSkgewogICAgICAgICAgY2FzZSBUZXJtLlRZUEU6CiAgICAgICAgICAgIGlmIChuZXdDbGF1c2UudmFsdWUgIT09IGNsYXVzZS52YWx1ZSkgewogICAgICAgICAgICAgIGNsYXVzZXMucHVzaChjbGF1c2UpOwogICAgICAgICAgICAgIHJldHVybiBjbGF1c2VzOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIEZpZWxkLlRZUEU6CiAgICAgICAgICAgIGlmIChuZXdDbGF1c2UuZmllbGQgIT09IGNsYXVzZS5maWVsZCB8fCBuZXdDbGF1c2UudmFsdWUgIT09IGNsYXVzZS52YWx1ZSkgewogICAgICAgICAgICAgIGNsYXVzZXMucHVzaChjbGF1c2UpOwogICAgICAgICAgICAgIHJldHVybiBjbGF1c2VzOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIElzLlRZUEU6CiAgICAgICAgICAgIGlmIChuZXdDbGF1c2UuZmxhZyAhPT0gY2xhdXNlLmZsYWcpIHsKICAgICAgICAgICAgICBjbGF1c2VzLnB1c2goY2xhdXNlKTsKICAgICAgICAgICAgICByZXR1cm4gY2xhdXNlczsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJ1bmtub3duIGNsYXVzZSB0eXBlIFsiLmNvbmNhdChuZXdDbGF1c2UudHlwZSwgIl0iKSk7CiAgICAgICAgfQoKICAgICAgICBhZGRlZCA9IHRydWU7CiAgICAgICAgY2xhdXNlcy5wdXNoKG5ld0NsYXVzZSk7CiAgICAgICAgcmV0dXJuIGNsYXVzZXM7CiAgICAgIH0sIFtdKTsKCiAgICAgIGlmICghYWRkZWQpIHsKICAgICAgICBuZXdDbGF1c2VzLnB1c2gobmV3Q2xhdXNlKTsKICAgICAgfQoKICAgICAgcmV0dXJuIG5ldyBfQVNUKG5ld0NsYXVzZXMpOwogICAgfQogIH0sIHsKICAgIGtleTogImNsYXVzZXMiLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl9jbGF1c2VzOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIF9BU1Q7Cn0oKTsKZXhwb3J0IHZhciBBU1QgPSBPYmplY3QuZnJlZXplKHsKICBNYXRjaDogTWF0Y2gsCiAgT3BlcmF0b3I6IE9wZXJhdG9yLAogIFRlcm06IFRlcm0sCiAgR3JvdXA6IEdyb3VwLAogIEZpZWxkOiBGaWVsZCwKICBJczogSXMsCiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoY2xhdXNlcykgewogICAgcmV0dXJuIG5ldyBfQVNUKGNsYXVzZXMpOwogIH0KfSk7Cgp0cnkgewogIF9BU1QuX19kb2NnZW5JbmZvID0gewogICAgZGVzY3JpcHRpb246ICdUaGUgQVNUIHN0cnVjdHVyZSBpcyBhbiBhcnJheSBvZiBjbGF1c2VzLiBUaGVyZSBhcmUgMyB0eXBlcyBvZiBjbGF1c2VzIHRoYXQgYXJlIHN1cHBvcnRlZDpcbicgKyAnXG4nICsgJzp0ZXJtOlxuJyArICdIb2xkcyBhIFZBTFVFIGFuZCBhbiBPQ0NVUi4gVGhlIE9DQ1VSIGluZGljYXRlcyB3aGV0aGVyIHRoZSB2YWx1ZSBtdXN0IG1hdGNoIG9yIG11c3Qgbm90IG1hdGNoLiBEZWZhdWx0XG4nICsgJ2NsYXVzZXMgYXJlIG5vdCBhc3NvY2lhdGVkIHdpdGggYW55IHNwZWNpZmljIGZpZWxkIC0gd2hlbiBleGVjdXRpbmcgdGhlIHNlYXJjaCwgb25lIGNhbiBzcGVjaWZ5IHdoYXQgYXJlXG4nICsgJ3RoZSBkZWZhdWx0IGZpZWxkcyB0aGF0IHRoZSBkZWZhdWx0IGNsYXVzZXMgd2lsbCBiZSBtYXRjaGVkIGFnYWluc3QuXG4nICsgJ1xuJyArICc6ZmllbGQ6XG4nICsgJ0xpa2UgdGhlIGB0ZXJtYCBjbGF1c2UsIGhvbGRzIGEgVkFMVUUgYW5kIGFuIE1BVENILCBidXQgdGhpcyBjbGF1c2UgYWxzbyBzcGVjaWZpZXMgdGhlIGZpZWxkIHRoYXQgdGhlXG4nICsgJ3ZhbHVlIHdpbGwgYmUgbWF0Y2hlZCBhZ2FpbnN0LlxuJyArICdcbicgKyAnOmlzOlxuJyArICdIb2xkcyBhIEZMQUcgYW5kIGluZGljYXRlcyB3aGV0aGVyIHRoaXMgZmxhZyBtdXN0IGJlIGFwcGxpZWQgb3IgbXVzdCBub3QgYmUgYXBwbGllZC4gVHlwaWNhbGx5IHRoaXMgY2xhdXNlXG4nICsgJ21hdGNoZXMgYWdhaW5zdCBib29sZWFuIHZhbHVlcyBvZiBhIHJlY29yZCAoZS5nLiAiaXM6b25saW5lIiwgImlzOmludGVybmFsIiwgImlzOm9uIiwgZXRjLi4pXG4nICsgJ1xuJyArICdUaGlzIEFTVCBpcyBpbW11dGFibGUgLSBldmVyeSAibXV0YXRpbmciIG9wZXJhdGlvbiByZXR1cm5zIGEgbmV3bHkgbXV0YXRlZCBBU1QuJywKICAgIGRpc3BsYXlOYW1lOiAnX0FTVCcsCiAgICBtZXRob2RzOiBbXSwKICAgIHByb3BzOiB7fSwKICAgIGV4dGVuZGVkSW50ZXJmYWNlczogW10KICB9Owp9IGNhdGNoIChlKSB7fQ=="},{"version":3,"sources":["D:/work/eui/src/components/search_bar/query/ast.ts"],"names":["isArray","isNil","dateValuesEqual","isDateValue","Match","Object","freeze","MUST","MUST_NOT","isMust","match","isMustClause","clause","Operator","EQ","EXACT","GT","GTE","LT","LTE","isEQ","isEQClause","Field","isInstance","operator","isEXACT","isEXACTClause","isRange","isGT","isGTE","isLT","isLTE","isRangeClause","isGTClause","isGTEClause","isLTClause","isLTEClause","Term","TYPE","type","must","value","mustNot","Group","eq","field","exact","gt","gte","lt","lte","Is","flag","valuesEqual","v1","v2","arrayIncludesValue","array","some","item","_AST","clauses","_clauses","_indexedClauses","is","term","group","forEach","push","Error","getTermClauses","find","keys","filter","predicate","getFieldClauses","getFieldClause","existingClause","getOrFieldClause","newClause","map","reduce","filteredValue","val","length","addClause","getSimpleFieldClause","values","added","newClauses","AST","create"],"mappings":"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","sourcesContent":["/*\n * Licensed to Elasticsearch B.V. under one or more contributor\n * license agreements. See the NOTICE file distributed with\n * this work for additional information regarding copyright\n * ownership. Elasticsearch B.V. licenses this file to you under\n * the Apache License, Version 2.0 (the \"License\"); you may\n * not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { isArray, isNil } from '../../../services/predicate';\nimport { DateValue, dateValuesEqual, isDateValue } from './date_value';\n\nexport type MatchType = 'must' | 'must_not';\n\nexport type Value = string | number | boolean | DateValue;\n\nexport interface IsClause {\n  type: 'is';\n  match?: MatchType;\n  flag: string;\n}\n\nexport interface FieldClause {\n  type: 'field';\n  match?: MatchType;\n  operator: OperatorType;\n  field: string;\n  value: Value | Value[];\n}\n\nexport interface TermClause {\n  type: 'term';\n  match?: MatchType;\n  value: Value;\n}\n\nexport interface GroupClause {\n  type: 'group';\n  match: MatchType;\n  value: Clause[];\n}\n\nexport type Clause = IsClause | FieldClause | TermClause | GroupClause;\n\nexport const Match = Object.freeze({\n  MUST: 'must' as const,\n  MUST_NOT: 'must_not' as const,\n  isMust(match: MatchType | undefined) {\n    return match === Match.MUST;\n  },\n  isMustClause(clause: Clause) {\n    return Match.isMust(clause.match);\n  },\n});\n\nexport type OperatorType = 'eq' | 'exact' | 'gt' | 'gte' | 'lt' | 'lte';\n\nexport const Operator = Object.freeze({\n  EQ: 'eq' as const,\n  EXACT: 'exact' as const,\n  GT: 'gt' as const,\n  GTE: 'gte' as const,\n  LT: 'lt' as const,\n  LTE: 'lte' as const,\n  isEQ(match: OperatorType | undefined) {\n    return match === Operator.EQ;\n  },\n  isEQClause(clause: Clause) {\n    return Field.isInstance(clause) && Operator.isEQ(clause.operator);\n  },\n  isEXACT(match: OperatorType | undefined) {\n    return match === Operator.EXACT;\n  },\n  isEXACTClause(clause: Clause) {\n    return Field.isInstance(clause) && Operator.isEXACT(clause.operator);\n  },\n  isRange(match: OperatorType | undefined) {\n    return (\n      Operator.isGT(match) ||\n      Operator.isGTE(match) ||\n      Operator.isLT(match) ||\n      Operator.isLTE(match)\n    );\n  },\n  isRangeClause(clause: Clause) {\n    return Field.isInstance(clause) && Operator.isRange(clause.operator);\n  },\n  isGT(match: OperatorType | undefined) {\n    return match === Operator.GT;\n  },\n  isGTClause(clause: Clause) {\n    return Field.isInstance(clause) && Operator.isGT(clause.operator);\n  },\n  isGTE(match: OperatorType | undefined) {\n    return match === Operator.GTE;\n  },\n  isGTEClause(clause: Clause) {\n    return Field.isInstance(clause) && Operator.isGTE(clause.operator);\n  },\n  isLT(match: OperatorType | undefined) {\n    return match === Operator.LT;\n  },\n  isLTClause(clause: Clause) {\n    return Field.isInstance(clause) && Operator.isLT(clause.operator);\n  },\n  isLTE(match: OperatorType | undefined) {\n    return match === Operator.LTE;\n  },\n  isLTEClause(clause: Clause) {\n    return Field.isInstance(clause) && Operator.isLTE(clause.operator);\n  },\n});\n\nconst Term = Object.freeze({\n  TYPE: 'term' as const,\n  isInstance: (clause: Clause): clause is TermClause => {\n    return clause.type === Term.TYPE;\n  },\n  must: (value: Value) => {\n    return { type: Term.TYPE, value, match: Match.MUST };\n  },\n  mustNot: (value: Value) => {\n    return { type: Term.TYPE, value, match: Match.MUST_NOT };\n  },\n});\n\nconst Group = Object.freeze({\n  TYPE: 'group' as const,\n  isInstance: (clause: Clause): clause is GroupClause => {\n    return clause.type === Group.TYPE;\n  },\n  must: (value: Clause[]) => {\n    return { type: Group.TYPE, value, match: Match.MUST };\n  },\n  mustNot: (value: Clause[]) => {\n    return { type: Group.TYPE, value, match: Match.MUST_NOT };\n  },\n});\n\nconst Field = Object.freeze({\n  TYPE: 'field' as const,\n  isInstance: (clause: Clause): clause is FieldClause => {\n    return clause.type === Field.TYPE;\n  },\n  must: {\n    eq: (field: string, value: Value | Value[]) => ({\n      type: Field.TYPE,\n      field,\n      value,\n      match: Match.MUST,\n      operator: Operator.EQ,\n    }),\n    exact: (field: string, value: Value | Value[]) => ({\n      type: Field.TYPE,\n      field,\n      value,\n      match: Match.MUST,\n      operator: Operator.EXACT,\n    }),\n    gt: (field: string, value: Value | Value[]) => ({\n      type: Field.TYPE,\n      field,\n      value,\n      match: Match.MUST,\n      operator: Operator.GT,\n    }),\n    gte: (field: string, value: Value | Value[]) => ({\n      type: Field.TYPE,\n      field,\n      value,\n      match: Match.MUST,\n      operator: Operator.GTE,\n    }),\n    lt: (field: string, value: Value | Value[]) => ({\n      type: Field.TYPE,\n      field,\n      value,\n      match: Match.MUST,\n      operator: Operator.LT,\n    }),\n    lte: (field: string, value: Value | Value[]) => ({\n      type: Field.TYPE,\n      field,\n      value,\n      match: Match.MUST,\n      operator: Operator.LTE,\n    }),\n  },\n  mustNot: {\n    eq: (field: string, value: Value | Value[]) => ({\n      type: Field.TYPE,\n      field,\n      value,\n      match: Match.MUST_NOT,\n      operator: Operator.EQ,\n    }),\n    exact: (field: string, value: Value | Value[]) => ({\n      type: Field.TYPE,\n      field,\n      value,\n      match: Match.MUST_NOT,\n      operator: Operator.EXACT,\n    }),\n    gt: (field: string, value: Value | Value[]) => ({\n      type: Field.TYPE,\n      field,\n      value,\n      match: Match.MUST_NOT,\n      operator: Operator.GT,\n    }),\n    gte: (field: string, value: Value | Value[]) => ({\n      type: Field.TYPE,\n      field,\n      value,\n      match: Match.MUST_NOT,\n      operator: Operator.GTE,\n    }),\n    lt: (field: string, value: Value | Value[]) => ({\n      type: Field.TYPE,\n      field,\n      value,\n      match: Match.MUST_NOT,\n      operator: Operator.LT,\n    }),\n    lte: (field: string, value: Value | Value[]) => ({\n      type: Field.TYPE,\n      field,\n      value,\n      match: Match.MUST_NOT,\n      operator: Operator.LTE,\n    }),\n  },\n});\n\nconst Is = Object.freeze({\n  TYPE: 'is' as const,\n  isInstance: (clause: Clause): clause is IsClause => {\n    return clause.type === Is.TYPE;\n  },\n  must: (flag: string) => {\n    return { type: Is.TYPE, flag, match: Match.MUST };\n  },\n  mustNot: (flag: string) => {\n    return { type: Is.TYPE, flag, match: Match.MUST_NOT };\n  },\n});\n\nconst valuesEqual = (v1: any, v2: any) => {\n  if (isDateValue(v1)) {\n    return dateValuesEqual(v1, v2);\n  }\n  return v1 === v2;\n};\n\nconst arrayIncludesValue = (array: any[], value: any) => {\n  return array.some((item) => valuesEqual(item, value));\n};\n\n/**\n * The AST structure is an array of clauses. There are 3 types of clauses that are supported:\n *\n * :term:\n * Holds a VALUE and an OCCUR. The OCCUR indicates whether the value must match or must not match. Default\n * clauses are not associated with any specific field - when executing the search, one can specify what are\n * the default fields that the default clauses will be matched against.\n *\n * :field:\n * Like the `term` clause, holds a VALUE and an MATCH, but this clause also specifies the field that the\n * value will be matched against.\n *\n * :is:\n * Holds a FLAG and indicates whether this flag must be applied or must not be applied. Typically this clause\n * matches against boolean values of a record (e.g. \"is:online\", \"is:internal\", \"is:on\", etc..)\n *\n * This AST is immutable - every \"mutating\" operation returns a newly mutated AST.\n */\nexport class _AST {\n  private readonly _clauses: Clause[];\n  private readonly _indexedClauses: {\n    field: {\n      [field: string]: FieldClause[];\n    };\n    is: {\n      [flag: string]: IsClause;\n    };\n    term: TermClause[];\n    group: GroupClause[];\n  };\n\n  static create(clauses: Clause[]) {\n    return new _AST(clauses);\n  }\n\n  constructor(clauses: Clause[] = []) {\n    this._clauses = clauses;\n    this._indexedClauses = { field: {}, is: {}, term: [], group: [] };\n\n    clauses.forEach((clause) => {\n      switch (clause.type) {\n        case Field.TYPE:\n          if (!this._indexedClauses.field[clause.field]) {\n            this._indexedClauses.field[clause.field] = [];\n          }\n          this._indexedClauses.field[clause.field].push(clause);\n          break;\n\n        case Is.TYPE:\n          this._indexedClauses.is[clause.flag] = clause;\n          break;\n\n        case Term.TYPE:\n          this._indexedClauses.term.push(clause);\n          break;\n\n        case Group.TYPE:\n          this._indexedClauses.group.push(clause);\n          break;\n\n        default:\n          // @ts-ignore TS knows we have exhausted the match\n          throw new Error(`Unknown query clause type [${clause.type}]`);\n      }\n    });\n  }\n\n  get clauses() {\n    return this._clauses;\n  }\n\n  getTermClauses() {\n    return this._indexedClauses.term;\n  }\n\n  getTermClause(value: Value) {\n    const clauses = this.getTermClauses();\n    return clauses.find((clause) => valuesEqual(clause.value, value));\n  }\n\n  getFieldNames() {\n    return Object.keys(this._indexedClauses.field);\n  }\n\n  getFieldClauses(field?: string): FieldClause[] {\n    return field\n      ? this._indexedClauses.field[field]\n      : this._clauses.filter(Field.isInstance);\n  }\n\n  getFieldClause(\n    field: string,\n    predicate: (c: FieldClause) => boolean\n  ): FieldClause | undefined {\n    const clauses = this.getFieldClauses(field);\n    if (clauses) {\n      return clauses.find(predicate);\n    }\n  }\n\n  hasOrFieldClause(field: string, value?: Value) {\n    const clause = this.getFieldClause(field, (clause) =>\n      isArray(clause.value)\n    );\n    if (!clause) {\n      return false;\n    }\n\n    // We can apply this type cast due to the `isArray` filter above\n    return isNil(value) || arrayIncludesValue(clause.value as Value[], value);\n  }\n\n  getOrFieldClause(field: string, value?: Value) {\n    return this.getFieldClause(\n      field,\n      (clause) =>\n        isArray(clause.value) &&\n        (isNil(value) || arrayIncludesValue(clause.value, value))\n    );\n  }\n\n  addOrFieldValue(\n    field: string,\n    value: Value,\n    must = true,\n    operator: OperatorType = Operator.EQ\n  ) {\n    const existingClause = this.getOrFieldClause(field);\n    if (!existingClause) {\n      const newClause = must\n        ? Field.must[operator](field, [value])\n        : Field.mustNot[operator](field, [value]);\n      return new _AST([...this._clauses, newClause]);\n    }\n\n    const clauses = this._clauses.map((clause) => {\n      if (clause === existingClause) {\n        (clause.value as Value[]).push(value);\n      }\n      return clause;\n    });\n    return new _AST(clauses);\n  }\n\n  removeOrFieldValue(field: string, value: Value) {\n    const existingClause = this.getOrFieldClause(field, value);\n    if (!existingClause) {\n      return new _AST([...this._clauses]);\n    }\n    const clauses = this._clauses.reduce((clauses, clause) => {\n      if (clause !== existingClause) {\n        clauses.push(clause);\n        return clauses;\n      }\n      const filteredValue = (clause.value as Value[]).filter(\n        (val) => !valuesEqual(val, value)\n      );\n      if (filteredValue.length === 0) {\n        return clauses;\n      }\n      clauses.push({\n        ...clause,\n        value: filteredValue,\n      });\n      return clauses;\n    }, [] as Clause[]);\n    return new _AST(clauses);\n  }\n\n  removeOrFieldClauses(field: string) {\n    const clauses = this._clauses.filter((clause) => {\n      return (\n        !Field.isInstance(clause) ||\n        clause.field !== field ||\n        !isArray(clause.value)\n      );\n    });\n    return new _AST(clauses);\n  }\n\n  hasSimpleFieldClause(field: string, value?: Value) {\n    const clause = this.getFieldClause(\n      field,\n      (clause) => !isArray(clause.value)\n    );\n    if (!clause) {\n      return false;\n    }\n    return isNil(value) || valuesEqual(clause.value, value);\n  }\n\n  getSimpleFieldClause(field: string, value?: Value) {\n    return this.getFieldClause(\n      field,\n      (clause) =>\n        !isArray(clause.value) &&\n        (isNil(value) || valuesEqual(clause.value, value))\n    );\n  }\n\n  addSimpleFieldValue(\n    field: string,\n    value: Value,\n    must = true,\n    operator: OperatorType = Operator.EQ\n  ) {\n    const clause = must\n      ? Field.must[operator](field, value)\n      : Field.mustNot[operator](field, value);\n    return this.addClause(clause);\n  }\n\n  removeSimpleFieldValue(field: string, value: Value) {\n    const existingClause = this.getSimpleFieldClause(field, value);\n    if (!existingClause) {\n      return new _AST([...this._clauses]);\n    }\n    const clauses = this._clauses.filter((clause) => clause !== existingClause);\n    return new _AST(clauses);\n  }\n\n  removeSimpleFieldClauses(field: string) {\n    const clauses = this._clauses.filter((clause) => {\n      return (\n        !Field.isInstance(clause) ||\n        clause.field !== field ||\n        isArray(clause.value)\n      );\n    });\n    return new _AST(clauses);\n  }\n\n  getIsClauses() {\n    return Object.values(this._indexedClauses.is);\n  }\n\n  getIsClause(flag: string) {\n    return this._indexedClauses.is[flag];\n  }\n\n  removeIsClause(flag: string) {\n    return new _AST(\n      this._clauses.filter(\n        (clause) => !Is.isInstance(clause) || clause.flag !== flag\n      )\n    );\n  }\n\n  getGroupClauses() {\n    return Object.values(this._indexedClauses.group);\n  }\n\n  /**\n   * Creates and returns a new AST with the given clause added to the current clauses. If\n   * the current clauses already include a similar clause, it will be (in-place) replaced by\n   * the given clause. Whether a clause is similar to the given one depends on the type of the clause.\n   * Two clauses are similar if:\n   *\n   * - they are both of the same type\n   * - if they are `default` clauses, they must have the same value\n   * - if they are `term` clauses, they must have the same fields and values\n   * - if they are `is` clauses, they must have the same flags\n   *\n   * The reasoning behind not including the `match` attributes of the clauses in the rules above, stems\n   * in the fact that the AST clauses are ANDed, and having two similar clauses with two different\n   * match attributes creates a logically contradicted AST (e.g. what does it mean to\n   * \"(must have x) AND (must not have x)\"?)\n   *\n   * note:  in-place replacement means the given clause will be placed in the same position as the one it\n   *        replaced\n   */\n  addClause(newClause: Clause) {\n    let added = false;\n    const newClauses = this._clauses.reduce((clauses, clause) => {\n      if (newClause.type !== clause.type) {\n        clauses.push(clause);\n        return clauses;\n      }\n\n      switch (newClause.type) {\n        case Term.TYPE:\n          if (newClause.value !== (clause as TermClause).value) {\n            clauses.push(clause);\n            return clauses;\n          }\n          break;\n\n        case Field.TYPE:\n          if (\n            newClause.field !== (clause as FieldClause).field ||\n            newClause.value !== (clause as FieldClause).value\n          ) {\n            clauses.push(clause);\n            return clauses;\n          }\n          break;\n\n        case Is.TYPE:\n          if (newClause.flag !== (clause as IsClause).flag) {\n            clauses.push(clause);\n            return clauses;\n          }\n          break;\n\n        default:\n          throw new Error(`unknown clause type [${newClause.type}]`);\n      }\n      added = true;\n      clauses.push(newClause);\n      return clauses;\n    }, [] as Clause[]);\n\n    if (!added) {\n      newClauses.push(newClause);\n    }\n    return new _AST(newClauses);\n  }\n}\n\nexport const AST = Object.freeze({\n  Match,\n  Operator,\n  Term,\n  Group,\n  Field,\n  Is,\n  create: (clauses: Clause[]) => new _AST(clauses),\n});\n"]}]}