{"remainingRequest":"D:\\work\\eui\\node_modules\\babel-loader\\lib\\index.js??ref--4-1!D:\\work\\eui\\src\\components\\search_bar\\filters\\field_value_selection_filter.tsx","dependencies":[{"path":"D:\\work\\eui\\src\\components\\search_bar\\filters\\field_value_selection_filter.tsx","mtime":1649070093745},{"path":"D:\\work\\eui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1636976621750},{"path":"D:\\work\\eui\\node_modules\\babel-loader\\lib\\index.js","mtime":1649070120649}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:ZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgIkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjsgaWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfTsgfSByZXR1cm4gX3R5cGVvZihvYmopOyB9CgppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5jb25jYXQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maWx0ZXIiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mb3ItZWFjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluY2x1ZGVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc29tZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5wcm9taXNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pbmNsdWRlcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zdGFydHMtd2l0aCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2giOwoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pOyBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpZiAoaSAlIDIpIHsgb3duS2V5cyhPYmplY3Qoc291cmNlKSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KTsgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgeyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOyB9IGVsc2UgeyBvd25LZXlzKE9iamVjdChzb3VyY2UpKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IH0gcmV0dXJuIHRhcmdldDsgfQoKZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgeyByZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZCgpOyB9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQoKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpOyB9CgpmdW5jdGlvbiBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobywgbWluTGVuKSB7IGlmICghbykgcmV0dXJuOyBpZiAodHlwZW9mIG8gPT09ICJzdHJpbmciKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTsgdmFyIG4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpOyBpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTsgaWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKSByZXR1cm4gQXJyYXkuZnJvbShvKTsgaWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTsgfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7IGlmICh0eXBlb2YgU3ltYm9sICE9PSAidW5kZWZpbmVkIiAmJiBTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGl0ZXIpKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTsgfQoKZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikgeyBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkoYXJyKTsgfQoKZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4pIHsgaWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykgeyBhcnIyW2ldID0gYXJyW2ldOyB9IHJldHVybiBhcnIyOyB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9CgpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTsgfQoKZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IG8uX19wcm90b19fID0gcDsgcmV0dXJuIG87IH07IHJldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7IH0KCmZ1bmN0aW9uIF9jcmVhdGVTdXBlcihEZXJpdmVkKSB7IHZhciBoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0ID0gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpOyByZXR1cm4gZnVuY3Rpb24gX2NyZWF0ZVN1cGVySW50ZXJuYWwoKSB7IHZhciBTdXBlciA9IF9nZXRQcm90b3R5cGVPZihEZXJpdmVkKSwgcmVzdWx0OyBpZiAoaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCkgeyB2YXIgTmV3VGFyZ2V0ID0gX2dldFByb3RvdHlwZU9mKHRoaXMpLmNvbnN0cnVjdG9yOyByZXN1bHQgPSBSZWZsZWN0LmNvbnN0cnVjdChTdXBlciwgYXJndW1lbnRzLCBOZXdUYXJnZXQpOyB9IGVsc2UgeyByZXN1bHQgPSBTdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9IHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCByZXN1bHQpOyB9OyB9CgpmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7IGlmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsgcmV0dXJuIGNhbGw7IH0gcmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7IH0KCmZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikgeyBpZiAoc2VsZiA9PT0gdm9pZCAwKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7IH0gcmV0dXJuIHNlbGY7IH0KCmZ1bmN0aW9uIF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKSB7IGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gInVuZGVmaW5lZCIgfHwgIVJlZmxlY3QuY29uc3RydWN0KSByZXR1cm4gZmFsc2U7IGlmIChSZWZsZWN0LmNvbnN0cnVjdC5zaGFtKSByZXR1cm4gZmFsc2U7IGlmICh0eXBlb2YgUHJveHkgPT09ICJmdW5jdGlvbiIpIHJldHVybiB0cnVlOyB0cnkgeyBEYXRlLnByb3RvdHlwZS50b1N0cmluZy5jYWxsKFJlZmxlY3QuY29uc3RydWN0KERhdGUsIFtdLCBmdW5jdGlvbiAoKSB7fSkpOyByZXR1cm4gdHJ1ZTsgfSBjYXRjaCAoZSkgeyByZXR1cm4gZmFsc2U7IH0gfQoKZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgX2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgcmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTsgfTsgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsgfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgeyBpZiAoa2V5IGluIG9iaikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOyB9IGVsc2UgeyBvYmpba2V5XSA9IHZhbHVlOyB9IHJldHVybiBvYmo7IH0KCi8qCiAqIExpY2Vuc2VkIHRvIEVsYXN0aWNzZWFyY2ggQi5WLiB1bmRlciBvbmUgb3IgbW9yZSBjb250cmlidXRvcgogKiBsaWNlbnNlIGFncmVlbWVudHMuIFNlZSB0aGUgTk9USUNFIGZpbGUgZGlzdHJpYnV0ZWQgd2l0aAogKiB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24gcmVnYXJkaW5nIGNvcHlyaWdodAogKiBvd25lcnNoaXAuIEVsYXN0aWNzZWFyY2ggQi5WLiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyCiAqIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOyB5b3UgbWF5CiAqIG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwppbXBvcnQgUmVhY3QsIHsgQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnOwppbXBvcnQgUHJvcFR5cGVzIGZyb20gInByb3AtdHlwZXMiOwppbXBvcnQgeyBpc0FycmF5LCBpc05pbCB9IGZyb20gJy4uLy4uLy4uL3NlcnZpY2VzL3ByZWRpY2F0ZSc7CmltcG9ydCB7IGtleXMgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcyc7CmltcG9ydCB7IEV1aVBvcG92ZXIsIEV1aVBvcG92ZXJUaXRsZSB9IGZyb20gJy4uLy4uL3BvcG92ZXInOwppbXBvcnQgeyBFdWlGaWVsZFNlYXJjaCB9IGZyb20gJy4uLy4uL2Zvcm0vZmllbGRfc2VhcmNoJzsKaW1wb3J0IHsgRXVpRmlsdGVyQnV0dG9uLCBFdWlGaWx0ZXJTZWxlY3RJdGVtIH0gZnJvbSAnLi4vLi4vZmlsdGVyX2dyb3VwJzsKaW1wb3J0IHsgRXVpTG9hZGluZ0NoYXJ0IH0gZnJvbSAnLi4vLi4vbG9hZGluZyc7CmltcG9ydCB7IEV1aVNwYWNlciB9IGZyb20gJy4uLy4uL3NwYWNlcic7CmltcG9ydCB7IEV1aUljb24gfSBmcm9tICcuLi8uLi9pY29uJzsKaW1wb3J0IHsgUXVlcnkgfSBmcm9tICcuLi9xdWVyeSc7CmltcG9ydCB7IE9wZXJhdG9yIH0gZnJvbSAnLi4vcXVlcnkvYXN0JzsKdmFyIGRlZmF1bHRzID0gewogIGNvbmZpZzogewogICAgbXVsdGlTZWxlY3Q6IHRydWUsCiAgICBmaWx0ZXJXaXRoOiAncHJlZml4JywKICAgIGxvYWRpbmdNZXNzYWdlOiAnTG9hZGluZy4uLicsCiAgICBub09wdGlvbnNNZXNzYWdlOiAnTm8gb3B0aW9ucyBmb3VuZCcsCiAgICBzZWFyY2hUaHJlc2hvbGQ6IDEwCiAgfQp9OwpleHBvcnQgdmFyIEZpZWxkVmFsdWVTZWxlY3Rpb25GaWx0ZXIgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9Db21wb25lbnQpIHsKICBfaW5oZXJpdHMoRmllbGRWYWx1ZVNlbGVjdGlvbkZpbHRlciwgX0NvbXBvbmVudCk7CgogIHZhciBfc3VwZXIgPSBfY3JlYXRlU3VwZXIoRmllbGRWYWx1ZVNlbGVjdGlvbkZpbHRlcik7CgogIGZ1bmN0aW9uIEZpZWxkVmFsdWVTZWxlY3Rpb25GaWx0ZXIocHJvcHMpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRmllbGRWYWx1ZVNlbGVjdGlvbkZpbHRlcik7CgogICAgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBwcm9wcyk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAic2VsZWN0SXRlbXMiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInNlYXJjaElucHV0IiwgbnVsbCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAicmVzb2x2ZU9wdGlvbnNMb2FkZXIiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBvcHRpb25zID0gX3RoaXMucHJvcHMuY29uZmlnLm9wdGlvbnM7CgogICAgICBpZiAoaXNBcnJheShvcHRpb25zKSkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG9wdGlvbnMpOwogICAgICAgIH07CiAgICAgIH0KCiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGNhY2hlZE9wdGlvbnMgPSBfdGhpcy5zdGF0ZS5jYWNoZWRPcHRpb25zOwoKICAgICAgICBpZiAoY2FjaGVkT3B0aW9ucykgewogICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShjYWNoZWRPcHRpb25zKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBvcHRpb25zKCkudGhlbihmdW5jdGlvbiAob3B0cykgewogICAgICAgICAgLy8gSWYgYSBjYWNoZSB0aW1lIGlzIHNldCwgcG9wdWxhdGUgdGhlIGNhY2hlIGFuZCBhbHNvIHNjaGVkdWxlIGEKICAgICAgICAgIC8vIGNhY2hlIHJlc2V0LgogICAgICAgICAgaWYgKF90aGlzLnByb3BzLmNvbmZpZy5jYWNoZSAhPSBudWxsICYmIF90aGlzLnByb3BzLmNvbmZpZy5jYWNoZSA+IDApIHsKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgIGNhY2hlZE9wdGlvbnM6IG9wdHMKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBjYWNoZWRPcHRpb25zOiBudWxsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sIF90aGlzLnByb3BzLmNvbmZpZy5jYWNoZSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG9wdHM7CiAgICAgICAgfSk7CiAgICAgIH07CiAgICB9KTsKCiAgICB2YXIgX29wdGlvbnMgPSBwcm9wcy5jb25maWcub3B0aW9uczsKICAgIHZhciBwcmVsb2FkZWRPcHRpb25zID0gaXNBcnJheShfb3B0aW9ucykgPyB7CiAgICAgIGFsbDogX29wdGlvbnMsCiAgICAgIHNob3duOiBfb3B0aW9ucwogICAgfSA6IG51bGw7CiAgICBfdGhpcy5zZWxlY3RJdGVtcyA9IFtdOwogICAgX3RoaXMuc3RhdGUgPSB7CiAgICAgIHBvcG92ZXJPcGVuOiBmYWxzZSwKICAgICAgZXJyb3I6IG51bGwsCiAgICAgIG9wdGlvbnM6IHByZWxvYWRlZE9wdGlvbnMsCiAgICAgIGFjdGl2ZUl0ZW1zOiBbXQogICAgfTsKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhGaWVsZFZhbHVlU2VsZWN0aW9uRmlsdGVyLCBbewogICAga2V5OiAiY2xvc2VQb3BvdmVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjbG9zZVBvcG92ZXIoKSB7CiAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgIHBvcG92ZXJPcGVuOiBmYWxzZQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJvbkJ1dHRvbkNsaWNrIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvbkJ1dHRvbkNsaWNrKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHRoaXMuc2V0U3RhdGUoZnVuY3Rpb24gKHByZXZTdGF0ZSkgewogICAgICAgIGlmICghcHJldlN0YXRlLnBvcG92ZXJPcGVuKSB7CiAgICAgICAgICAvLyBsb2FkaW5nIG9wdGlvbnMgdXBkYXRlcyB0aGUgc3RhdGUsIHNvIHdlJ2xsIGRvIHRoYXQgaW4gdGhlIGFuaW1hdGlvbiBmcmFtZQogICAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzMi5sb2FkT3B0aW9ucygpOwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gewogICAgICAgICAgb3B0aW9uczogbnVsbCwKICAgICAgICAgIGVycm9yOiBudWxsLAogICAgICAgICAgcG9wb3Zlck9wZW46ICFwcmV2U3RhdGUucG9wb3Zlck9wZW4KICAgICAgICB9OwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJsb2FkT3B0aW9ucyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbG9hZE9wdGlvbnMoKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgdmFyIGxvYWRlciA9IHRoaXMucmVzb2x2ZU9wdGlvbnNMb2FkZXIoKTsKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgb3B0aW9uczogbnVsbCwKICAgICAgICBlcnJvcjogbnVsbAogICAgICB9KTsKICAgICAgbG9hZGVyKCkudGhlbihmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAgIHZhciBpdGVtcyA9IHsKICAgICAgICAgIG9uOiBbXSwKICAgICAgICAgIG9mZjogW10sCiAgICAgICAgICByZXN0OiBbXQogICAgICAgIH07CiAgICAgICAgdmFyIF90aGlzMyRwcm9wcyA9IF90aGlzMy5wcm9wcywKICAgICAgICAgICAgcXVlcnkgPSBfdGhpczMkcHJvcHMucXVlcnksCiAgICAgICAgICAgIGNvbmZpZyA9IF90aGlzMyRwcm9wcy5jb25maWc7CgogICAgICAgIHZhciBtdWx0aVNlbGVjdCA9IF90aGlzMy5yZXNvbHZlTXVsdGlTZWxlY3QoKTsKCiAgICAgICAgaWYgKG9wdGlvbnMpIHsKICAgICAgICAgIG9wdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAob3ApIHsKICAgICAgICAgICAgdmFyIG9wdGlvbkZpZWxkID0gb3AuZmllbGQgfHwgY29uZmlnLmZpZWxkOwoKICAgICAgICAgICAgaWYgKG9wdGlvbkZpZWxkKSB7CiAgICAgICAgICAgICAgdmFyIGNsYXVzZSA9IG11bHRpU2VsZWN0ID09PSAnb3InID8gcXVlcnkuZ2V0T3JGaWVsZENsYXVzZShvcHRpb25GaWVsZCwgb3AudmFsdWUpIDogcXVlcnkuZ2V0U2ltcGxlRmllbGRDbGF1c2Uob3B0aW9uRmllbGQsIG9wLnZhbHVlKTsKCiAgICAgICAgICAgICAgdmFyIGNoZWNrZWQgPSBfdGhpczMucmVzb2x2ZUNoZWNrZWQoY2xhdXNlKTsKCiAgICAgICAgICAgICAgaWYgKCFjaGVja2VkKSB7CiAgICAgICAgICAgICAgICBpdGVtcy5yZXN0LnB1c2gob3ApOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2hlY2tlZCA9PT0gJ29uJykgewogICAgICAgICAgICAgICAgaXRlbXMub24ucHVzaChvcCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGl0ZW1zLm9mZi5wdXNoKG9wKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgX3RoaXMzLnNldFN0YXRlKHsKICAgICAgICAgIGVycm9yOiBudWxsLAogICAgICAgICAgYWN0aXZlSXRlbXM6IGl0ZW1zLm9uLAogICAgICAgICAgb3B0aW9uczogewogICAgICAgICAgICBhbGw6IG9wdGlvbnMsCiAgICAgICAgICAgIHNob3duOiBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KGl0ZW1zLm9uKSwgX3RvQ29uc3VtYWJsZUFycmF5KGl0ZW1zLm9mZiksIF90b0NvbnN1bWFibGVBcnJheShpdGVtcy5yZXN0KSkKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMy5zZXRTdGF0ZSh7CiAgICAgICAgICBvcHRpb25zOiBudWxsLAogICAgICAgICAgZXJyb3I6ICdDb3VsZCBub3QgbG9hZCBvcHRpb25zJwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJmaWx0ZXJPcHRpb25zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmaWx0ZXJPcHRpb25zKCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIHZhciBxID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiAnJzsKICAgICAgdGhpcy5zZXRTdGF0ZShmdW5jdGlvbiAocHJldlN0YXRlKSB7CiAgICAgICAgaWYgKGlzTmlsKHByZXZTdGF0ZS5vcHRpb25zKSkgewogICAgICAgICAgcmV0dXJuIHt9OwogICAgICAgIH0KCiAgICAgICAgdmFyIHByZWRpY2F0ZSA9IF90aGlzNC5nZXRPcHRpb25GaWx0ZXIoKTsKCiAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgcHJldlN0YXRlKSwge30sIHsKICAgICAgICAgIG9wdGlvbnM6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgcHJldlN0YXRlLm9wdGlvbnMpLCB7fSwgewogICAgICAgICAgICBzaG93bjogcHJldlN0YXRlLm9wdGlvbnMuYWxsLmZpbHRlcihmdW5jdGlvbiAob3B0aW9uLCBpLCBvcHRpb25zKSB7CiAgICAgICAgICAgICAgdmFyIG5hbWUgPSBfdGhpczQucmVzb2x2ZU9wdGlvbk5hbWUob3B0aW9uKS50b0xvd2VyQ2FzZSgpOwoKICAgICAgICAgICAgICB2YXIgcXVlcnkgPSBxLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgcmV0dXJuIHByZWRpY2F0ZShuYW1lLCBxdWVyeSwgb3B0aW9ucyk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICB9KQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRPcHRpb25GaWx0ZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldE9wdGlvbkZpbHRlcigpIHsKICAgICAgdmFyIGZpbHRlcldpdGggPSB0aGlzLnByb3BzLmNvbmZpZy5maWx0ZXJXaXRoIHx8IGRlZmF1bHRzLmNvbmZpZy5maWx0ZXJXaXRoOwoKICAgICAgaWYgKHR5cGVvZiBmaWx0ZXJXaXRoID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgcmV0dXJuIGZpbHRlcldpdGg7CiAgICAgIH0KCiAgICAgIGlmIChmaWx0ZXJXaXRoID09PSAnaW5jbHVkZXMnKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChuYW1lLCBxdWVyeSkgewogICAgICAgICAgcmV0dXJuIG5hbWUuaW5jbHVkZXMocXVlcnkpOwogICAgICAgIH07CiAgICAgIH0KCiAgICAgIHJldHVybiBmdW5jdGlvbiAobmFtZSwgcXVlcnkpIHsKICAgICAgICByZXR1cm4gbmFtZS5zdGFydHNXaXRoKHF1ZXJ5KTsKICAgICAgfTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZXNvbHZlT3B0aW9uTmFtZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVzb2x2ZU9wdGlvbk5hbWUob3B0aW9uKSB7CiAgICAgIHJldHVybiBvcHRpb24ubmFtZSB8fCBvcHRpb24udmFsdWUudG9TdHJpbmcoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJvbk9wdGlvbkNsaWNrIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvbk9wdGlvbkNsaWNrKGZpZWxkLCB2YWx1ZSwgY2hlY2tlZCkgewogICAgICB2YXIgbXVsdGlTZWxlY3QgPSB0aGlzLnJlc29sdmVNdWx0aVNlbGVjdCgpOwogICAgICB2YXIgX3RoaXMkcHJvcHMkY29uZmlnID0gdGhpcy5wcm9wcy5jb25maWcsCiAgICAgICAgICBfdGhpcyRwcm9wcyRjb25maWckYXUgPSBfdGhpcyRwcm9wcyRjb25maWcuYXV0b0Nsb3NlLAogICAgICAgICAgYXV0b0Nsb3NlID0gX3RoaXMkcHJvcHMkY29uZmlnJGF1ID09PSB2b2lkIDAgPyB0cnVlIDogX3RoaXMkcHJvcHMkY29uZmlnJGF1LAogICAgICAgICAgX3RoaXMkcHJvcHMkY29uZmlnJG9wID0gX3RoaXMkcHJvcHMkY29uZmlnLm9wZXJhdG9yLAogICAgICAgICAgb3BlcmF0b3IgPSBfdGhpcyRwcm9wcyRjb25maWckb3AgPT09IHZvaWQgMCA/IE9wZXJhdG9yLkVRIDogX3RoaXMkcHJvcHMkY29uZmlnJG9wOyAvLyB3ZSdyZSBjbG9zaW5nIHBvcG92ZXIgb25seSBpZiB0aGUgdXNlciBjYW4gb25seSBzZWxlY3Qgb25lIGl0ZW0uLi4gaWYgdGhlCiAgICAgIC8vIHVzZXIgY2FuIHNlbGVjdCBtb3JlLCB3ZSdsbCBsZWF2ZSBpdCBvcGVuIHNvIHNoZSBjYW4gY29udGludWUgc2VsZWN0aW5nCgogICAgICBpZiAoIW11bHRpU2VsZWN0ICYmIGF1dG9DbG9zZSkgewogICAgICAgIHRoaXMuY2xvc2VQb3BvdmVyKCk7CgogICAgICAgIHZhciBfcXVlcnkgPSBjaGVja2VkID8gdGhpcy5wcm9wcy5xdWVyeS5yZW1vdmVTaW1wbGVGaWVsZENsYXVzZXMoZmllbGQpIDogdGhpcy5wcm9wcy5xdWVyeS5yZW1vdmVTaW1wbGVGaWVsZENsYXVzZXMoZmllbGQpLmFkZFNpbXBsZUZpZWxkVmFsdWUoZmllbGQsIHZhbHVlLCB0cnVlLCBvcGVyYXRvcik7CgogICAgICAgIHRoaXMucHJvcHMub25DaGFuZ2UoX3F1ZXJ5KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAobXVsdGlTZWxlY3QgPT09ICdvcicpIHsKICAgICAgICAgIHZhciBfcXVlcnkyID0gY2hlY2tlZCA/IHRoaXMucHJvcHMucXVlcnkucmVtb3ZlT3JGaWVsZFZhbHVlKGZpZWxkLCB2YWx1ZSkgOiB0aGlzLnByb3BzLnF1ZXJ5LmFkZE9yRmllbGRWYWx1ZShmaWVsZCwgdmFsdWUsIHRydWUsIG9wZXJhdG9yKTsKCiAgICAgICAgICB0aGlzLnByb3BzLm9uQ2hhbmdlKF9xdWVyeTIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgX3F1ZXJ5MyA9IGNoZWNrZWQgPyB0aGlzLnByb3BzLnF1ZXJ5LnJlbW92ZVNpbXBsZUZpZWxkVmFsdWUoZmllbGQsIHZhbHVlKSA6IHRoaXMucHJvcHMucXVlcnkuYWRkU2ltcGxlRmllbGRWYWx1ZShmaWVsZCwgdmFsdWUsIHRydWUsIG9wZXJhdG9yKTsKCiAgICAgICAgICB0aGlzLnByb3BzLm9uQ2hhbmdlKF9xdWVyeTMpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogIm9uS2V5RG93biIsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25LZXlEb3duKGluZGV4LCBldmVudCkgewogICAgICBzd2l0Y2ggKGV2ZW50LmtleSkgewogICAgICAgIGNhc2Uga2V5cy5BUlJPV19ET1dOOgogICAgICAgICAgaWYgKGluZGV4IDwgdGhpcy5zZWxlY3RJdGVtcy5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHRoaXMuc2VsZWN0SXRlbXNbaW5kZXggKyAxXS5mb2N1cygpOwogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIGtleXMuQVJST1dfVVA6CiAgICAgICAgICBpZiAoaW5kZXggPCAwKSB7CiAgICAgICAgICAgIHJldHVybjsgLy8gaXQncyBjb21pbmcgZnJvbSB0aGUgc2VhcmNoIGJveC4uLiBub3RoaW5nIHRvIGRvLi4uIG5vd2hlcmUgdG8gZ28KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoaW5kZXggPT09IDAgJiYgdGhpcy5zZWFyY2hJbnB1dCkgewogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB0aGlzLnNlYXJjaElucHV0LmZvY3VzKCk7CiAgICAgICAgICB9IGVsc2UgaWYgKGluZGV4ID4gMCkgewogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB0aGlzLnNlbGVjdEl0ZW1zW2luZGV4IC0gMV0uZm9jdXMoKTsKICAgICAgICAgIH0KCiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZXNvbHZlTXVsdGlTZWxlY3QiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlc29sdmVNdWx0aVNlbGVjdCgpIHsKICAgICAgdmFyIGNvbmZpZyA9IHRoaXMucHJvcHMuY29uZmlnOwogICAgICByZXR1cm4gIWlzTmlsKGNvbmZpZy5tdWx0aVNlbGVjdCkgPyBjb25maWcubXVsdGlTZWxlY3QgOiBkZWZhdWx0cy5jb25maWcubXVsdGlTZWxlY3Q7CiAgICB9CiAgfSwgewogICAga2V5OiAiY29tcG9uZW50RGlkTW91bnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudERpZE1vdW50KCkgewogICAgICBpZiAodGhpcy5wcm9wcy5xdWVyeS50ZXh0Lmxlbmd0aCkgdGhpcy5sb2FkT3B0aW9ucygpOwogICAgfQogIH0sIHsKICAgIGtleTogImNvbXBvbmVudERpZFVwZGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29tcG9uZW50RGlkVXBkYXRlKHByZXZQcm9wcykgewogICAgICBpZiAodGhpcy5wcm9wcy5xdWVyeSAhPT0gcHJldlByb3BzLnF1ZXJ5KSB0aGlzLmxvYWRPcHRpb25zKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgdmFyIF90aGlzJHByb3BzID0gdGhpcy5wcm9wcywKICAgICAgICAgIGluZGV4ID0gX3RoaXMkcHJvcHMuaW5kZXgsCiAgICAgICAgICBxdWVyeSA9IF90aGlzJHByb3BzLnF1ZXJ5LAogICAgICAgICAgY29uZmlnID0gX3RoaXMkcHJvcHMuY29uZmlnOwogICAgICB2YXIgbXVsdGlTZWxlY3QgPSB0aGlzLnJlc29sdmVNdWx0aVNlbGVjdCgpOwogICAgICB2YXIgYWN0aXZlVG9wID0gdGhpcy5pc0FjdGl2ZUZpZWxkKGNvbmZpZy5maWVsZCk7CiAgICAgIHZhciBhY3RpdmVJdGVtID0gdGhpcy5zdGF0ZS5vcHRpb25zID8gdGhpcy5zdGF0ZS5vcHRpb25zLmFsbC5zb21lKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIF90aGlzNS5pc0FjdGl2ZUZpZWxkKGl0ZW0uZmllbGQpOwogICAgICB9KSA6IGZhbHNlOwogICAgICB2YXIgYWN0aXZlID0gYWN0aXZlVG9wIHx8IGFjdGl2ZUl0ZW07CiAgICAgIHZhciBidXR0b24gPSAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChFdWlGaWx0ZXJCdXR0b24sIHsKICAgICAgICBpY29uVHlwZTogImFycm93RG93biIsCiAgICAgICAgaWNvblNpZGU6ICJyaWdodCIsCiAgICAgICAgb25DbGljazogdGhpcy5vbkJ1dHRvbkNsaWNrLmJpbmQodGhpcyksCiAgICAgICAgaGFzQWN0aXZlRmlsdGVyczogYWN0aXZlLAogICAgICAgIG51bUFjdGl2ZUZpbHRlcnM6IGFjdGl2ZSA/IHRoaXMuc3RhdGUuYWN0aXZlSXRlbXMubGVuZ3RoIDogdW5kZWZpbmVkLAogICAgICAgIGdyb3c6IHRydWUKICAgICAgfSwgY29uZmlnLm5hbWUpOwogICAgICB2YXIgc2VhcmNoQm94ID0gdGhpcy5yZW5kZXJTZWFyY2hCb3goKTsKICAgICAgdmFyIGNvbnRlbnQgPSB0aGlzLnJlbmRlckNvbnRlbnQoY29uZmlnLmZpZWxkLCBxdWVyeSwgY29uZmlnLCBtdWx0aVNlbGVjdCk7CiAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChFdWlQb3BvdmVyLCB7CiAgICAgICAgaWQ6ICIiLmNvbmNhdChjb25maWcudHlwZSwgIl8iKS5jb25jYXQoaW5kZXgpLAogICAgICAgIGJ1dHRvbjogYnV0dG9uLAogICAgICAgIGlzT3BlbjogdGhpcy5zdGF0ZS5wb3BvdmVyT3BlbiwKICAgICAgICBjbG9zZVBvcG92ZXI6IHRoaXMuY2xvc2VQb3BvdmVyLmJpbmQodGhpcyksCiAgICAgICAgcGFuZWxQYWRkaW5nU2l6ZTogIm5vbmUiLAogICAgICAgIGFuY2hvclBvc2l0aW9uOiAiZG93bkNlbnRlciIsCiAgICAgICAgcGFuZWxDbGFzc05hbWU6ICJldWlGaWx0ZXJHcm91cF9fcG9wb3ZlclBhbmVsIgogICAgICB9LCBzZWFyY2hCb3gsIGNvbnRlbnQpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlclNlYXJjaEJveCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyU2VhcmNoQm94KCkgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgIHZhciB0aHJlc2hvbGQgPSB0aGlzLnByb3BzLmNvbmZpZy5zZWFyY2hUaHJlc2hvbGQgfHwgZGVmYXVsdHMuY29uZmlnLnNlYXJjaFRocmVzaG9sZDsKCiAgICAgIGlmICh0aGlzLnN0YXRlLm9wdGlvbnMgJiYgdGhpcy5zdGF0ZS5vcHRpb25zLmFsbC5sZW5ndGggPj0gdGhyZXNob2xkKSB7CiAgICAgICAgdmFyIGRpc2FibGVkID0gdGhpcy5zdGF0ZS5lcnJvciAhPSBudWxsOwogICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChFdWlQb3BvdmVyVGl0bGUsIHsKICAgICAgICAgIHBhZGRpbmdTaXplOiAicyIKICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChFdWlGaWVsZFNlYXJjaCwgewogICAgICAgICAgaW5wdXRSZWY6IGZ1bmN0aW9uIGlucHV0UmVmKHJlZikgewogICAgICAgICAgICByZXR1cm4gX3RoaXM2LnNlYXJjaElucHV0ID0gcmVmOwogICAgICAgICAgfSwKICAgICAgICAgIGRpc2FibGVkOiBkaXNhYmxlZCwKICAgICAgICAgIGluY3JlbWVudGFsOiB0cnVlLAogICAgICAgICAgb25TZWFyY2g6IGZ1bmN0aW9uIG9uU2VhcmNoKHF1ZXJ5KSB7CiAgICAgICAgICAgIHJldHVybiBfdGhpczYuZmlsdGVyT3B0aW9ucyhxdWVyeSk7CiAgICAgICAgICB9LAogICAgICAgICAgb25LZXlEb3duOiB0aGlzLm9uS2V5RG93bi5iaW5kKHRoaXMsIC0xKSwKICAgICAgICAgIGNvbXByZXNzZWQ6IHRydWUKICAgICAgICB9KSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJDb250ZW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJDb250ZW50KGZpZWxkLCBxdWVyeSwgY29uZmlnLCBtdWx0aVNlbGVjdCkgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLnN0YXRlLmVycm9yKSB7CiAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyRXJyb3IodGhpcy5zdGF0ZS5lcnJvcik7CiAgICAgIH0KCiAgICAgIGlmIChpc05pbCh0aGlzLnN0YXRlLm9wdGlvbnMpKSB7CiAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyTG9hZGVyKCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnN0YXRlLm9wdGlvbnMuc2hvd24ubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyTm9PcHRpb25zKCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnN0YXRlLm9wdGlvbnMgPT0gbnVsbCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGl0ZW1zID0gW107CiAgICAgIHRoaXMuc3RhdGUub3B0aW9ucy5zaG93bi5mb3JFYWNoKGZ1bmN0aW9uIChvcHRpb24sIGluZGV4KSB7CiAgICAgICAgdmFyIG9wdGlvbkZpZWxkID0gb3B0aW9uLmZpZWxkIHx8IGZpZWxkOwoKICAgICAgICBpZiAob3B0aW9uRmllbGQgPT0gbnVsbCkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdvcHRpb24uZmllbGQgb3IgZmllbGQgc2hvdWxkIGJlIHByb3ZpZGVkIGluIDxGaWVsZFZhbHVlU2VsZWN0aW9uRmlsdGVyLz4nKTsKICAgICAgICB9CgogICAgICAgIHZhciBjbGF1c2UgPSBtdWx0aVNlbGVjdCA9PT0gJ29yJyA/IHF1ZXJ5LmdldE9yRmllbGRDbGF1c2Uob3B0aW9uRmllbGQsIG9wdGlvbi52YWx1ZSkgOiBxdWVyeS5nZXRTaW1wbGVGaWVsZENsYXVzZShvcHRpb25GaWVsZCwgb3B0aW9uLnZhbHVlKTsKCiAgICAgICAgdmFyIGNoZWNrZWQgPSBfdGhpczcucmVzb2x2ZUNoZWNrZWQoY2xhdXNlKTsKCiAgICAgICAgdmFyIG9uQ2xpY2sgPSBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgLy8gY2xpY2tpbmcgYSBjaGVja2VkIGl0ZW0gd2lsbCB1bmNoZWNrIGl0IGFuZCBlZmZlY3RpdmUgcmVtb3ZlIHRoZSBmaWx0ZXIgKHZhbHVlID0gdW5kZWZpbmVkKQogICAgICAgICAgX3RoaXM3Lm9uT3B0aW9uQ2xpY2sob3B0aW9uRmllbGQsIG9wdGlvbi52YWx1ZSwgY2hlY2tlZCk7CiAgICAgICAgfTsKCiAgICAgICAgdmFyIGl0ZW0gPSAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChFdWlGaWx0ZXJTZWxlY3RJdGVtLCB7CiAgICAgICAgICBrZXk6IGluZGV4LAogICAgICAgICAgY2hlY2tlZDogY2hlY2tlZCwKICAgICAgICAgIG9uQ2xpY2s6IG9uQ2xpY2ssCiAgICAgICAgICByZWY6IGZ1bmN0aW9uIHJlZihfcmVmKSB7CiAgICAgICAgICAgIHJldHVybiBfdGhpczcuc2VsZWN0SXRlbXNbaW5kZXhdID0gX3JlZjsKICAgICAgICAgIH0sCiAgICAgICAgICBvbktleURvd246IF90aGlzNy5vbktleURvd24uYmluZChfdGhpczcsIGluZGV4KQogICAgICAgIH0sIG9wdGlvbi52aWV3ID8gb3B0aW9uLnZpZXcgOiBfdGhpczcucmVzb2x2ZU9wdGlvbk5hbWUob3B0aW9uKSk7CiAgICAgICAgaXRlbXMucHVzaChpdGVtKTsKICAgICAgfSk7CiAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgIGNsYXNzTmFtZTogImV1aUZpbHRlclNlbGVjdF9faXRlbXMiCiAgICAgIH0sIGl0ZW1zKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZXNvbHZlQ2hlY2tlZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVzb2x2ZUNoZWNrZWQoY2xhdXNlKSB7CiAgICAgIGlmIChjbGF1c2UpIHsKICAgICAgICByZXR1cm4gUXVlcnkuaXNNdXN0KGNsYXVzZSkgPyAnb24nIDogJ29mZic7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJMb2FkZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlckxvYWRlcigpIHsKICAgICAgdmFyIG1lc3NhZ2UgPSB0aGlzLnByb3BzLmNvbmZpZy5sb2FkaW5nTWVzc2FnZSB8fCBkZWZhdWx0cy5jb25maWcubG9hZGluZ01lc3NhZ2U7CiAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgIGNsYXNzTmFtZTogImV1aUZpbHRlclNlbGVjdF9fbm90ZSIKICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICBjbGFzc05hbWU6ICJldWlGaWx0ZXJTZWxlY3RfX25vdGVDb250ZW50IgogICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChFdWlMb2FkaW5nQ2hhcnQsIHsKICAgICAgICBzaXplOiAibSIKICAgICAgfSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KEV1aVNwYWNlciwgewogICAgICAgIHNpemU6ICJ4cyIKICAgICAgfSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJwIiwgbnVsbCwgbWVzc2FnZSkpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJFcnJvciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyRXJyb3IobWVzc2FnZSkgewogICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICBjbGFzc05hbWU6ICJldWlGaWx0ZXJTZWxlY3RfX25vdGUiCiAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgY2xhc3NOYW1lOiAiZXVpRmlsdGVyU2VsZWN0X19ub3RlQ29udGVudCIKICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoRXVpSWNvbiwgewogICAgICAgIHNpemU6ICJtIiwKICAgICAgICB0eXBlOiAiZmFjZVNhZCIsCiAgICAgICAgY29sb3I6ICJkYW5nZXIiCiAgICAgIH0pLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChFdWlTcGFjZXIsIHsKICAgICAgICBzaXplOiAieHMiCiAgICAgIH0pLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgicCIsIG51bGwsIG1lc3NhZ2UpKSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyTm9PcHRpb25zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJOb09wdGlvbnMoKSB7CiAgICAgIHZhciBtZXNzYWdlID0gdGhpcy5wcm9wcy5jb25maWcubm9PcHRpb25zTWVzc2FnZSB8fCBkZWZhdWx0cy5jb25maWcubm9PcHRpb25zTWVzc2FnZTsKICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgY2xhc3NOYW1lOiAiZXVpRmlsdGVyU2VsZWN0X19ub3RlIgogICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgIGNsYXNzTmFtZTogImV1aUZpbHRlclNlbGVjdF9fbm90ZUNvbnRlbnQiCiAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KEV1aUljb24sIHsKICAgICAgICB0eXBlOiAibWludXNJbkNpcmNsZSIKICAgICAgfSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KEV1aVNwYWNlciwgewogICAgICAgIHNpemU6ICJ4cyIKICAgICAgfSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJwIiwgbnVsbCwgbWVzc2FnZSkpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJpc0FjdGl2ZUZpZWxkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpc0FjdGl2ZUZpZWxkKGZpZWxkKSB7CiAgICAgIGlmICh0eXBlb2YgZmllbGQgIT09ICdzdHJpbmcnKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICB2YXIgcXVlcnkgPSB0aGlzLnByb3BzLnF1ZXJ5OwogICAgICB2YXIgbXVsdGlTZWxlY3QgPSB0aGlzLnJlc29sdmVNdWx0aVNlbGVjdCgpOwoKICAgICAgaWYgKG11bHRpU2VsZWN0ID09PSAnb3InKSB7CiAgICAgICAgcmV0dXJuIHF1ZXJ5Lmhhc09yRmllbGRDbGF1c2UoZmllbGQpOwogICAgICB9CgogICAgICByZXR1cm4gcXVlcnkuaGFzU2ltcGxlRmllbGRDbGF1c2UoZmllbGQpOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIEZpZWxkVmFsdWVTZWxlY3Rpb25GaWx0ZXI7Cn0oQ29tcG9uZW50KTsKRmllbGRWYWx1ZVNlbGVjdGlvbkZpbHRlci5wcm9wVHlwZXMgPSB7CiAgaW5kZXg6IFByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZCwKICBjb25maWc6IFByb3BUeXBlcy5zaGFwZSh7CiAgICB0eXBlOiBQcm9wVHlwZXMub25lT2YoWyJmaWVsZF92YWx1ZV9zZWxlY3Rpb24iXSkuaXNSZXF1aXJlZCwKICAgIGZpZWxkOiBQcm9wVHlwZXMuc3RyaW5nLAogICAgbmFtZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLAoKICAgIC8qKgogICAgICAgKiBTZWUgI0ZpZWxkVmFsdWVPcHRpb25UeXBlCiAgICAgICAqLwogICAgb3B0aW9uczogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLmFycmF5T2YoUHJvcFR5cGVzLnNoYXBlKHsKICAgICAgZmllbGQ6IFByb3BUeXBlcy5zdHJpbmcsCiAgICAgIHZhbHVlOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsIFByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZCwgUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCwgUHJvcFR5cGVzLnNoYXBlKHsKICAgICAgICB0eXBlOiBQcm9wVHlwZXMub25lT2YoWyJkYXRlIl0pLmlzUmVxdWlyZWQsCiAgICAgICAgcmF3OiBQcm9wVHlwZXMuYW55LmlzUmVxdWlyZWQsCiAgICAgICAgZ3JhbnVsYXJpdHk6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1Byb3BUeXBlcy5zaGFwZSh7CiAgICAgICAgICBlczogUHJvcFR5cGVzLm9uZU9mKFsiZCIsICJ3IiwgIk0iLCAieSJdKS5pc1JlcXVpcmVkLAogICAgICAgICAganM6IFByb3BUeXBlcy5vbmVPZihbImRheSIsICJ3ZWVrIiwgIm1vbnRoIiwgInllYXIiXSkuaXNSZXF1aXJlZCwKICAgICAgICAgIGlzU2FtZTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCwKICAgICAgICAgIHN0YXJ0OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLAogICAgICAgICAgc3RhcnRPZk5leHQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsCiAgICAgICAgICBpc284NjAxOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkCiAgICAgICAgfSkuaXNSZXF1aXJlZCwgUHJvcFR5cGVzLm9uZU9mKFt1bmRlZmluZWRdKV0pLmlzUmVxdWlyZWQsCiAgICAgICAgdGV4dDogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLAogICAgICAgIHJlc29sdmU6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQKICAgICAgfSkuaXNSZXF1aXJlZF0pLmlzUmVxdWlyZWQsCiAgICAgIG5hbWU6IFByb3BUeXBlcy5zdHJpbmcsCiAgICAgIHZpZXc6IFByb3BUeXBlcy5ub2RlCiAgICB9KS5pc1JlcXVpcmVkKS5pc1JlcXVpcmVkLCBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkXSkuaXNSZXF1aXJlZCwKICAgIGZpbHRlcldpdGg6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1Byb3BUeXBlcy5vbmVPZihbInByZWZpeCIsICJpbmNsdWRlcyJdKSwgUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZF0pLAogICAgY2FjaGU6IFByb3BUeXBlcy5udW1iZXIsCiAgICBtdWx0aVNlbGVjdDogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCwgUHJvcFR5cGVzLm9uZU9mKFsiYW5kIiwgIm9yIl0pXSksCiAgICBsb2FkaW5nTWVzc2FnZTogUHJvcFR5cGVzLnN0cmluZywKICAgIG5vT3B0aW9uc01lc3NhZ2U6IFByb3BUeXBlcy5zdHJpbmcsCiAgICBzZWFyY2hUaHJlc2hvbGQ6IFByb3BUeXBlcy5udW1iZXIsCiAgICBhdmFpbGFibGU6IFByb3BUeXBlcy5mdW5jLAogICAgYXV0b0Nsb3NlOiBQcm9wVHlwZXMuYm9vbCwKICAgIG9wZXJhdG9yOiBQcm9wVHlwZXMub25lT2YoWyJlcSIsICJleGFjdCIsICJndCIsICJndGUiLCAibHQiLCAibHRlIl0pCiAgfSkuaXNSZXF1aXJlZCwKICBxdWVyeTogUHJvcFR5cGVzLmFueS5pc1JlcXVpcmVkLAogIG9uQ2hhbmdlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkCn07Cgp0cnkgewogIEZpZWxkVmFsdWVTZWxlY3Rpb25GaWx0ZXIuX19kb2NnZW5JbmZvID0gewogICAgZGVzY3JpcHRpb246ICcnLAogICAgZGlzcGxheU5hbWU6ICdGaWVsZFZhbHVlU2VsZWN0aW9uRmlsdGVyJywKICAgIG1ldGhvZHM6IFtdLAogICAgcHJvcHM6IHsKICAgICAgaW5kZXg6IHsKICAgICAgICBkZWZhdWx0VmFsdWU6IG51bGwsCiAgICAgICAgZGVzY3JpcHRpb246ICcnLAogICAgICAgIG5hbWU6ICdpbmRleCcsCiAgICAgICAgcGFyZW50OiB7CiAgICAgICAgICBmaWxlTmFtZTogJ2V1aS9zcmMvY29tcG9uZW50cy9zZWFyY2hfYmFyL2ZpbHRlcnMvZmllbGRfdmFsdWVfc2VsZWN0aW9uX2ZpbHRlci50c3gnLAogICAgICAgICAgbmFtZTogJ0ZpZWxkVmFsdWVTZWxlY3Rpb25GaWx0ZXJQcm9wcycKICAgICAgICB9LAogICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgIG5hbWU6ICdudW1iZXInCiAgICAgICAgfQogICAgICB9LAogICAgICBjb25maWc6IHsKICAgICAgICBkZWZhdWx0VmFsdWU6IG51bGwsCiAgICAgICAgZGVzY3JpcHRpb246ICcnLAogICAgICAgIG5hbWU6ICdjb25maWcnLAogICAgICAgIHBhcmVudDogewogICAgICAgICAgZmlsZU5hbWU6ICdldWkvc3JjL2NvbXBvbmVudHMvc2VhcmNoX2Jhci9maWx0ZXJzL2ZpZWxkX3ZhbHVlX3NlbGVjdGlvbl9maWx0ZXIudHN4JywKICAgICAgICAgIG5hbWU6ICdGaWVsZFZhbHVlU2VsZWN0aW9uRmlsdGVyUHJvcHMnCiAgICAgICAgfSwKICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICBuYW1lOiAnRmllbGRWYWx1ZVNlbGVjdGlvbkZpbHRlckNvbmZpZ1R5cGUnCiAgICAgICAgfQogICAgICB9LAogICAgICBxdWVyeTogewogICAgICAgIGRlZmF1bHRWYWx1ZTogbnVsbCwKICAgICAgICBkZXNjcmlwdGlvbjogJycsCiAgICAgICAgbmFtZTogJ3F1ZXJ5JywKICAgICAgICBwYXJlbnQ6IHsKICAgICAgICAgIGZpbGVOYW1lOiAnZXVpL3NyYy9jb21wb25lbnRzL3NlYXJjaF9iYXIvZmlsdGVycy9maWVsZF92YWx1ZV9zZWxlY3Rpb25fZmlsdGVyLnRzeCcsCiAgICAgICAgICBuYW1lOiAnRmllbGRWYWx1ZVNlbGVjdGlvbkZpbHRlclByb3BzJwogICAgICAgIH0sCiAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgdHlwZTogewogICAgICAgICAgbmFtZTogJ1F1ZXJ5JwogICAgICAgIH0KICAgICAgfSwKICAgICAgb25DaGFuZ2U6IHsKICAgICAgICBkZWZhdWx0VmFsdWU6IG51bGwsCiAgICAgICAgZGVzY3JpcHRpb246ICcnLAogICAgICAgIG5hbWU6ICdvbkNoYW5nZScsCiAgICAgICAgcGFyZW50OiB7CiAgICAgICAgICBmaWxlTmFtZTogJ2V1aS9zcmMvY29tcG9uZW50cy9zZWFyY2hfYmFyL2ZpbHRlcnMvZmllbGRfdmFsdWVfc2VsZWN0aW9uX2ZpbHRlci50c3gnLAogICAgICAgICAgbmFtZTogJ0ZpZWxkVmFsdWVTZWxlY3Rpb25GaWx0ZXJQcm9wcycKICAgICAgICB9LAogICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgIG5hbWU6ICcocXVlcnk6IFF1ZXJ5KSA9PiB2b2lkJwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGV4dGVuZGVkSW50ZXJmYWNlczogWydGaWVsZFZhbHVlU2VsZWN0aW9uRmlsdGVyUHJvcHMnXQogIH07Cn0gY2F0Y2ggKGUpIHt9"},{"version":3,"sources":["D:/work/eui/src/components/search_bar/filters/field_value_selection_filter.tsx"],"names":["React","Component","isArray","isNil","keys","EuiPopover","EuiPopoverTitle","EuiFieldSearch","EuiFilterButton","EuiFilterSelectItem","EuiLoadingChart","EuiSpacer","EuiIcon","Query","Operator","defaults","config","multiSelect","filterWith","loadingMessage","noOptionsMessage","searchThreshold","FieldValueSelectionFilter","props","options","Promise","resolve","cachedOptions","state","then","opts","cache","setState","setTimeout","preloadedOptions","all","shown","selectItems","popoverOpen","error","activeItems","prevState","window","requestAnimationFrame","loadOptions","loader","resolveOptionsLoader","items","on","off","rest","query","resolveMultiSelect","forEach","op","optionField","field","clause","getOrFieldClause","value","getSimpleFieldClause","checked","resolveChecked","push","catch","q","predicate","getOptionFilter","filter","option","i","name","resolveOptionName","toLowerCase","includes","startsWith","toString","autoClose","operator","EQ","closePopover","removeSimpleFieldClauses","addSimpleFieldValue","onChange","removeOrFieldValue","addOrFieldValue","removeSimpleFieldValue","index","event","key","ARROW_DOWN","length","preventDefault","focus","ARROW_UP","searchInput","text","prevProps","activeTop","isActiveField","activeItem","some","item","active","button","onButtonClick","bind","undefined","searchBox","renderSearchBox","content","renderContent","type","threshold","disabled","ref","filterOptions","onKeyDown","renderError","renderLoader","renderNoOptions","Error","onClick","onOptionClick","view","isMust","message","hasOrFieldClause","hasSimpleFieldClause"],"mappings":"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","sourcesContent":["/*\n * Licensed to Elasticsearch B.V. under one or more contributor\n * license agreements. See the NOTICE file distributed with\n * this work for additional information regarding copyright\n * ownership. Elasticsearch B.V. licenses this file to you under\n * the Apache License, Version 2.0 (the \"License\"); you may\n * not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { Component } from 'react';\nimport PropTypes from \"prop-types\";\nimport { isArray, isNil } from '../../../services/predicate';\nimport { keys } from '../../../services';\nimport { EuiPopover, EuiPopoverTitle } from '../../popover';\nimport { EuiFieldSearch } from '../../form/field_search';\nimport { EuiFilterButton, EuiFilterSelectItem } from '../../filter_group';\nimport { EuiLoadingChart } from '../../loading';\nimport { EuiSpacer } from '../../spacer';\nimport { EuiIcon } from '../../icon';\nimport { Query } from '../query';\nimport { Operator } from '../query/ast';\nvar defaults = {\n  config: {\n    multiSelect: true,\n    filterWith: 'prefix',\n    loadingMessage: 'Loading...',\n    noOptionsMessage: 'No options found',\n    searchThreshold: 10\n  }\n};\nexport class FieldValueSelectionFilter extends Component {\n  searchInput = null;\n\n  constructor(props) {\n    super(props);\n    const {\n      options\n    } = props.config;\n    const preloadedOptions = isArray(options) ? {\n      all: options,\n      shown: options\n    } : null;\n    this.selectItems = [];\n    this.state = {\n      popoverOpen: false,\n      error: null,\n      options: preloadedOptions,\n      activeItems: []\n    };\n  }\n\n  closePopover() {\n    this.setState({\n      popoverOpen: false\n    });\n  }\n\n  onButtonClick() {\n    this.setState(prevState => {\n      if (!prevState.popoverOpen) {\n        // loading options updates the state, so we'll do that in the animation frame\n        window.requestAnimationFrame(() => {\n          this.loadOptions();\n        });\n      }\n\n      return {\n        options: null,\n        error: null,\n        popoverOpen: !prevState.popoverOpen\n      };\n    });\n  }\n\n  loadOptions() {\n    const loader = this.resolveOptionsLoader();\n    this.setState({\n      options: null,\n      error: null\n    });\n    loader().then(options => {\n      const items = {\n        on: [],\n        off: [],\n        rest: []\n      };\n      const {\n        query,\n        config\n      } = this.props;\n      const multiSelect = this.resolveMultiSelect();\n\n      if (options) {\n        options.forEach(op => {\n          const optionField = op.field || config.field;\n\n          if (optionField) {\n            const clause = multiSelect === 'or' ? query.getOrFieldClause(optionField, op.value) : query.getSimpleFieldClause(optionField, op.value);\n            const checked = this.resolveChecked(clause);\n\n            if (!checked) {\n              items.rest.push(op);\n            } else if (checked === 'on') {\n              items.on.push(op);\n            } else {\n              items.off.push(op);\n            }\n          }\n\n          return;\n        });\n      }\n\n      this.setState({\n        error: null,\n        activeItems: items.on,\n        options: {\n          all: options,\n          shown: [...items.on, ...items.off, ...items.rest]\n        }\n      });\n    }).catch(() => {\n      this.setState({\n        options: null,\n        error: 'Could not load options'\n      });\n    });\n  }\n\n  filterOptions(q = '') {\n    this.setState(prevState => {\n      if (isNil(prevState.options)) {\n        return {};\n      }\n\n      const predicate = this.getOptionFilter();\n      return { ...prevState,\n        options: { ...prevState.options,\n          shown: prevState.options.all.filter((option, i, options) => {\n            const name = this.resolveOptionName(option).toLowerCase();\n            const query = q.toLowerCase();\n            return predicate(name, query, options);\n          })\n        }\n      };\n    });\n  }\n\n  getOptionFilter() {\n    const filterWith = this.props.config.filterWith || defaults.config.filterWith;\n\n    if (typeof filterWith === 'function') {\n      return filterWith;\n    }\n\n    if (filterWith === 'includes') {\n      return (name, query) => name.includes(query);\n    }\n\n    return (name, query) => name.startsWith(query);\n  }\n\n  resolveOptionsLoader = () => {\n    const options = this.props.config.options;\n\n    if (isArray(options)) {\n      return () => Promise.resolve(options);\n    }\n\n    return () => {\n      const cachedOptions = this.state.cachedOptions;\n\n      if (cachedOptions) {\n        return Promise.resolve(cachedOptions);\n      }\n\n      return options().then(opts => {\n        // If a cache time is set, populate the cache and also schedule a\n        // cache reset.\n        if (this.props.config.cache != null && this.props.config.cache > 0) {\n          this.setState({\n            cachedOptions: opts\n          });\n          setTimeout(() => {\n            this.setState({\n              cachedOptions: null\n            });\n          }, this.props.config.cache);\n        }\n\n        return opts;\n      });\n    };\n  };\n\n  resolveOptionName(option) {\n    return option.name || option.value.toString();\n  }\n\n  onOptionClick(field, value, checked) {\n    const multiSelect = this.resolveMultiSelect();\n    const {\n      config: {\n        autoClose = true,\n        operator = Operator.EQ\n      }\n    } = this.props; // we're closing popover only if the user can only select one item... if the\n    // user can select more, we'll leave it open so she can continue selecting\n\n    if (!multiSelect && autoClose) {\n      this.closePopover();\n      const query = checked ? this.props.query.removeSimpleFieldClauses(field) : this.props.query.removeSimpleFieldClauses(field).addSimpleFieldValue(field, value, true, operator);\n      this.props.onChange(query);\n    } else {\n      if (multiSelect === 'or') {\n        const query = checked ? this.props.query.removeOrFieldValue(field, value) : this.props.query.addOrFieldValue(field, value, true, operator);\n        this.props.onChange(query);\n      } else {\n        const query = checked ? this.props.query.removeSimpleFieldValue(field, value) : this.props.query.addSimpleFieldValue(field, value, true, operator);\n        this.props.onChange(query);\n      }\n    }\n  }\n\n  onKeyDown(index, event) {\n    switch (event.key) {\n      case keys.ARROW_DOWN:\n        if (index < this.selectItems.length - 1) {\n          event.preventDefault();\n          this.selectItems[index + 1].focus();\n        }\n\n        break;\n\n      case keys.ARROW_UP:\n        if (index < 0) {\n          return; // it's coming from the search box... nothing to do... nowhere to go\n        }\n\n        if (index === 0 && this.searchInput) {\n          event.preventDefault();\n          this.searchInput.focus();\n        } else if (index > 0) {\n          event.preventDefault();\n          this.selectItems[index - 1].focus();\n        }\n\n    }\n  }\n\n  resolveMultiSelect() {\n    const {\n      config\n    } = this.props;\n    return !isNil(config.multiSelect) ? config.multiSelect : defaults.config.multiSelect;\n  }\n\n  componentDidMount() {\n    if (this.props.query.text.length) this.loadOptions();\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.query !== prevProps.query) this.loadOptions();\n  }\n\n  render() {\n    const {\n      index,\n      query,\n      config\n    } = this.props;\n    const multiSelect = this.resolveMultiSelect();\n    const activeTop = this.isActiveField(config.field);\n    const activeItem = this.state.options ? this.state.options.all.some(item => this.isActiveField(item.field)) : false;\n    const active = activeTop || activeItem;\n    const button = <EuiFilterButton iconType=\"arrowDown\" iconSide=\"right\" onClick={this.onButtonClick.bind(this)} hasActiveFilters={active} numActiveFilters={active ? this.state.activeItems.length : undefined} grow>\n        {config.name}\n      </EuiFilterButton>;\n    const searchBox = this.renderSearchBox();\n    const content = this.renderContent(config.field, query, config, multiSelect);\n    return <EuiPopover id={`${config.type}_${index}`} button={button} isOpen={this.state.popoverOpen} closePopover={this.closePopover.bind(this)} panelPaddingSize=\"none\" anchorPosition=\"downCenter\" panelClassName=\"euiFilterGroup__popoverPanel\">\n        {searchBox}\n        {content}\n      </EuiPopover>;\n  }\n\n  renderSearchBox() {\n    const threshold = this.props.config.searchThreshold || defaults.config.searchThreshold;\n\n    if (this.state.options && this.state.options.all.length >= threshold) {\n      const disabled = this.state.error != null;\n      return <EuiPopoverTitle paddingSize=\"s\">\n          <EuiFieldSearch inputRef={ref => this.searchInput = ref} disabled={disabled} incremental={true} onSearch={query => this.filterOptions(query)} onKeyDown={this.onKeyDown.bind(this, -1)} compressed />\n        </EuiPopoverTitle>;\n    }\n  }\n\n  renderContent(field, query, config, multiSelect) {\n    if (this.state.error) {\n      return this.renderError(this.state.error);\n    }\n\n    if (isNil(this.state.options)) {\n      return this.renderLoader();\n    }\n\n    if (this.state.options.shown.length === 0) {\n      return this.renderNoOptions();\n    }\n\n    if (this.state.options == null) {\n      return;\n    }\n\n    const items = [];\n    this.state.options.shown.forEach((option, index) => {\n      const optionField = option.field || field;\n\n      if (optionField == null) {\n        throw new Error('option.field or field should be provided in <FieldValueSelectionFilter/>');\n      }\n\n      const clause = multiSelect === 'or' ? query.getOrFieldClause(optionField, option.value) : query.getSimpleFieldClause(optionField, option.value);\n      const checked = this.resolveChecked(clause);\n\n      const onClick = () => {\n        // clicking a checked item will uncheck it and effective remove the filter (value = undefined)\n        this.onOptionClick(optionField, option.value, checked);\n      };\n\n      const item = <EuiFilterSelectItem key={index} checked={checked} onClick={onClick} ref={ref => this.selectItems[index] = ref} onKeyDown={this.onKeyDown.bind(this, index)}>\n          {option.view ? option.view : this.resolveOptionName(option)}\n        </EuiFilterSelectItem>;\n      items.push(item);\n    });\n    return <div className=\"euiFilterSelect__items\">{items}</div>;\n  }\n\n  resolveChecked(clause) {\n    if (clause) {\n      return Query.isMust(clause) ? 'on' : 'off';\n    }\n  }\n\n  renderLoader() {\n    const message = this.props.config.loadingMessage || defaults.config.loadingMessage;\n    return <div className=\"euiFilterSelect__note\">\n        <div className=\"euiFilterSelect__noteContent\">\n          <EuiLoadingChart size=\"m\" />\n          <EuiSpacer size=\"xs\" />\n          <p>{message}</p>\n        </div>\n      </div>;\n  }\n\n  renderError(message) {\n    return <div className=\"euiFilterSelect__note\">\n        <div className=\"euiFilterSelect__noteContent\">\n          <EuiIcon size=\"m\" type=\"faceSad\" color=\"danger\" />\n          <EuiSpacer size=\"xs\" />\n          <p>{message}</p>\n        </div>\n      </div>;\n  }\n\n  renderNoOptions() {\n    const message = this.props.config.noOptionsMessage || defaults.config.noOptionsMessage;\n    return <div className=\"euiFilterSelect__note\">\n        <div className=\"euiFilterSelect__noteContent\">\n          <EuiIcon type=\"minusInCircle\" />\n          <EuiSpacer size=\"xs\" />\n          <p>{message}</p>\n        </div>\n      </div>;\n  }\n\n  isActiveField(field) {\n    if (typeof field !== 'string') {\n      return false;\n    }\n\n    const {\n      query\n    } = this.props;\n    const multiSelect = this.resolveMultiSelect();\n\n    if (multiSelect === 'or') {\n      return query.hasOrFieldClause(field);\n    }\n\n    return query.hasSimpleFieldClause(field);\n  }\n\n}\nFieldValueSelectionFilter.propTypes = {\n  index: PropTypes.number.isRequired,\n  config: PropTypes.shape({\n    type: PropTypes.oneOf([\"field_value_selection\"]).isRequired,\n    field: PropTypes.string,\n    name: PropTypes.string.isRequired,\n\n    /**\n       * See #FieldValueOptionType\n       */\n    options: PropTypes.oneOfType([PropTypes.arrayOf(PropTypes.shape({\n      field: PropTypes.string,\n      value: PropTypes.oneOfType([PropTypes.string.isRequired, PropTypes.number.isRequired, PropTypes.bool.isRequired, PropTypes.shape({\n        type: PropTypes.oneOf([\"date\"]).isRequired,\n        raw: PropTypes.any.isRequired,\n        granularity: PropTypes.oneOfType([PropTypes.shape({\n          es: PropTypes.oneOf([\"d\", \"w\", \"M\", \"y\"]).isRequired,\n          js: PropTypes.oneOf([\"day\", \"week\", \"month\", \"year\"]).isRequired,\n          isSame: PropTypes.func.isRequired,\n          start: PropTypes.func.isRequired,\n          startOfNext: PropTypes.func.isRequired,\n          iso8601: PropTypes.func.isRequired\n        }).isRequired, PropTypes.oneOf([undefined])]).isRequired,\n        text: PropTypes.string.isRequired,\n        resolve: PropTypes.func.isRequired\n      }).isRequired]).isRequired,\n      name: PropTypes.string,\n      view: PropTypes.node\n    }).isRequired).isRequired, PropTypes.func.isRequired]).isRequired,\n    filterWith: PropTypes.oneOfType([PropTypes.oneOf([\"prefix\", \"includes\"]), PropTypes.func.isRequired]),\n    cache: PropTypes.number,\n    multiSelect: PropTypes.oneOfType([PropTypes.bool.isRequired, PropTypes.oneOf([\"and\", \"or\"])]),\n    loadingMessage: PropTypes.string,\n    noOptionsMessage: PropTypes.string,\n    searchThreshold: PropTypes.number,\n    available: PropTypes.func,\n    autoClose: PropTypes.bool,\n    operator: PropTypes.oneOf([\"eq\", \"exact\", \"gt\", \"gte\", \"lt\", \"lte\"])\n  }).isRequired,\n  query: PropTypes.any.isRequired,\n  onChange: PropTypes.func.isRequired\n};\n\ntry {\n  FieldValueSelectionFilter.__docgenInfo = {\n    description: '',\n    displayName: 'FieldValueSelectionFilter',\n    methods: [],\n    props: {\n      index: {\n        defaultValue: null,\n        description: '',\n        name: 'index',\n        parent: {\n          fileName: 'eui/src/components/search_bar/filters/field_value_selection_filter.tsx',\n          name: 'FieldValueSelectionFilterProps'\n        },\n        required: true,\n        type: {\n          name: 'number'\n        }\n      },\n      config: {\n        defaultValue: null,\n        description: '',\n        name: 'config',\n        parent: {\n          fileName: 'eui/src/components/search_bar/filters/field_value_selection_filter.tsx',\n          name: 'FieldValueSelectionFilterProps'\n        },\n        required: true,\n        type: {\n          name: 'FieldValueSelectionFilterConfigType'\n        }\n      },\n      query: {\n        defaultValue: null,\n        description: '',\n        name: 'query',\n        parent: {\n          fileName: 'eui/src/components/search_bar/filters/field_value_selection_filter.tsx',\n          name: 'FieldValueSelectionFilterProps'\n        },\n        required: true,\n        type: {\n          name: 'Query'\n        }\n      },\n      onChange: {\n        defaultValue: null,\n        description: '',\n        name: 'onChange',\n        parent: {\n          fileName: 'eui/src/components/search_bar/filters/field_value_selection_filter.tsx',\n          name: 'FieldValueSelectionFilterProps'\n        },\n        required: true,\n        type: {\n          name: '(query: Query) => void'\n        }\n      }\n    },\n    extendedInterfaces: ['FieldValueSelectionFilterProps']\n  };\n} catch (e) {}"]}]}