{"remainingRequest":"D:\\work\\eui\\node_modules\\babel-loader\\lib\\index.js??ref--4-1!D:\\work\\eui\\src\\components\\combo_box\\combo_box.tsx","dependencies":[{"path":"D:\\work\\eui\\src\\components\\combo_box\\combo_box.tsx","mtime":1649070093340},{"path":"D:\\work\\eui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1636976621750},{"path":"D:\\work\\eui\\node_modules\\babel-loader\\lib\\index.js","mtime":1649070120649}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:ZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgIkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjsgaWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfTsgfSByZXR1cm4gX3R5cGVvZihvYmopOyB9CgppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5jb25jYXQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maWx0ZXIiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maW5kLWluZGV4IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmNsdWRlcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluZGV4LW9mIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmVuZHMtd2l0aCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pbmNsdWRlcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy50cmltIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaCI7CgpmdW5jdGlvbiBfZXh0ZW5kcygpIHsgX2V4dGVuZHMgPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uICh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgeyB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOyB9IH0gfSByZXR1cm4gdGFyZ2V0OyB9OyByZXR1cm4gX2V4dGVuZHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfQoKZnVuY3Rpb24gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKHNvdXJjZSwgZXhjbHVkZWQpIHsgaWYgKHNvdXJjZSA9PSBudWxsKSByZXR1cm4ge307IHZhciB0YXJnZXQgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZShzb3VyY2UsIGV4Y2x1ZGVkKTsgdmFyIGtleSwgaTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHNvdXJjZVN5bWJvbEtleXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHNvdXJjZSk7IGZvciAoaSA9IDA7IGkgPCBzb3VyY2VTeW1ib2xLZXlzLmxlbmd0aDsgaSsrKSB7IGtleSA9IHNvdXJjZVN5bWJvbEtleXNbaV07IGlmIChleGNsdWRlZC5pbmRleE9mKGtleSkgPj0gMCkgY29udGludWU7IGlmICghT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHNvdXJjZSwga2V5KSkgY29udGludWU7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gfSByZXR1cm4gdGFyZ2V0OyB9CgpmdW5jdGlvbiBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZShzb3VyY2UsIGV4Y2x1ZGVkKSB7IGlmIChzb3VyY2UgPT0gbnVsbCkgcmV0dXJuIHt9OyB2YXIgdGFyZ2V0ID0ge307IHZhciBzb3VyY2VLZXlzID0gT2JqZWN0LmtleXMoc291cmNlKTsgdmFyIGtleSwgaTsgZm9yIChpID0gMDsgaSA8IHNvdXJjZUtleXMubGVuZ3RoOyBpKyspIHsga2V5ID0gc291cmNlS2V5c1tpXTsgaWYgKGV4Y2x1ZGVkLmluZGV4T2Yoa2V5KSA+PSAwKSBjb250aW51ZTsgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsgfSByZXR1cm4gdGFyZ2V0OyB9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOyBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgeyB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsgaWYgKGVudW1lcmFibGVPbmx5KSBzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgeyByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsgfSk7IGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsgfSByZXR1cm4ga2V5czsgfQoKZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307IGlmIChpICUgMikgeyBvd25LZXlzKE9iamVjdChzb3VyY2UpLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7IH0pOyB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7IH0gZWxzZSB7IG93bktleXMoT2JqZWN0KHNvdXJjZSkpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsgfSk7IH0gfSByZXR1cm4gdGFyZ2V0OyB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9CgpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTsgfQoKZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IG8uX19wcm90b19fID0gcDsgcmV0dXJuIG87IH07IHJldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7IH0KCmZ1bmN0aW9uIF9jcmVhdGVTdXBlcihEZXJpdmVkKSB7IHZhciBoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0ID0gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpOyByZXR1cm4gZnVuY3Rpb24gX2NyZWF0ZVN1cGVySW50ZXJuYWwoKSB7IHZhciBTdXBlciA9IF9nZXRQcm90b3R5cGVPZihEZXJpdmVkKSwgcmVzdWx0OyBpZiAoaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCkgeyB2YXIgTmV3VGFyZ2V0ID0gX2dldFByb3RvdHlwZU9mKHRoaXMpLmNvbnN0cnVjdG9yOyByZXN1bHQgPSBSZWZsZWN0LmNvbnN0cnVjdChTdXBlciwgYXJndW1lbnRzLCBOZXdUYXJnZXQpOyB9IGVsc2UgeyByZXN1bHQgPSBTdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9IHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCByZXN1bHQpOyB9OyB9CgpmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7IGlmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsgcmV0dXJuIGNhbGw7IH0gcmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7IH0KCmZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikgeyBpZiAoc2VsZiA9PT0gdm9pZCAwKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7IH0gcmV0dXJuIHNlbGY7IH0KCmZ1bmN0aW9uIF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKSB7IGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gInVuZGVmaW5lZCIgfHwgIVJlZmxlY3QuY29uc3RydWN0KSByZXR1cm4gZmFsc2U7IGlmIChSZWZsZWN0LmNvbnN0cnVjdC5zaGFtKSByZXR1cm4gZmFsc2U7IGlmICh0eXBlb2YgUHJveHkgPT09ICJmdW5jdGlvbiIpIHJldHVybiB0cnVlOyB0cnkgeyBEYXRlLnByb3RvdHlwZS50b1N0cmluZy5jYWxsKFJlZmxlY3QuY29uc3RydWN0KERhdGUsIFtdLCBmdW5jdGlvbiAoKSB7fSkpOyByZXR1cm4gdHJ1ZTsgfSBjYXRjaCAoZSkgeyByZXR1cm4gZmFsc2U7IH0gfQoKZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgX2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgcmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTsgfTsgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsgfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgeyBpZiAoa2V5IGluIG9iaikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOyB9IGVsc2UgeyBvYmpba2V5XSA9IHZhbHVlOyB9IHJldHVybiBvYmo7IH0KCi8qCiAqIExpY2Vuc2VkIHRvIEVsYXN0aWNzZWFyY2ggQi5WLiB1bmRlciBvbmUgb3IgbW9yZSBjb250cmlidXRvcgogKiBsaWNlbnNlIGFncmVlbWVudHMuIFNlZSB0aGUgTk9USUNFIGZpbGUgZGlzdHJpYnV0ZWQgd2l0aAogKiB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24gcmVnYXJkaW5nIGNvcHlyaWdodAogKiBvd25lcnNoaXAuIEVsYXN0aWNzZWFyY2ggQi5WLiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyCiAqIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOyB5b3UgbWF5CiAqIG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwoKLyoqCiAqIEVsZW1lbnRzIHdpdGhpbiBFdWlDb21ib0JveCB3aGljaCB3b3VsZCBub3JtYWxseSBiZSB0YWJiYWJsZSAoaW5wdXRzLCBidXR0b25zKSBoYXZlIGJlZW4gcmVtb3ZlZAogKiBmcm9tIHRoZSB0YWIgb3JkZXIgd2l0aCB0YWJpbmRleD17LTF9IHNvIHRoYXQgd2UgY2FuIGNvbnRyb2wgdGhlIGtleWJvYXJkIG5hdmlnYXRpb24gaW50ZXJmYWNlLgogKi8KCi8qIGVzbGludC1kaXNhYmxlIGpzeC1hMTF5L3JvbGUtaGFzLXJlcXVpcmVkLWFyaWEtcHJvcHMgKi8KaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCB9IGZyb20gJ3JlYWN0JzsKaW1wb3J0IFByb3BUeXBlcyBmcm9tICJwcm9wLXR5cGVzIjsKaW1wb3J0IGNsYXNzTmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7CmltcG9ydCB7IGZpbmRQb3BvdmVyUG9zaXRpb24sIGh0bWxJZEdlbmVyYXRvciwga2V5cyB9IGZyb20gJy4uLy4uL3NlcnZpY2VzJzsKaW1wb3J0IHsgRXVpUG9ydGFsIH0gZnJvbSAnLi4vcG9ydGFsJzsKaW1wb3J0IHsgRXVpQ29tYm9Cb3hPcHRpb25zTGlzdCB9IGZyb20gJy4vY29tYm9fYm94X29wdGlvbnNfbGlzdCc7CmltcG9ydCB7IGdldE1hdGNoaW5nT3B0aW9ucywgZmxhdHRlbk9wdGlvbkdyb3VwcywgZ2V0U2VsZWN0ZWRPcHRpb25Gb3JTZWFyY2hWYWx1ZSB9IGZyb20gJy4vbWF0Y2hpbmdfb3B0aW9ucyc7CmltcG9ydCB7IEV1aUNvbWJvQm94SW5wdXQgfSBmcm9tICcuL2NvbWJvX2JveF9pbnB1dC9jb21ib19ib3hfaW5wdXQnOwppbXBvcnQgeyBnZXRFbGVtZW50WkluZGV4IH0gZnJvbSAnLi4vLi4vc2VydmljZXMvcG9wb3Zlcic7CnZhciBpbml0aWFsU2VhcmNoVmFsdWUgPSAnJzsKZXhwb3J0IHZhciBFdWlDb21ib0JveCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0NvbXBvbmVudCkgewogIF9pbmhlcml0cyhFdWlDb21ib0JveCwgX0NvbXBvbmVudCk7CgogIHZhciBfc3VwZXIgPSBfY3JlYXRlU3VwZXIoRXVpQ29tYm9Cb3gpOwoKICBmdW5jdGlvbiBFdWlDb21ib0JveCgpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRXVpQ29tYm9Cb3gpOwoKICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4pLCBfa2V5ID0gMDsgX2tleSA8IF9sZW47IF9rZXkrKykgewogICAgICBhcmdzW19rZXldID0gYXJndW1lbnRzW19rZXldOwogICAgfQoKICAgIF90aGlzID0gX3N1cGVyLmNhbGwuYXBwbHkoX3N1cGVyLCBbdGhpc10uY29uY2F0KGFyZ3MpKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzdGF0ZSIsIHsKICAgICAgYWN0aXZlT3B0aW9uSW5kZXg6IC0xLAogICAgICBoYXNGb2N1czogZmFsc2UsCiAgICAgIGlzTGlzdE9wZW46IGZhbHNlLAogICAgICBsaXN0RWxlbWVudDogbnVsbCwKICAgICAgbGlzdFBvc2l0aW9uOiAnYm90dG9tJywKICAgICAgbGlzdFpJbmRleDogdW5kZWZpbmVkLAogICAgICBtYXRjaGluZ09wdGlvbnM6IGdldE1hdGNoaW5nT3B0aW9ucyhfdGhpcy5wcm9wcy5vcHRpb25zLCBfdGhpcy5wcm9wcy5zZWxlY3RlZE9wdGlvbnMsIGluaXRpYWxTZWFyY2hWYWx1ZSwgX3RoaXMucHJvcHMuYXN5bmMsIEJvb2xlYW4oX3RoaXMucHJvcHMuc2luZ2xlU2VsZWN0aW9uKSwgX3RoaXMucHJvcHMuc29ydE1hdGNoZXNCeSksCiAgICAgIHNlYXJjaFZhbHVlOiBpbml0aWFsU2VhcmNoVmFsdWUsCiAgICAgIHdpZHRoOiAwCiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJfaXNNb3VudGVkIiwgZmFsc2UpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInJvb3RJZCIsIGh0bWxJZEdlbmVyYXRvcigpKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJjb21ib0JveFJlZkluc3RhbmNlIiwgbnVsbCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiY29tYm9Cb3hSZWZDYWxsYmFjayIsIGZ1bmN0aW9uIChyZWYpIHsKICAgICAgLy8gSUUxMSBkb2Vzbid0IHN1cHBvcnQgdGhlIGByZWxhdGVkVGFyZ2V0YCBldmVudCBwcm9wZXJ0eSBmb3IgYmx1ciBldmVudHMKICAgICAgLy8gYnV0IGRvZXMgYWRkIGl0IGZvciBmb2N1c291dC4gUmVhY3QgZG9lc24ndCBzdXBwb3J0IGBvbkZvY3VzT3V0YCBzbyBoZXJlIHdlIGFyZS4KICAgICAgaWYgKF90aGlzLmNvbWJvQm94UmVmSW5zdGFuY2UpIHsKICAgICAgICBfdGhpcy5jb21ib0JveFJlZkluc3RhbmNlLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2ZvY3Vzb3V0JywgX3RoaXMub25Db250YWluZXJCbHVyKTsKICAgICAgfQoKICAgICAgX3RoaXMuY29tYm9Cb3hSZWZJbnN0YW5jZSA9IHJlZjsKCiAgICAgIGlmIChfdGhpcy5jb21ib0JveFJlZkluc3RhbmNlKSB7CiAgICAgICAgX3RoaXMuY29tYm9Cb3hSZWZJbnN0YW5jZS5hZGRFdmVudExpc3RlbmVyKCdmb2N1c291dCcsIF90aGlzLm9uQ29udGFpbmVyQmx1cik7CgogICAgICAgIHZhciBjb21ib0JveEJvdW5kcyA9IF90aGlzLmNvbWJvQm94UmVmSW5zdGFuY2UuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CgogICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgIHdpZHRoOiBjb21ib0JveEJvdW5kcy53aWR0aAogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJhdXRvU2l6ZUlucHV0UmVmSW5zdGFuY2UiLCBudWxsKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJhdXRvU2l6ZUlucHV0UmVmQ2FsbGJhY2siLCBmdW5jdGlvbiAocmVmKSB7CiAgICAgIF90aGlzLmF1dG9TaXplSW5wdXRSZWZJbnN0YW5jZSA9IHJlZjsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInNlYXJjaElucHV0UmVmSW5zdGFuY2UiLCBudWxsKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzZWFyY2hJbnB1dFJlZkNhbGxiYWNrIiwgZnVuY3Rpb24gKHJlZikgewogICAgICBfdGhpcy5zZWFyY2hJbnB1dFJlZkluc3RhbmNlID0gcmVmOwogICAgICBpZiAoX3RoaXMucHJvcHMuaW5wdXRSZWYpIF90aGlzLnByb3BzLmlucHV0UmVmKHJlZik7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJsaXN0UmVmSW5zdGFuY2UiLCBudWxsKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJsaXN0UmVmQ2FsbGJhY2siLCBmdW5jdGlvbiAocmVmKSB7CiAgICAgIGlmIChfdGhpcy5jb21ib0JveFJlZkluc3RhbmNlKSB7CiAgICAgICAgLy8gZmluZCB0aGUgekluZGV4IG9mIHRoZSBjb21ib2JveCByZWxhdGl2ZSB0byB0aGUgcGFnZSBib2R5CiAgICAgICAgLy8gYW5kIHVzZSB0aGF0IHRvIGRlcHRoLXBvc2l0aW9uIHRoZSBsaXN0IGJveAogICAgICAgIC8vIGFkZHMgYW4gZXh0cmEgYDEwMGAgdG8gcHJvdmlkZSBzb21lIGRlZmVuc2UgYXJvdW5kIG5laWdoYm9yaW5nIGVsZW1lbnRzJyBwb3NpdGlvbmluZwogICAgICAgIHZhciBsaXN0WkluZGV4ID0gZ2V0RWxlbWVudFpJbmRleChfdGhpcy5jb21ib0JveFJlZkluc3RhbmNlLCBkb2N1bWVudC5ib2R5KSArIDEwMDsKCiAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgbGlzdFpJbmRleDogbGlzdFpJbmRleAogICAgICAgIH0pOwogICAgICB9CgogICAgICBfdGhpcy5saXN0UmVmSW5zdGFuY2UgPSByZWY7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJ0b2dnbGVCdXR0b25SZWZJbnN0YW5jZSIsIG51bGwpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInRvZ2dsZUJ1dHRvblJlZkNhbGxiYWNrIiwgZnVuY3Rpb24gKHJlZikgewogICAgICBfdGhpcy50b2dnbGVCdXR0b25SZWZJbnN0YW5jZSA9IHJlZjsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9wdGlvbnNSZWZJbnN0YW5jZXMiLCBbXSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib3B0aW9uUmVmQ2FsbGJhY2siLCBmdW5jdGlvbiAoaW5kZXgsIHJlZikgewogICAgICBfdGhpcy5vcHRpb25zUmVmSW5zdGFuY2VzW2luZGV4XSA9IHJlZjsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9wZW5MaXN0IiwgZnVuY3Rpb24gKCkgewogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgaXNMaXN0T3BlbjogdHJ1ZQogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImNsb3NlTGlzdCIsIGZ1bmN0aW9uIChldmVudCkgewogICAgICBpZiAoZXZlbnQgJiYgZXZlbnQudGFyZ2V0ID09PSBfdGhpcy5zZWFyY2hJbnB1dFJlZkluc3RhbmNlKSB7CiAgICAgICAgLy8gcmVhbGx5IGxvbmcgc2VhcmNoIHZhbHVlcyAvIGN1c3RvbSBlbnRyaWVzIHRyaWdnZXJzIGEgc2Nyb2xsIGV2ZW50IG9uIHRoZSBpbnB1dAogICAgICAgIC8vIHdoaWNoIHRoZSBFdWlDb21ib0JveE9wdGlvbnNMaXN0IHBhc3NlcyB0aHJvdWdoIGhlcmUKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIF90aGlzLmNsZWFyQWN0aXZlT3B0aW9uKCk7CgogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgbGlzdFpJbmRleDogdW5kZWZpbmVkLAogICAgICAgIGlzTGlzdE9wZW46IGZhbHNlCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAidXBkYXRlUG9zaXRpb24iLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBsaXN0RWxlbWVudCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogX3RoaXMuc3RhdGUubGlzdEVsZW1lbnQ7CgogICAgICBpZiAoIV90aGlzLl9pc01vdW50ZWQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICghX3RoaXMuc3RhdGUuaXNMaXN0T3BlbikgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKCFsaXN0RWxlbWVudCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBpdCdzIHBvc3NpYmxlIHRoYXQgdXBkYXRlTGlzdFBvc2l0aW9uIGlzIGNhbGxlZCB3aGVuIGxpc3RFbGVtZW50IGlzIGJlY29taW5nIHZpc2libGUsIGJ1dCBpc24ndCB5ZXQKCgogICAgICB2YXIgbGlzdEVsZW1lbnRCb3VuZHMgPSBsaXN0RWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCiAgICAgIGlmIChsaXN0RWxlbWVudEJvdW5kcy53aWR0aCA9PT0gMCB8fCBsaXN0RWxlbWVudEJvdW5kcy5oZWlnaHQgPT09IDApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICghX3RoaXMuY29tYm9Cb3hSZWZJbnN0YW5jZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGNvbWJvQm94Qm91bmRzID0gX3RoaXMuY29tYm9Cb3hSZWZJbnN0YW5jZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCiAgICAgIHZhciBfcmVmID0gZmluZFBvcG92ZXJQb3NpdGlvbih7CiAgICAgICAgYWxsb3dDcm9zc0F4aXM6IGZhbHNlLAogICAgICAgIGFuY2hvcjogX3RoaXMuY29tYm9Cb3hSZWZJbnN0YW5jZSwKICAgICAgICBwb3BvdmVyOiBsaXN0RWxlbWVudCwKICAgICAgICBwb3NpdGlvbjogJ2JvdHRvbScKICAgICAgfSksCiAgICAgICAgICBwb3NpdGlvbiA9IF9yZWYucG9zaXRpb24sCiAgICAgICAgICB0b3AgPSBfcmVmLnRvcDsKCiAgICAgIGlmIChfdGhpcy5saXN0UmVmSW5zdGFuY2UpIHsKICAgICAgICBfdGhpcy5saXN0UmVmSW5zdGFuY2Uuc3R5bGUudG9wID0gIiIuY29uY2F0KHRvcCwgInB4Iik7IC8vIGxpc3RFbGVtZW50IGRvZXNuJ3QgaGF2ZSBpdHMgd2lkdGggc2V0IHVudGlsIGFmdGVyIHVwZGF0aW5nIHRoZSBwb3NpdGlvbgogICAgICAgIC8vIHdoaWNoIG1lYW5zIHRoZSBwb3BvdmVyIHNlcnZpY2Ugd29uJ3Qga25vdyBhYm91dCB0aGUgY29ycmVjdCB3aWR0aAogICAgICAgIC8vIGhvd2V2ZXIsIHdlIGFscmVhZHkga25vdyB3aGVyZSB0byBwb3NpdGlvbiB0aGUgZWxlbWVudAoKICAgICAgICBfdGhpcy5saXN0UmVmSW5zdGFuY2Uuc3R5bGUubGVmdCA9ICIiLmNvbmNhdChjb21ib0JveEJvdW5kcy5sZWZ0ICsgd2luZG93LnBhZ2VYT2Zmc2V0LCAicHgiKTsKICAgICAgICBfdGhpcy5saXN0UmVmSW5zdGFuY2Uuc3R5bGUud2lkdGggPSAiIi5jb25jYXQoY29tYm9Cb3hCb3VuZHMud2lkdGgsICJweCIpOwogICAgICB9IC8vIENhY2hlIGZvciBmdXR1cmUgY2FsbHMuCgoKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIGxpc3RFbGVtZW50OiBsaXN0RWxlbWVudCwKICAgICAgICBsaXN0UG9zaXRpb246IHBvc2l0aW9uLAogICAgICAgIHdpZHRoOiBjb21ib0JveEJvdW5kcy53aWR0aAogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImluY3JlbWVudEFjdGl2ZU9wdGlvbkluZGV4IiwgZnVuY3Rpb24gKGFtb3VudCkgewogICAgICAvLyBJZiB0aGVyZSBhcmUgbm8gb3B0aW9ucyBhdmFpbGFibGUsIGRvIG5vdGhpbmcuCiAgICAgIGlmICghX3RoaXMuc3RhdGUubWF0Y2hpbmdPcHRpb25zLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgX3RoaXMuc2V0U3RhdGUoZnVuY3Rpb24gKF9yZWYyKSB7CiAgICAgICAgdmFyIGFjdGl2ZU9wdGlvbkluZGV4ID0gX3JlZjIuYWN0aXZlT3B0aW9uSW5kZXgsCiAgICAgICAgICAgIG1hdGNoaW5nT3B0aW9ucyA9IF9yZWYyLm1hdGNoaW5nT3B0aW9uczsKICAgICAgICB2YXIgbmV4dEFjdGl2ZU9wdGlvbkluZGV4OwoKICAgICAgICBpZiAoYWN0aXZlT3B0aW9uSW5kZXggPCAwKSB7CiAgICAgICAgICAvLyBJZiB0aGlzIGlzIHRoZSBiZWdpbm5pbmcgb2YgdGhlIHVzZXIncyBrZXlib2FyZCBuYXZpZ2F0aW9uIG9mIHRoZSBtZW51LCB0aGVuIHdlJ2xsIGZvY3VzCiAgICAgICAgICAvLyBlaXRoZXIgdGhlIGZpcnN0IG9yIGxhc3QgaXRlbS4KICAgICAgICAgIG5leHRBY3RpdmVPcHRpb25JbmRleCA9IGFtb3VudCA8IDAgPyBtYXRjaGluZ09wdGlvbnMubGVuZ3RoIC0gMSA6IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG5leHRBY3RpdmVPcHRpb25JbmRleCA9IGFjdGl2ZU9wdGlvbkluZGV4ICsgYW1vdW50OwoKICAgICAgICAgIGlmIChuZXh0QWN0aXZlT3B0aW9uSW5kZXggPCAwKSB7CiAgICAgICAgICAgIG5leHRBY3RpdmVPcHRpb25JbmRleCA9IG1hdGNoaW5nT3B0aW9ucy5sZW5ndGggLSAxOwogICAgICAgICAgfSBlbHNlIGlmIChuZXh0QWN0aXZlT3B0aW9uSW5kZXggPT09IG1hdGNoaW5nT3B0aW9ucy5sZW5ndGgpIHsKICAgICAgICAgICAgbmV4dEFjdGl2ZU9wdGlvbkluZGV4ID0gMDsKICAgICAgICAgIH0KICAgICAgICB9IC8vIEdyb3VwIHRpdGxlcyBhcmUgaW5jbHVkZWQgaW4gb3B0aW9uIGxpc3QgYnV0IGFyZSBub3Qgc2VsZWN0YWJsZQogICAgICAgIC8vIFNraXAgZ3JvdXAgdGl0bGUgb3B0aW9ucwoKCiAgICAgICAgdmFyIGRpcmVjdGlvbiA9IGFtb3VudCA+IDAgPyAxIDogLTE7CgogICAgICAgIHdoaWxlIChtYXRjaGluZ09wdGlvbnNbbmV4dEFjdGl2ZU9wdGlvbkluZGV4XS5pc0dyb3VwTGFiZWxPcHRpb24pIHsKICAgICAgICAgIG5leHRBY3RpdmVPcHRpb25JbmRleCA9IG5leHRBY3RpdmVPcHRpb25JbmRleCArIGRpcmVjdGlvbjsKCiAgICAgICAgICBpZiAobmV4dEFjdGl2ZU9wdGlvbkluZGV4IDwgMCkgewogICAgICAgICAgICBuZXh0QWN0aXZlT3B0aW9uSW5kZXggPSBtYXRjaGluZ09wdGlvbnMubGVuZ3RoIC0gMTsKICAgICAgICAgIH0gZWxzZSBpZiAobmV4dEFjdGl2ZU9wdGlvbkluZGV4ID09PSBtYXRjaGluZ09wdGlvbnMubGVuZ3RoKSB7CiAgICAgICAgICAgIG5leHRBY3RpdmVPcHRpb25JbmRleCA9IDA7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gewogICAgICAgICAgYWN0aXZlT3B0aW9uSW5kZXg6IG5leHRBY3RpdmVPcHRpb25JbmRleAogICAgICAgIH07CiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaGFzQWN0aXZlT3B0aW9uIiwgZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gX3RoaXMuc3RhdGUuYWN0aXZlT3B0aW9uSW5kZXggPiAtMSAmJiBfdGhpcy5zdGF0ZS5hY3RpdmVPcHRpb25JbmRleCA8IF90aGlzLnN0YXRlLm1hdGNoaW5nT3B0aW9ucy5sZW5ndGg7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJjbGVhckFjdGl2ZU9wdGlvbiIsIGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIGFjdGl2ZU9wdGlvbkluZGV4OiAtMQogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImNsZWFyU2VhcmNoVmFsdWUiLCBmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLm9uU2VhcmNoQ2hhbmdlKCcnKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInJlbW92ZUxhc3RPcHRpb24iLCBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICghX3RoaXMucHJvcHMuc2VsZWN0ZWRPcHRpb25zLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBCYWNrc3BhY2Ugd2lsbCBiZSB1c2VkIHRvIGRlbGV0ZSB0aGUgaW5wdXQsIG5vdCBhIHBpbGwuCgoKICAgICAgaWYgKF90aGlzLnN0YXRlLnNlYXJjaFZhbHVlLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBEZWxldGUgbGFzdCBwaWxsLgoKCiAgICAgIF90aGlzLm9uUmVtb3ZlT3B0aW9uKF90aGlzLnByb3BzLnNlbGVjdGVkT3B0aW9uc1tfdGhpcy5wcm9wcy5zZWxlY3RlZE9wdGlvbnMubGVuZ3RoIC0gMV0pOwoKICAgICAgaWYgKEJvb2xlYW4oX3RoaXMucHJvcHMuc2luZ2xlU2VsZWN0aW9uKSAmJiAhX3RoaXMuc3RhdGUuaXNMaXN0T3BlbikgewogICAgICAgIF90aGlzLm9wZW5MaXN0KCk7CiAgICAgIH0KICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImFkZEN1c3RvbU9wdGlvbiIsIGZ1bmN0aW9uIChpc0NvbnRhaW5lckJsdXIsIHNlYXJjaFZhbHVlKSB7CiAgICAgIHZhciBfdGhpcyRwcm9wcyA9IF90aGlzLnByb3BzLAogICAgICAgICAgb25DcmVhdGVPcHRpb24gPSBfdGhpcyRwcm9wcy5vbkNyZWF0ZU9wdGlvbiwKICAgICAgICAgIG9wdGlvbnMgPSBfdGhpcyRwcm9wcy5vcHRpb25zLAogICAgICAgICAgc2VsZWN0ZWRPcHRpb25zID0gX3RoaXMkcHJvcHMuc2VsZWN0ZWRPcHRpb25zLAogICAgICAgICAgc2luZ2xlU2VsZWN0aW9uID0gX3RoaXMkcHJvcHMuc2luZ2xlU2VsZWN0aW9uOwogICAgICB2YXIgbWF0Y2hpbmdPcHRpb25zID0gX3RoaXMuc3RhdGUubWF0Y2hpbmdPcHRpb25zOwoKICAgICAgaWYgKF90aGlzLmRvZXNTZWFyY2hNYXRjaE9ubHlPcHRpb24oKSkgewogICAgICAgIF90aGlzLm9uQWRkT3B0aW9uKG1hdGNoaW5nT3B0aW9uc1swXSwgaXNDb250YWluZXJCbHVyKTsKCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoIW9uQ3JlYXRlT3B0aW9uKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIERvbid0IGJvdGhlciB0cnlpbmcgdG8gY3JlYXRlIGFuIG9wdGlvbiBpZiB0aGUgdXNlciBoYXNuJ3QgdHlwZWQgYW55dGhpbmcuCgoKICAgICAgaWYgKCFzZWFyY2hWYWx1ZSkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBEb24ndCBjcmVhdGUgdGhlIHZhbHVlIGlmIGl0J3MgYWxyZWFkeSBiZWVuIHNlbGVjdGVkLgoKCiAgICAgIGlmIChnZXRTZWxlY3RlZE9wdGlvbkZvclNlYXJjaFZhbHVlKHNlYXJjaFZhbHVlLCBzZWxlY3RlZE9wdGlvbnMpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIEFkZCBuZXcgY3VzdG9tIHBpbGwgaWYgdGhpcyBpcyBjdXN0b20gaW5wdXQsIGV2ZW4gaWYgaXQgcGFydGlhbGx5IG1hdGNoZXMgYW4gb3B0aW9uLgoKCiAgICAgIHZhciBpc09wdGlvbkNyZWF0ZWQgPSBvbkNyZWF0ZU9wdGlvbihzZWFyY2hWYWx1ZSwgZmxhdHRlbk9wdGlvbkdyb3VwcyhvcHRpb25zKSk7IC8vIEV4cGVjdCB0aGUgY29uc3VtZXIgdG8gYmUgZXhwbGljaXQgaW4gcmVqZWN0aW5nIGEgY3VzdG9tIG9wdGlvbi4KCiAgICAgIGlmIChpc09wdGlvbkNyZWF0ZWQgPT09IGZhbHNlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBfdGhpcy5jbGVhclNlYXJjaFZhbHVlKCk7CgogICAgICBpZiAoQm9vbGVhbihzaW5nbGVTZWxlY3Rpb24pKSB7CiAgICAgICAgLy8gQWRkaW5nIGEgY3VzdG9tIG9wdGlvbiB0byBhIHNpbmdsZSBzZWxlY3QgdGhhdCBkb2VzIG5vdCBhcHBlYXIgaW4gdGhlIGxpc3Qgb2Ygb3B0aW9ucwogICAgICAgIF90aGlzLmNsb3NlTGlzdCgpOwogICAgICB9CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJkb2VzU2VhcmNoTWF0Y2hPbmx5T3B0aW9uIiwgZnVuY3Rpb24gKCkgewogICAgICB2YXIgc2VhcmNoVmFsdWUgPSBfdGhpcy5zdGF0ZS5zZWFyY2hWYWx1ZTsKCiAgICAgIGlmIChfdGhpcy5zdGF0ZS5tYXRjaGluZ09wdGlvbnMubGVuZ3RoICE9PSAxKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gX3RoaXMuc3RhdGUubWF0Y2hpbmdPcHRpb25zWzBdLmxhYmVsLnRvTG93ZXJDYXNlKCkgPT09IHNlYXJjaFZhbHVlLnRvTG93ZXJDYXNlKCk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJhcmVBbGxPcHRpb25zU2VsZWN0ZWQiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfdGhpcyRwcm9wczIgPSBfdGhpcy5wcm9wcywKICAgICAgICAgIG9wdGlvbnMgPSBfdGhpcyRwcm9wczIub3B0aW9ucywKICAgICAgICAgIHNlbGVjdGVkT3B0aW9ucyA9IF90aGlzJHByb3BzMi5zZWxlY3RlZE9wdGlvbnMsCiAgICAgICAgICBhc3luYyA9IF90aGlzJHByb3BzMi5hc3luYzsgLy8gQXNzdW1lIGlmIHRoaXMgaXMgYXN5bmMgdGhlbiB0aGVyZSBjb3VsZCBiZSBpbmZpbml0ZSBvcHRpb25zLgoKICAgICAgaWYgKGFzeW5jKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICB2YXIgZmxhdHRlbk9wdGlvbnMgPSBmbGF0dGVuT3B0aW9uR3JvdXBzKG9wdGlvbnMpLm1hcChmdW5jdGlvbiAob3B0aW9uKSB7CiAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgb3B0aW9uKSwge30sIHsKICAgICAgICAgIGxhYmVsOiBvcHRpb24ubGFiZWwudHJpbSgpLnRvTG93ZXJDYXNlKCkKICAgICAgICB9KTsKICAgICAgfSk7CiAgICAgIHZhciBudW1iZXJPZlNlbGVjdGVkT3B0aW9ucyA9IDA7CiAgICAgIHNlbGVjdGVkT3B0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChfcmVmMykgewogICAgICAgIHZhciBsYWJlbCA9IF9yZWYzLmxhYmVsOwogICAgICAgIHZhciB0cmltbWVkTGFiZWwgPSBsYWJlbC50cmltKCkudG9Mb3dlckNhc2UoKTsKICAgICAgICBpZiAoZmxhdHRlbk9wdGlvbnMuZmluZEluZGV4KGZ1bmN0aW9uIChvcHRpb24pIHsKICAgICAgICAgIHJldHVybiBvcHRpb24ubGFiZWwgPT09IHRyaW1tZWRMYWJlbDsKICAgICAgICB9KSAhPT0gLTEpIG51bWJlck9mU2VsZWN0ZWRPcHRpb25zICs9IDE7CiAgICAgIH0pOwogICAgICByZXR1cm4gZmxhdHRlbk9wdGlvbnMubGVuZ3RoID09PSBudW1iZXJPZlNlbGVjdGVkT3B0aW9uczsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uQ29tYm9Cb3hGb2N1cyIsIGZ1bmN0aW9uIChldmVudCkgewogICAgICBpZiAoX3RoaXMucHJvcHMub25Gb2N1cykgewogICAgICAgIF90aGlzLnByb3BzLm9uRm9jdXMoZXZlbnQpOwogICAgICB9CgogICAgICBfdGhpcy5vcGVuTGlzdCgpOwoKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIGhhc0ZvY3VzOiB0cnVlCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAic2V0Q3VzdG9tT3B0aW9ucyIsIGZ1bmN0aW9uIChpc0NvbnRhaW5lckJsdXIpIHsKICAgICAgdmFyIHNlYXJjaFZhbHVlID0gX3RoaXMuc3RhdGUuc2VhcmNoVmFsdWU7CiAgICAgIHZhciBkZWxpbWl0ZXIgPSBfdGhpcy5wcm9wcy5kZWxpbWl0ZXI7CgogICAgICBpZiAoZGVsaW1pdGVyKSB7CiAgICAgICAgc2VhcmNoVmFsdWUuc3BsaXQoZGVsaW1pdGVyKS5mb3JFYWNoKGZ1bmN0aW9uIChvcHRpb24pIHsKICAgICAgICAgIGlmIChvcHRpb24ubGVuZ3RoID4gMCkgX3RoaXMuYWRkQ3VzdG9tT3B0aW9uKGlzQ29udGFpbmVyQmx1ciwgb3B0aW9uKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBfdGhpcy5hZGRDdXN0b21PcHRpb24oaXNDb250YWluZXJCbHVyLCBzZWFyY2hWYWx1ZSk7CiAgICAgIH0KICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uQ29udGFpbmVyQmx1ciIsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAvLyBjbG9zZSB0aGUgb3B0aW9ucyBsaXN0LCB1bmxlc3MgdGhlIHVzZSBjbGlja2VkIG9uIGFuIG9wdGlvbgoKICAgICAgLyoqCiAgICAgICAqIEZpcmVGb3ggcmV0dXJucyBgcmVsYXRlZFRhcmdldGAgYXMgYG51bGxgIGZvciBzZWN1cml0eSByZWFzb25zLCBidXQgcHJvdmlkZXMgYSBwcm9wcmlldGFyeSBgZXhwbGljaXRPcmlnaW5hbFRhcmdldGAuCiAgICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0V2ZW50L2V4cGxpY2l0T3JpZ2luYWxUYXJnZXQKICAgICAgICovCiAgICAgIHZhciBmb2N1c0V2ZW50ID0gZXZlbnQ7CiAgICAgIHZhciByZWxhdGVkVGFyZ2V0ID0gZm9jdXNFdmVudC5yZWxhdGVkVGFyZ2V0IHx8IGZvY3VzRXZlbnQuZXhwbGljaXRPcmlnaW5hbFRhcmdldDsKCiAgICAgIHZhciBmb2N1c2VkSW5PcHRpb25zTGlzdCA9IHJlbGF0ZWRUYXJnZXQgJiYgX3RoaXMubGlzdFJlZkluc3RhbmNlICYmIF90aGlzLmxpc3RSZWZJbnN0YW5jZS5jb250YWlucyhyZWxhdGVkVGFyZ2V0KTsKCiAgICAgIHZhciBmb2N1c2VkSW5JbnB1dCA9IHJlbGF0ZWRUYXJnZXQgJiYgX3RoaXMuY29tYm9Cb3hSZWZJbnN0YW5jZSAmJiBfdGhpcy5jb21ib0JveFJlZkluc3RhbmNlLmNvbnRhaW5zKHJlbGF0ZWRUYXJnZXQpOwoKICAgICAgaWYgKCFmb2N1c2VkSW5PcHRpb25zTGlzdCAmJiAhZm9jdXNlZEluSW5wdXQpIHsKICAgICAgICBfdGhpcy5jbG9zZUxpc3QoKTsKCiAgICAgICAgaWYgKF90aGlzLnByb3BzLm9uQmx1cikgewogICAgICAgICAgX3RoaXMucHJvcHMub25CbHVyKGV2ZW50KTsKICAgICAgICB9CgogICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgIGhhc0ZvY3VzOiBmYWxzZQogICAgICAgIH0pOyAvLyBJZiB0aGUgdXNlciB0YWJzIGF3YXkgb3IgY2hhbmdlcyBmb2N1cyB0byBhbm90aGVyIGVsZW1lbnQsIHRha2Ugd2hhdGV2ZXIgaW5wdXQgdGhleSd2ZQogICAgICAgIC8vIHR5cGVkIGFuZCBjb252ZXJ0IGl0IGludG8gYSBwaWxsLCB0byBwcmV2ZW50IHRoZSBjb21ibyBib3ggZnJvbSBsb29raW5nIGxpa2UgYSB0ZXh0IGlucHV0LgoKCiAgICAgICAgaWYgKCFfdGhpcy5oYXNBY3RpdmVPcHRpb24oKSkgewogICAgICAgICAgX3RoaXMuc2V0Q3VzdG9tT3B0aW9ucyh0cnVlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uS2V5RG93biIsIGZ1bmN0aW9uIChldmVudCkgewogICAgICBzd2l0Y2ggKGV2ZW50LmtleSkgewogICAgICAgIGNhc2Uga2V5cy5BUlJPV19VUDoKICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKCiAgICAgICAgICBpZiAoX3RoaXMuc3RhdGUuaXNMaXN0T3BlbikgewogICAgICAgICAgICBfdGhpcy5pbmNyZW1lbnRBY3RpdmVPcHRpb25JbmRleCgtMSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfdGhpcy5vcGVuTGlzdCgpOwogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIGtleXMuQVJST1dfRE9XTjoKICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKCiAgICAgICAgICBpZiAoX3RoaXMuc3RhdGUuaXNMaXN0T3BlbikgewogICAgICAgICAgICBfdGhpcy5pbmNyZW1lbnRBY3RpdmVPcHRpb25JbmRleCgxKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90aGlzLm9wZW5MaXN0KCk7CiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2Uga2V5cy5CQUNLU1BBQ0U6CiAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKCiAgICAgICAgICBfdGhpcy5yZW1vdmVMYXN0T3B0aW9uKCk7CgogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2Uga2V5cy5FU0NBUEU6CiAgICAgICAgICBpZiAoX3RoaXMuc3RhdGUuaXNMaXN0T3BlbikgewogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKCiAgICAgICAgICAgIF90aGlzLmNsb3NlTGlzdCgpOwogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIGtleXMuRU5URVI6CiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CgogICAgICAgICAgaWYgKF90aGlzLmhhc0FjdGl2ZU9wdGlvbigpKSB7CiAgICAgICAgICAgIF90aGlzLm9uQWRkT3B0aW9uKF90aGlzLnN0YXRlLm1hdGNoaW5nT3B0aW9uc1tfdGhpcy5zdGF0ZS5hY3RpdmVPcHRpb25JbmRleF0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXMuc2V0Q3VzdG9tT3B0aW9ucyhmYWxzZSk7CiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2Uga2V5cy5UQUI6CiAgICAgICAgICAvLyBEaXNhbGxvdyB0YWJiaW5nIHdoZW4gdGhlIHVzZXIgaXMgbmF2aWdhdGluZyB0aGUgb3B0aW9ucy4KICAgICAgICAgIGlmIChfdGhpcy5oYXNBY3RpdmVPcHRpb24oKSAmJiBfdGhpcy5zdGF0ZS5pc0xpc3RPcGVuKSB7CiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgaWYgKF90aGlzLnByb3BzLm9uS2V5RG93bikgewogICAgICAgICAgICBfdGhpcy5wcm9wcy5vbktleURvd24oZXZlbnQpOwogICAgICAgICAgfQoKICAgICAgfQogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25PcHRpb25FbnRlcktleSIsIGZ1bmN0aW9uIChvcHRpb24pIHsKICAgICAgX3RoaXMub25BZGRPcHRpb24ob3B0aW9uKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uT3B0aW9uQ2xpY2siLCBmdW5jdGlvbiAob3B0aW9uKSB7CiAgICAgIF90aGlzLm9uQWRkT3B0aW9uKG9wdGlvbik7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkFkZE9wdGlvbiIsIGZ1bmN0aW9uIChhZGRlZE9wdGlvbiwgaXNDb250YWluZXJCbHVyKSB7CiAgICAgIGlmIChhZGRlZE9wdGlvbi5kaXNhYmxlZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIF90aGlzJHByb3BzMyA9IF90aGlzLnByb3BzLAogICAgICAgICAgb25DaGFuZ2UgPSBfdGhpcyRwcm9wczMub25DaGFuZ2UsCiAgICAgICAgICBzZWxlY3RlZE9wdGlvbnMgPSBfdGhpcyRwcm9wczMuc2VsZWN0ZWRPcHRpb25zLAogICAgICAgICAgc2luZ2xlU2VsZWN0aW9uUHJvcCA9IF90aGlzJHByb3BzMy5zaW5nbGVTZWxlY3Rpb247CiAgICAgIHZhciBzaW5nbGVTZWxlY3Rpb24gPSBCb29sZWFuKHNpbmdsZVNlbGVjdGlvblByb3ApOwogICAgICB2YXIgY2hhbmdlT3B0aW9ucyA9IHNpbmdsZVNlbGVjdGlvbiA/IFthZGRlZE9wdGlvbl0gOiBzZWxlY3RlZE9wdGlvbnMuY29uY2F0KGFkZGVkT3B0aW9uKTsKCiAgICAgIGlmIChvbkNoYW5nZSkgewogICAgICAgIG9uQ2hhbmdlKGNoYW5nZU9wdGlvbnMpOwogICAgICB9CgogICAgICBfdGhpcy5jbGVhclNlYXJjaFZhbHVlKCk7CgogICAgICBfdGhpcy5jbGVhckFjdGl2ZU9wdGlvbigpOwoKICAgICAgaWYgKCFpc0NvbnRhaW5lckJsdXIpIHsKICAgICAgICBpZiAoX3RoaXMuc2VhcmNoSW5wdXRSZWZJbnN0YW5jZSkgewogICAgICAgICAgX3RoaXMuc2VhcmNoSW5wdXRSZWZJbnN0YW5jZS5mb2N1cygpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHNpbmdsZVNlbGVjdGlvbikgewogICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMuY2xvc2VMaXN0KCk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgYWN0aXZlT3B0aW9uSW5kZXg6IF90aGlzLnN0YXRlLm1hdGNoaW5nT3B0aW9ucy5pbmRleE9mKGFkZGVkT3B0aW9uKQogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvblJlbW92ZU9wdGlvbiIsIGZ1bmN0aW9uIChyZW1vdmVkT3B0aW9uKSB7CiAgICAgIHZhciBfdGhpcyRwcm9wczQgPSBfdGhpcy5wcm9wcywKICAgICAgICAgIG9uQ2hhbmdlID0gX3RoaXMkcHJvcHM0Lm9uQ2hhbmdlLAogICAgICAgICAgc2VsZWN0ZWRPcHRpb25zID0gX3RoaXMkcHJvcHM0LnNlbGVjdGVkT3B0aW9uczsKCiAgICAgIGlmIChvbkNoYW5nZSkgewogICAgICAgIG9uQ2hhbmdlKHNlbGVjdGVkT3B0aW9ucy5maWx0ZXIoZnVuY3Rpb24gKG9wdGlvbikgewogICAgICAgICAgcmV0dXJuIG9wdGlvbiAhPT0gcmVtb3ZlZE9wdGlvbjsKICAgICAgICB9KSk7CiAgICAgIH0KCiAgICAgIF90aGlzLmNsZWFyQWN0aXZlT3B0aW9uKCk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJjbGVhclNlbGVjdGVkT3B0aW9ucyIsIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIG9uQ2hhbmdlID0gX3RoaXMucHJvcHMub25DaGFuZ2U7CgogICAgICBpZiAob25DaGFuZ2UpIHsKICAgICAgICBvbkNoYW5nZShbXSk7CiAgICAgIH0gLy8gQ2xpY2tpbmcgdGhlIGNsZWFyIGJ1dHRvbiB3aWxsIGFsc28gY2F1c2UgaXQgdG8gZGlzYXBwZWFyLiBUaGlzIHdvdWxkIHJlc3VsdCBpbiBmb2N1cwogICAgICAvLyBzaGlmdGluZyB1bmV4cGVjdGVkbHkgdG8gdGhlIGJvZHkgZWxlbWVudCBzbyB3ZSBzZXQgaXQgdG8gdGhlIGlucHV0IHdoaWNoIGlzIG1vcmUgcmVhc29uYWJsZSwKCgogICAgICBpZiAoX3RoaXMuc2VhcmNoSW5wdXRSZWZJbnN0YW5jZSkgewogICAgICAgIF90aGlzLnNlYXJjaElucHV0UmVmSW5zdGFuY2UuZm9jdXMoKTsKICAgICAgfQoKICAgICAgaWYgKCFfdGhpcy5zdGF0ZS5pc0xpc3RPcGVuKSB7CiAgICAgICAgX3RoaXMub3Blbkxpc3QoKTsKICAgICAgfQogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25Db21ib0JveENsaWNrIiwgZnVuY3Rpb24gKCkgewogICAgICAvLyBXaGVuIHRoZSB1c2VyIGNsaWNrcyBhbnl3aGVyZSBvbiB0aGUgYm94LCBlbnRlciB0aGUgaW50ZXJhY3Rpb24gc3RhdGUuCiAgICAgIGlmIChfdGhpcy5zZWFyY2hJbnB1dFJlZkluc3RhbmNlKSB7CiAgICAgICAgX3RoaXMuc2VhcmNoSW5wdXRSZWZJbnN0YW5jZS5mb2N1cygpOwogICAgICB9IC8vIElmIHRoZSB1c2VyIGRvZXMgdGhpcyBmcm9tIGEgc3RhdGUgaW4gd2hpY2ggYW4gb3B0aW9uIGhhcyBmb2N1cywgdGhlbiB3ZSBuZWVkIHRvIHJlc2V0IGl0IG9yIGNsZWFyIGl0LgoKCiAgICAgIGlmIChCb29sZWFuKF90aGlzLnByb3BzLnNpbmdsZVNlbGVjdGlvbikgJiYgX3RoaXMucHJvcHMuc2VsZWN0ZWRPcHRpb25zLmxlbmd0aCA9PT0gMSkgewogICAgICAgIHZhciBzZWxlY3RlZE9wdGlvbkluZGV4ID0gX3RoaXMuc3RhdGUubWF0Y2hpbmdPcHRpb25zLmZpbmRJbmRleChmdW5jdGlvbiAob3B0aW9uKSB7CiAgICAgICAgICByZXR1cm4gb3B0aW9uLmxhYmVsID09PSBfdGhpcy5wcm9wcy5zZWxlY3RlZE9wdGlvbnNbMF0ubGFiZWwgJiYgb3B0aW9uLmtleSA9PT0gX3RoaXMucHJvcHMuc2VsZWN0ZWRPcHRpb25zWzBdLmtleTsKICAgICAgICB9KTsKCiAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgYWN0aXZlT3B0aW9uSW5kZXg6IHNlbGVjdGVkT3B0aW9uSW5kZXgKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBfdGhpcy5jbGVhckFjdGl2ZU9wdGlvbigpOwogICAgICB9CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbk9wZW5MaXN0Q2xpY2siLCBmdW5jdGlvbiAoKSB7CiAgICAgIGlmIChfdGhpcy5zZWFyY2hJbnB1dFJlZkluc3RhbmNlKSB7CiAgICAgICAgX3RoaXMuc2VhcmNoSW5wdXRSZWZJbnN0YW5jZS5mb2N1cygpOwogICAgICB9CgogICAgICBpZiAoIV90aGlzLnN0YXRlLmlzTGlzdE9wZW4pIHsKICAgICAgICBfdGhpcy5vcGVuTGlzdCgpOwogICAgICB9CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbk9wdGlvbkxpc3RTY3JvbGwiLCBmdW5jdGlvbiAoKSB7CiAgICAgIGlmIChfdGhpcy5zZWFyY2hJbnB1dFJlZkluc3RhbmNlKSB7CiAgICAgICAgX3RoaXMuc2VhcmNoSW5wdXRSZWZJbnN0YW5jZS5mb2N1cygpOwogICAgICB9CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkNsb3NlTGlzdENsaWNrIiwgZnVuY3Rpb24gKCkgewogICAgICBfdGhpcy5jbG9zZUxpc3QoKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uU2VhcmNoQ2hhbmdlIiwgZnVuY3Rpb24gKHNlYXJjaFZhbHVlKSB7CiAgICAgIHZhciBfdGhpcyRwcm9wczUgPSBfdGhpcy5wcm9wcywKICAgICAgICAgIG9uU2VhcmNoQ2hhbmdlID0gX3RoaXMkcHJvcHM1Lm9uU2VhcmNoQ2hhbmdlLAogICAgICAgICAgZGVsaW1pdGVyID0gX3RoaXMkcHJvcHM1LmRlbGltaXRlcjsKCiAgICAgIGlmIChvblNlYXJjaENoYW5nZSkgewogICAgICAgIHZhciBfaGFzTWF0Y2hpbmdPcHRpb25zID0gX3RoaXMuc3RhdGUubWF0Y2hpbmdPcHRpb25zLmxlbmd0aCA+IDA7CgogICAgICAgIG9uU2VhcmNoQ2hhbmdlKHNlYXJjaFZhbHVlLCBfaGFzTWF0Y2hpbmdPcHRpb25zKTsKICAgICAgfQoKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIHNlYXJjaFZhbHVlOiBzZWFyY2hWYWx1ZQogICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHNlYXJjaFZhbHVlICYmIF90aGlzLnN0YXRlLmlzTGlzdE9wZW4gPT09IGZhbHNlKSBfdGhpcy5vcGVuTGlzdCgpOwogICAgICB9KTsKCiAgICAgIGlmIChkZWxpbWl0ZXIgJiYgc2VhcmNoVmFsdWUuZW5kc1dpdGgoZGVsaW1pdGVyKSkgewogICAgICAgIF90aGlzLnNldEN1c3RvbU9wdGlvbnMoZmFsc2UpOwogICAgICB9CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJ1cGRhdGVNYXRjaGluZ09wdGlvbnNJZkRpZmZlcmVudCIsIGZ1bmN0aW9uIChuZXdNYXRjaGluZ09wdGlvbnMpIHsKICAgICAgdmFyIF90aGlzJHN0YXRlID0gX3RoaXMuc3RhdGUsCiAgICAgICAgICBtYXRjaGluZ09wdGlvbnMgPSBfdGhpcyRzdGF0ZS5tYXRjaGluZ09wdGlvbnMsCiAgICAgICAgICBhY3RpdmVPcHRpb25JbmRleCA9IF90aGlzJHN0YXRlLmFjdGl2ZU9wdGlvbkluZGV4OwogICAgICB2YXIgX3RoaXMkcHJvcHM2ID0gX3RoaXMucHJvcHMsCiAgICAgICAgICBzaW5nbGVTZWxlY3Rpb24gPSBfdGhpcyRwcm9wczYuc2luZ2xlU2VsZWN0aW9uLAogICAgICAgICAgc2VsZWN0ZWRPcHRpb25zID0gX3RoaXMkcHJvcHM2LnNlbGVjdGVkT3B0aW9uczsKICAgICAgdmFyIGFyZU9wdGlvbnNEaWZmZXJlbnQgPSBmYWxzZTsKCiAgICAgIGlmIChtYXRjaGluZ09wdGlvbnMubGVuZ3RoICE9PSBuZXdNYXRjaGluZ09wdGlvbnMubGVuZ3RoKSB7CiAgICAgICAgYXJlT3B0aW9uc0RpZmZlcmVudCA9IHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXRjaGluZ09wdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmIChtYXRjaGluZ09wdGlvbnNbaV0ubGFiZWwgIT09IG5ld01hdGNoaW5nT3B0aW9uc1tpXS5sYWJlbCkgewogICAgICAgICAgICBhcmVPcHRpb25zRGlmZmVyZW50ID0gdHJ1ZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoYXJlT3B0aW9uc0RpZmZlcmVudCkgewogICAgICAgIF90aGlzLm9wdGlvbnNSZWZJbnN0YW5jZXMgPSBbXTsKICAgICAgICB2YXIgbmV4dEFjdGl2ZU9wdGlvbkluZGV4ID0gYWN0aXZlT3B0aW9uSW5kZXg7IC8vIGVuc3VyZSB0aGF0IHRoZSBjdXJyZW50bHkgc2VsZWN0ZWQgc2luZ2xlIG9wdGlvbiBpcyBhY3RpdmUgaWYgaXQgaXMgaW4gdGhlIG1hdGNoaW5nT3B0aW9ucwoKICAgICAgICBpZiAoQm9vbGVhbihzaW5nbGVTZWxlY3Rpb24pICYmIHNlbGVjdGVkT3B0aW9ucy5sZW5ndGggPT09IDEpIHsKICAgICAgICAgIGlmIChuZXdNYXRjaGluZ09wdGlvbnMuaW5jbHVkZXMoc2VsZWN0ZWRPcHRpb25zWzBdKSkgewogICAgICAgICAgICBuZXh0QWN0aXZlT3B0aW9uSW5kZXggPSBuZXdNYXRjaGluZ09wdGlvbnMuaW5kZXhPZihzZWxlY3RlZE9wdGlvbnNbMF0pOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgbWF0Y2hpbmdPcHRpb25zOiBuZXdNYXRjaGluZ09wdGlvbnMsCiAgICAgICAgICBhY3RpdmVPcHRpb25JbmRleDogbmV4dEFjdGl2ZU9wdGlvbkluZGV4CiAgICAgICAgfSk7CgogICAgICAgIGlmICghbmV3TWF0Y2hpbmdPcHRpb25zLmxlbmd0aCkgewogICAgICAgICAgLy8gUHJldmVudCBlbmRsZXNzIHNldFN0YXRlIC0+IGNvbXBvbmVudFdpbGxVcGRhdGUgLT4gc2V0U3RhdGUgbG9vcC4KICAgICAgICAgIGlmIChfdGhpcy5oYXNBY3RpdmVPcHRpb24oKSkgewogICAgICAgICAgICBfdGhpcy5jbGVhckFjdGl2ZU9wdGlvbigpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIF90aGlzOwogIH0KCiAgX2NyZWF0ZUNsYXNzKEV1aUNvbWJvQm94LCBbewogICAga2V5OiAiY29tcG9uZW50RGlkTW91bnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudERpZE1vdW50KCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHRoaXMuX2lzTW91bnRlZCA9IHRydWU7IC8vIFRPRE86IFRoaXMgd2lsbCBuZWVkIHRvIGJlIGNhbGxlZCBvbmNlIHRoZSBhY3R1YWwgc3R5bGVzaGVldCBsb2Fkcy4KCiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIGlmIChfdGhpczIuYXV0b1NpemVJbnB1dFJlZkluc3RhbmNlKSB7CiAgICAgICAgICBfdGhpczIuYXV0b1NpemVJbnB1dFJlZkluc3RhbmNlLmNvcHlJbnB1dFN0eWxlcygpOwogICAgICAgIH0KICAgICAgfSwgMTAwKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjb21wb25lbnREaWRVcGRhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudERpZFVwZGF0ZSgpIHsKICAgICAgdmFyIF90aGlzJHByb3BzNyA9IHRoaXMucHJvcHMsCiAgICAgICAgICBvcHRpb25zID0gX3RoaXMkcHJvcHM3Lm9wdGlvbnMsCiAgICAgICAgICBzZWxlY3RlZE9wdGlvbnMgPSBfdGhpcyRwcm9wczcuc2VsZWN0ZWRPcHRpb25zLAogICAgICAgICAgc2luZ2xlU2VsZWN0aW9uID0gX3RoaXMkcHJvcHM3LnNpbmdsZVNlbGVjdGlvbiwKICAgICAgICAgIHNvcnRNYXRjaGVzQnkgPSBfdGhpcyRwcm9wczcuc29ydE1hdGNoZXNCeTsKICAgICAgdmFyIHNlYXJjaFZhbHVlID0gdGhpcy5zdGF0ZS5zZWFyY2hWYWx1ZTsgLy8gUmVhY3QgMTYuMyBoYXMgYSBidWcgKGZpeGVkIGluIDE2LjQpIHdoZXJlIGdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcwogICAgICAvLyBpc24ndCBjYWxsZWQgYWZ0ZXIgYSBzdGF0ZSBjaGFuZ2UsIGFuZCB3ZSB0cmFjayBgc2VhcmNoVmFsdWVgIGluIHN0YXRlCiAgICAgIC8vIGluc3RlYWQgd2UgbmVlZCB0byByZWFjdCB0byBhIGNoYW5nZSBpbiBzZWFyY2hWYWx1ZSBoZXJlCgogICAgICB0aGlzLnVwZGF0ZU1hdGNoaW5nT3B0aW9uc0lmRGlmZmVyZW50KGdldE1hdGNoaW5nT3B0aW9ucyhvcHRpb25zLCBzZWxlY3RlZE9wdGlvbnMsIHNlYXJjaFZhbHVlLCB0aGlzLnByb3BzLmFzeW5jLCBCb29sZWFuKHNpbmdsZVNlbGVjdGlvbiksIHNvcnRNYXRjaGVzQnkpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjb21wb25lbnRXaWxsVW5tb3VudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29tcG9uZW50V2lsbFVubW91bnQoKSB7CiAgICAgIHRoaXMuX2lzTW91bnRlZCA9IGZhbHNlOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICB2YXIgX3RoaXMkcHJvcHM4ID0gdGhpcy5wcm9wcywKICAgICAgICAgIGRhdGFUZXN0U3ViaiA9IF90aGlzJHByb3BzOFsnZGF0YS10ZXN0LXN1YmonXSwKICAgICAgICAgIGFzeW5jID0gX3RoaXMkcHJvcHM4LmFzeW5jLAogICAgICAgICAgY2xhc3NOYW1lID0gX3RoaXMkcHJvcHM4LmNsYXNzTmFtZSwKICAgICAgICAgIGNvbXByZXNzZWQgPSBfdGhpcyRwcm9wczguY29tcHJlc3NlZCwKICAgICAgICAgIGN1c3RvbU9wdGlvblRleHQgPSBfdGhpcyRwcm9wczguY3VzdG9tT3B0aW9uVGV4dCwKICAgICAgICAgIGZ1bGxXaWR0aCA9IF90aGlzJHByb3BzOC5mdWxsV2lkdGgsCiAgICAgICAgICBpZCA9IF90aGlzJHByb3BzOC5pZCwKICAgICAgICAgIGlucHV0UmVmID0gX3RoaXMkcHJvcHM4LmlucHV0UmVmLAogICAgICAgICAgaXNDbGVhcmFibGUgPSBfdGhpcyRwcm9wczguaXNDbGVhcmFibGUsCiAgICAgICAgICBpc0Rpc2FibGVkID0gX3RoaXMkcHJvcHM4LmlzRGlzYWJsZWQsCiAgICAgICAgICBpc0ludmFsaWQgPSBfdGhpcyRwcm9wczguaXNJbnZhbGlkLAogICAgICAgICAgaXNMb2FkaW5nID0gX3RoaXMkcHJvcHM4LmlzTG9hZGluZywKICAgICAgICAgIG5vU3VnZ2VzdGlvbnMgPSBfdGhpcyRwcm9wczgubm9TdWdnZXN0aW9ucywKICAgICAgICAgIG9uQmx1ciA9IF90aGlzJHByb3BzOC5vbkJsdXIsCiAgICAgICAgICBvbkNoYW5nZSA9IF90aGlzJHByb3BzOC5vbkNoYW5nZSwKICAgICAgICAgIG9uQ3JlYXRlT3B0aW9uID0gX3RoaXMkcHJvcHM4Lm9uQ3JlYXRlT3B0aW9uLAogICAgICAgICAgb25TZWFyY2hDaGFuZ2UgPSBfdGhpcyRwcm9wczgub25TZWFyY2hDaGFuZ2UsCiAgICAgICAgICBvcHRpb25zID0gX3RoaXMkcHJvcHM4Lm9wdGlvbnMsCiAgICAgICAgICBwbGFjZWhvbGRlciA9IF90aGlzJHByb3BzOC5wbGFjZWhvbGRlciwKICAgICAgICAgIHJlbmRlck9wdGlvbiA9IF90aGlzJHByb3BzOC5yZW5kZXJPcHRpb24sCiAgICAgICAgICByb3dIZWlnaHQgPSBfdGhpcyRwcm9wczgucm93SGVpZ2h0LAogICAgICAgICAgc2VsZWN0ZWRPcHRpb25zID0gX3RoaXMkcHJvcHM4LnNlbGVjdGVkT3B0aW9ucywKICAgICAgICAgIHNpbmdsZVNlbGVjdGlvbiA9IF90aGlzJHByb3BzOC5zaW5nbGVTZWxlY3Rpb24sCiAgICAgICAgICBwcmVwZW5kID0gX3RoaXMkcHJvcHM4LnByZXBlbmQsCiAgICAgICAgICBzb3J0TWF0Y2hlc0J5ID0gX3RoaXMkcHJvcHM4LnNvcnRNYXRjaGVzQnksCiAgICAgICAgICBkZWxpbWl0ZXIgPSBfdGhpcyRwcm9wczguZGVsaW1pdGVyLAogICAgICAgICAgYXBwZW5kID0gX3RoaXMkcHJvcHM4LmFwcGVuZCwKICAgICAgICAgIGF1dG9Gb2N1cyA9IF90aGlzJHByb3BzOC5hdXRvRm9jdXMsCiAgICAgICAgICByZXN0ID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKF90aGlzJHByb3BzOCwgWyJkYXRhLXRlc3Qtc3ViaiIsICJhc3luYyIsICJjbGFzc05hbWUiLCAiY29tcHJlc3NlZCIsICJjdXN0b21PcHRpb25UZXh0IiwgImZ1bGxXaWR0aCIsICJpZCIsICJpbnB1dFJlZiIsICJpc0NsZWFyYWJsZSIsICJpc0Rpc2FibGVkIiwgImlzSW52YWxpZCIsICJpc0xvYWRpbmciLCAibm9TdWdnZXN0aW9ucyIsICJvbkJsdXIiLCAib25DaGFuZ2UiLCAib25DcmVhdGVPcHRpb24iLCAib25TZWFyY2hDaGFuZ2UiLCAib3B0aW9ucyIsICJwbGFjZWhvbGRlciIsICJyZW5kZXJPcHRpb24iLCAicm93SGVpZ2h0IiwgInNlbGVjdGVkT3B0aW9ucyIsICJzaW5nbGVTZWxlY3Rpb24iLCAicHJlcGVuZCIsICJzb3J0TWF0Y2hlc0J5IiwgImRlbGltaXRlciIsICJhcHBlbmQiLCAiYXV0b0ZvY3VzIl0pOwoKICAgICAgdmFyIF90aGlzJHN0YXRlMiA9IHRoaXMuc3RhdGUsCiAgICAgICAgICBhY3RpdmVPcHRpb25JbmRleCA9IF90aGlzJHN0YXRlMi5hY3RpdmVPcHRpb25JbmRleCwKICAgICAgICAgIGhhc0ZvY3VzID0gX3RoaXMkc3RhdGUyLmhhc0ZvY3VzLAogICAgICAgICAgaXNMaXN0T3BlbiA9IF90aGlzJHN0YXRlMi5pc0xpc3RPcGVuLAogICAgICAgICAgbGlzdFBvc2l0aW9uID0gX3RoaXMkc3RhdGUyLmxpc3RQb3NpdGlvbiwKICAgICAgICAgIHNlYXJjaFZhbHVlID0gX3RoaXMkc3RhdGUyLnNlYXJjaFZhbHVlLAogICAgICAgICAgd2lkdGggPSBfdGhpcyRzdGF0ZTIud2lkdGgsCiAgICAgICAgICBtYXRjaGluZ09wdGlvbnMgPSBfdGhpcyRzdGF0ZTIubWF0Y2hpbmdPcHRpb25zOyAvLyBWaXN1YWxseSBpbmRpY2F0ZSB0aGUgY29tYm9ib3ggaXMgaW4gYW4gaW52YWxpZCBzdGF0ZSBpZiBpdCBoYXMgbG9zdCBmb2N1cyBidXQgdGhlcmUgaXMgdGV4dCBlbnRlcmVkIGluIHRoZSBpbnB1dC4KICAgICAgLy8gV2hlbiBjdXN0b20gb3B0aW9ucyBhcmUgZGlzYWJsZWQgYW5kIHRoZSB1c2VyIGxlYXZlcyB0aGUgY29tYm8gYm94IGFmdGVyIGVudGVyaW5nIHRleHQgdGhhdCBkb2VzIG5vdCBtYXRjaCBhbnkKICAgICAgLy8gb3B0aW9ucywgdGhpcyB0ZWxscyB0aGUgdXNlciB0aGF0IHRoZXkndmUgZW50ZXJlZCBpbnZhbGlkIGlucHV0LgoKICAgICAgdmFyIG1hcmtBc0ludmFsaWQgPSBpc0ludmFsaWQgfHwgKGhhc0ZvY3VzID09PSBmYWxzZSB8fCBpc0xpc3RPcGVuID09PSBmYWxzZSkgJiYgc2VhcmNoVmFsdWU7CiAgICAgIHZhciBjbGFzc2VzID0gY2xhc3NOYW1lcygnZXVpQ29tYm9Cb3gnLCBjbGFzc05hbWUsIHsKICAgICAgICAnZXVpQ29tYm9Cb3gtLWNvbXByZXNzZWQnOiBjb21wcmVzc2VkLAogICAgICAgICdldWlDb21ib0JveC0tZnVsbFdpZHRoJzogZnVsbFdpZHRoLAogICAgICAgICdldWlDb21ib0JveC1pc0Rpc2FibGVkJzogaXNEaXNhYmxlZCwKICAgICAgICAnZXVpQ29tYm9Cb3gtaXNJbnZhbGlkJzogbWFya0FzSW52YWxpZCwKICAgICAgICAnZXVpQ29tYm9Cb3gtaXNPcGVuJzogaXNMaXN0T3BlbgogICAgICB9KTsKICAgICAgdmFyIHZhbHVlID0gc2VsZWN0ZWRPcHRpb25zLm1hcChmdW5jdGlvbiAoc2VsZWN0ZWRPcHRpb24pIHsKICAgICAgICByZXR1cm4gc2VsZWN0ZWRPcHRpb24ubGFiZWw7CiAgICAgIH0pLmpvaW4oJywgJyk7CiAgICAgIHZhciBvcHRpb25zTGlzdDsKCiAgICAgIGlmICghbm9TdWdnZXN0aW9ucyAmJiBpc0xpc3RPcGVuKSB7CiAgICAgICAgdmFyIG9wdGlvbnNMaXN0RGF0YVRlc3RTdWJqID0gZGF0YVRlc3RTdWJqID8gIiIuY29uY2F0KGRhdGFUZXN0U3ViaiwgIi1vcHRpb25zTGlzdCIpIDogdW5kZWZpbmVkOwogICAgICAgIG9wdGlvbnNMaXN0ID0gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoRXVpUG9ydGFsLCBudWxsLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChFdWlDb21ib0JveE9wdGlvbnNMaXN0LCB7CiAgICAgICAgICB6SW5kZXg6IHRoaXMuc3RhdGUubGlzdFpJbmRleCwKICAgICAgICAgIGFjdGl2ZU9wdGlvbkluZGV4OiB0aGlzLnN0YXRlLmFjdGl2ZU9wdGlvbkluZGV4LAogICAgICAgICAgYXJlQWxsT3B0aW9uc1NlbGVjdGVkOiB0aGlzLmFyZUFsbE9wdGlvbnNTZWxlY3RlZCgpLAogICAgICAgICAgY3VzdG9tT3B0aW9uVGV4dDogY3VzdG9tT3B0aW9uVGV4dCwKICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6IG9wdGlvbnNMaXN0RGF0YVRlc3RTdWJqLAogICAgICAgICAgZnVsbFdpZHRoOiBmdWxsV2lkdGgsCiAgICAgICAgICBpc0xvYWRpbmc6IGlzTG9hZGluZywKICAgICAgICAgIGxpc3RSZWY6IHRoaXMubGlzdFJlZkNhbGxiYWNrLAogICAgICAgICAgbWF0Y2hpbmdPcHRpb25zOiBtYXRjaGluZ09wdGlvbnMsCiAgICAgICAgICBvbkNsb3NlTGlzdDogdGhpcy5jbG9zZUxpc3QsCiAgICAgICAgICBvbkNyZWF0ZU9wdGlvbjogb25DcmVhdGVPcHRpb24sCiAgICAgICAgICBvbk9wdGlvbkNsaWNrOiB0aGlzLm9uT3B0aW9uQ2xpY2ssCiAgICAgICAgICBvbk9wdGlvbkVudGVyS2V5OiB0aGlzLm9uT3B0aW9uRW50ZXJLZXksCiAgICAgICAgICBvblNjcm9sbDogdGhpcy5vbk9wdGlvbkxpc3RTY3JvbGwsCiAgICAgICAgICBvcHRpb25SZWY6IHRoaXMub3B0aW9uUmVmQ2FsbGJhY2ssCiAgICAgICAgICBvcHRpb25zOiBvcHRpb25zLAogICAgICAgICAgcG9zaXRpb246IGxpc3RQb3NpdGlvbiwKICAgICAgICAgIHNpbmdsZVNlbGVjdGlvbjogc2luZ2xlU2VsZWN0aW9uLAogICAgICAgICAgcmVuZGVyT3B0aW9uOiByZW5kZXJPcHRpb24sCiAgICAgICAgICByb290SWQ6IHRoaXMucm9vdElkLAogICAgICAgICAgcm93SGVpZ2h0OiByb3dIZWlnaHQsCiAgICAgICAgICBzY3JvbGxUb0luZGV4OiBhY3RpdmVPcHRpb25JbmRleCwKICAgICAgICAgIHNlYXJjaFZhbHVlOiBzZWFyY2hWYWx1ZSwKICAgICAgICAgIHNlbGVjdGVkT3B0aW9uczogc2VsZWN0ZWRPcHRpb25zLAogICAgICAgICAgdXBkYXRlUG9zaXRpb246IHRoaXMudXBkYXRlUG9zaXRpb24sCiAgICAgICAgICB3aWR0aDogd2lkdGgsCiAgICAgICAgICBkZWxpbWl0ZXI6IGRlbGltaXRlciwKICAgICAgICAgIGdldFNlbGVjdGVkT3B0aW9uRm9yU2VhcmNoVmFsdWU6IGdldFNlbGVjdGVkT3B0aW9uRm9yU2VhcmNoVmFsdWUKICAgICAgICB9KSk7CiAgICAgIH0KCiAgICAgIHJldHVybiAoCiAgICAgICAgLyojX19QVVJFX18qLwoKICAgICAgICAvKioKICAgICAgICAgKiBSZToganN4LWExMXkvaW50ZXJhY3RpdmUtc3VwcG9ydHMtZm9jdXMKICAgICAgICAgKiBGb2N1cyBpcyBtYW5hZ2VkIGFuZCBpcyBwbGFjZWQgb24gdGhlIHRleHRib3ggZWxlbWVudCAoYEV1aUNvbWJvQm94SW5wdXRgKQogICAgICAgICAqCiAgICAgICAgICogUmU6IGpzeC1hMTF5L3JvbGUtaGFzLXJlcXVpcmVkLWFyaWEtcHJvcHMKICAgICAgICAgKiBFeHBhbnNpb24gaXMgbWFuYWdlZCBhbmQgcmVxdWlyZWQgYGFyaWEtY29udHJvbHNgIHByb3AgaXMgcGxhY2VkIG9uIHRoZSB0ZXh0Ym94IGVsZW1lbnQgKGBFdWlDb21ib0JveElucHV0YCkKICAgICAgICAgKgogICAgICAgICAqIFJlZmVyZW5jZSBmb3IgYm90aDogaHR0cHM6Ly93d3cudzMub3JnL1RSLzIwMTcvUkVDLXdhaS1hcmlhLTEuMS0yMDE3MTIxNC8jY29tYm9ib3gsCiAgICAgICAgICogd2hpY2ggdmVyaWZpZXMgdGhhdCB0aGlzIGltcGxlbWVudGF0aW9uIGZvbGxvd3MgdGhlIHNwZWMuCiAgICAgICAgICovCiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGpzeC1hMTF5L2ludGVyYWN0aXZlLXN1cHBvcnRzLWZvY3VzCiAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgX2V4dGVuZHMoe30sIHJlc3QsIHsKICAgICAgICAgICJhcmlhLWV4cGFuZGVkIjogaXNMaXN0T3BlbiwKICAgICAgICAgICJhcmlhLWhhc3BvcHVwIjogImxpc3Rib3giLAogICAgICAgICAgY2xhc3NOYW1lOiBjbGFzc2VzLAogICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogZGF0YVRlc3RTdWJqLAogICAgICAgICAgb25LZXlEb3duOiB0aGlzLm9uS2V5RG93biwKICAgICAgICAgIHJlZjogdGhpcy5jb21ib0JveFJlZkNhbGxiYWNrLAogICAgICAgICAgcm9sZTogImNvbWJvYm94IgogICAgICAgIH0pLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChFdWlDb21ib0JveElucHV0LCB7CiAgICAgICAgICBhdXRvU2l6ZUlucHV0UmVmOiB0aGlzLmF1dG9TaXplSW5wdXRSZWZDYWxsYmFjaywKICAgICAgICAgIGNvbXByZXNzZWQ6IGNvbXByZXNzZWQsCiAgICAgICAgICBmb2N1c2VkT3B0aW9uSWQ6IHRoaXMuaGFzQWN0aXZlT3B0aW9uKCkgPyB0aGlzLnJvb3RJZCgiX29wdGlvbi0iLmNvbmNhdCh0aGlzLnN0YXRlLmFjdGl2ZU9wdGlvbkluZGV4KSkgOiB1bmRlZmluZWQsCiAgICAgICAgICBmdWxsV2lkdGg6IGZ1bGxXaWR0aCwKICAgICAgICAgIGhhc1NlbGVjdGVkT3B0aW9uczogc2VsZWN0ZWRPcHRpb25zLmxlbmd0aCA+IDAsCiAgICAgICAgICBpZDogaWQsCiAgICAgICAgICBpbnB1dFJlZjogdGhpcy5zZWFyY2hJbnB1dFJlZkNhbGxiYWNrLAogICAgICAgICAgaXNEaXNhYmxlZDogaXNEaXNhYmxlZCwKICAgICAgICAgIGlzTGlzdE9wZW46IGlzTGlzdE9wZW4sCiAgICAgICAgICBub0ljb246ICEhbm9TdWdnZXN0aW9ucywKICAgICAgICAgIG9uQ2hhbmdlOiB0aGlzLm9uU2VhcmNoQ2hhbmdlLAogICAgICAgICAgb25DbGVhcjogaXNDbGVhcmFibGUgJiYgIWlzRGlzYWJsZWQgPyB0aGlzLmNsZWFyU2VsZWN0ZWRPcHRpb25zIDogdW5kZWZpbmVkLAogICAgICAgICAgb25DbGljazogdGhpcy5vbkNvbWJvQm94Q2xpY2ssCiAgICAgICAgICBvbkNsb3NlTGlzdENsaWNrOiB0aGlzLm9uQ2xvc2VMaXN0Q2xpY2ssCiAgICAgICAgICBvbkZvY3VzOiB0aGlzLm9uQ29tYm9Cb3hGb2N1cywKICAgICAgICAgIG9uT3Blbkxpc3RDbGljazogdGhpcy5vbk9wZW5MaXN0Q2xpY2ssCiAgICAgICAgICBvblJlbW92ZU9wdGlvbjogdGhpcy5vblJlbW92ZU9wdGlvbiwKICAgICAgICAgIHBsYWNlaG9sZGVyOiBwbGFjZWhvbGRlciwKICAgICAgICAgIHJvb3RJZDogdGhpcy5yb290SWQsCiAgICAgICAgICBzZWFyY2hWYWx1ZTogc2VhcmNoVmFsdWUsCiAgICAgICAgICBzZWxlY3RlZE9wdGlvbnM6IHNlbGVjdGVkT3B0aW9ucywKICAgICAgICAgIHNpbmdsZVNlbGVjdGlvbjogc2luZ2xlU2VsZWN0aW9uLAogICAgICAgICAgdG9nZ2xlQnV0dG9uUmVmOiB0aGlzLnRvZ2dsZUJ1dHRvblJlZkNhbGxiYWNrLAogICAgICAgICAgdXBkYXRlUG9zaXRpb246IHRoaXMudXBkYXRlUG9zaXRpb24sCiAgICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgICBhcHBlbmQ6IHNpbmdsZVNlbGVjdGlvbiA/IGFwcGVuZCA6IHVuZGVmaW5lZCwKICAgICAgICAgIHByZXBlbmQ6IHNpbmdsZVNlbGVjdGlvbiA/IHByZXBlbmQgOiB1bmRlZmluZWQsCiAgICAgICAgICBpc0xvYWRpbmc6IGlzTG9hZGluZywKICAgICAgICAgIGF1dG9Gb2N1czogYXV0b0ZvY3VzCiAgICAgICAgfSksIG9wdGlvbnNMaXN0KQogICAgICApOwogICAgfQogIH1dLCBbewogICAga2V5OiAiZ2V0RGVyaXZlZFN0YXRlRnJvbVByb3BzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMobmV4dFByb3BzLCBwcmV2U3RhdGUpIHsKICAgICAgdmFyIG9wdGlvbnMgPSBuZXh0UHJvcHMub3B0aW9ucywKICAgICAgICAgIHNlbGVjdGVkT3B0aW9ucyA9IG5leHRQcm9wcy5zZWxlY3RlZE9wdGlvbnMsCiAgICAgICAgICBzaW5nbGVTZWxlY3Rpb24gPSBuZXh0UHJvcHMuc2luZ2xlU2VsZWN0aW9uLAogICAgICAgICAgc29ydE1hdGNoZXNCeSA9IG5leHRQcm9wcy5zb3J0TWF0Y2hlc0J5OwogICAgICB2YXIgYWN0aXZlT3B0aW9uSW5kZXggPSBwcmV2U3RhdGUuYWN0aXZlT3B0aW9uSW5kZXgsCiAgICAgICAgICBzZWFyY2hWYWx1ZSA9IHByZXZTdGF0ZS5zZWFyY2hWYWx1ZTsgLy8gQ2FsY3VsYXRlIGFuZCBjYWNoZSB0aGUgb3B0aW9ucyB3aGljaCBtYXRjaCB0aGUgc2VhcmNoVmFsdWUsIGJlY2F1c2Ugd2UgdXNlIHRoaXMgaW5mb3JtYXRpb24KICAgICAgLy8gaW4gbXVsdGlwbGUgcGxhY2VzIGFuZCBpdCB3b3VsZCBiZSBleHBlbnNpdmUgdG8gY2FsY3VsYXRlIHJlcGVhdGVkbHkuCgogICAgICB2YXIgbWF0Y2hpbmdPcHRpb25zID0gZ2V0TWF0Y2hpbmdPcHRpb25zKG9wdGlvbnMsIHNlbGVjdGVkT3B0aW9ucywgc2VhcmNoVmFsdWUsIG5leHRQcm9wcy5hc3luYywgQm9vbGVhbihzaW5nbGVTZWxlY3Rpb24pLCBzb3J0TWF0Y2hlc0J5KTsKICAgICAgdmFyIHN0YXRlVXBkYXRlID0gewogICAgICAgIG1hdGNoaW5nT3B0aW9uczogbWF0Y2hpbmdPcHRpb25zCiAgICAgIH07CgogICAgICBpZiAoYWN0aXZlT3B0aW9uSW5kZXggPj0gbWF0Y2hpbmdPcHRpb25zLmxlbmd0aCkgewogICAgICAgIHN0YXRlVXBkYXRlLmFjdGl2ZU9wdGlvbkluZGV4ID0gLTE7CiAgICAgIH0KCiAgICAgIHJldHVybiBzdGF0ZVVwZGF0ZTsKICAgIH0KICB9XSk7CgogIHJldHVybiBFdWlDb21ib0JveDsKfShDb21wb25lbnQpOwoKX2RlZmluZVByb3BlcnR5KEV1aUNvbWJvQm94LCAiZGVmYXVsdFByb3BzIiwgewogIGFzeW5jOiBmYWxzZSwKICBjb21wcmVzc2VkOiBmYWxzZSwKICBmdWxsV2lkdGg6IGZhbHNlLAogIGlzQ2xlYXJhYmxlOiB0cnVlLAogIG9wdGlvbnM6IFtdLAogIHNlbGVjdGVkT3B0aW9uczogW10sCiAgc2luZ2xlU2VsZWN0aW9uOiBmYWxzZSwKICBwcmVwZW5kOiB1bmRlZmluZWQsCiAgYXBwZW5kOiB1bmRlZmluZWQsCiAgc29ydE1hdGNoZXNCeTogJ25vbmUnCn0pOwoKRXVpQ29tYm9Cb3gucHJvcFR5cGVzID0gewogICJkYXRhLXRlc3Qtc3ViaiI6IFByb3BUeXBlcy5zdHJpbmcsCgogIC8qKgogICAgICogVXBkYXRlcyB0aGUgbGlzdCBvZiBvcHRpb25zIGFzeW5jaHJvbm91c2x5CiAgICAgKi8KICBhc3luYzogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCwKICBjbGFzc05hbWU6IFByb3BUeXBlcy5zdHJpbmcsCgogIC8qKgogICAgICogV2hlbiBgdHJ1ZWAgY3JlYXRlcyBhIHNob3J0ZXIgaGVpZ2h0IGlucHV0CiAgICAgKi8KICBjb21wcmVzc2VkOiBQcm9wVHlwZXMuYm9vbC5pc1JlcXVpcmVkLAoKICAvKioKICAgICAqIFdoZW4gYHRydWVgIGV4cGFuZHMgdG8gdGhlIGVudGlyZSB3aWR0aCBhdmFpbGFibGUKICAgICAqLwogIGZ1bGxXaWR0aDogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCwKICBpZDogUHJvcFR5cGVzLnN0cmluZywKICBpbnB1dFJlZjogUHJvcFR5cGVzLmFueSwKCiAgLyoqCiAgICAgKiBTaG93cyBhIGJ1dHRvbiB0aGF0IHF1aWNrbHkgY2xlYXJzIGFueSBpbnB1dAogICAgICovCiAgaXNDbGVhcmFibGU6IFByb3BUeXBlcy5ib29sLmlzUmVxdWlyZWQsCgogIC8qKgogICAgICogRGlzYWJsZXMgdGhlIGlucHV0CiAgICAgKi8KICBpc0Rpc2FibGVkOiBQcm9wVHlwZXMuYm9vbCwKICBpc0ludmFsaWQ6IFByb3BUeXBlcy5ib29sLAoKICAvKioKICAgICAqIFN3YXBzIHRoZSBkcm9wZG93biBvcHRpb25zIGZvciBhIGxvYWRpbmcgc3Bpbm5lcgogICAgICovCiAgaXNMb2FkaW5nOiBQcm9wVHlwZXMuYm9vbCwKCiAgLyoqCiAgICAgKiBEb2Vzbid0IHNob3cgdGhlIHN1Z2dlc3Rpb25zIGxpc3QvZHJvcGRvd24KICAgICAqLwogIG5vU3VnZ2VzdGlvbnM6IFByb3BUeXBlcy5ib29sLAogIG9uQmx1cjogUHJvcFR5cGVzLmFueSwKCiAgLyoqCiAgICAgKiBDYWxsZWQgZXZlcnkgdGltZSB0aGUgcXVlcnkgaW4gdGhlIGNvbWJvIGJveCBpcyBwYXJzZWQKICAgICAqLwogIG9uQ2hhbmdlOiBQcm9wVHlwZXMuZnVuYywKICBvbkZvY3VzOiBQcm9wVHlwZXMuYW55LAogIG9uS2V5RG93bjogUHJvcFR5cGVzLmFueSwKCiAgLyoqCiAgICAgKiBDYWxsZWQgZXZlcnkgdGltZSB0aGUgdGV4dCBxdWVyeSBpbiB0aGUgc2VhcmNoIGJveCBpcyBwYXJzZWQKICAgICAqLwogIG9uU2VhcmNoQ2hhbmdlOiBQcm9wVHlwZXMuZnVuYywKCiAgLyoqCiAgICAgKiBTZXRzIHRoZSBwbGFjZWhvbGRlciBvZiB0aGUgaW5wdXQKICAgICAqLwogIHBsYWNlaG9sZGVyOiBQcm9wVHlwZXMuc3RyaW5nLAoKICAvKioKICAgICAqIEV2ZXJ5IG9wdGlvbiBtdXN0IGJlIHRoZSBzYW1lIGhlaWdodCBhbmQgbXVzdCBiZSBleHBsaWNpdGx5IHNldCBpZiB1c2luZyBhIGN1c3RvbSByZW5kZXIKICAgICAqLwogIHJvd0hlaWdodDogUHJvcFR5cGVzLm51bWJlciwKCiAgLyoqCiAgICAgKiBXaGVuIGB0cnVlYCBvbmx5IGFsbG93cyB0aGUgdXNlciB0byBzZWxlY3QgYSBzaW5nbGUgb3B0aW9uLiBTZXQgdG8gYHsgYXNQbGFpblRleHQ6IHRydWUgfWAgdG8gbm90IHJlbmRlciBpbnB1dCBzZWxlY3Rpb24gYXMgcGlsbHMKICAgICAqLwogIHNpbmdsZVNlbGVjdGlvbjogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCwgUHJvcFR5cGVzLnNoYXBlKHsKICAgIGFzUGxhaW5UZXh0OiBQcm9wVHlwZXMuYm9vbAogIH0pLmlzUmVxdWlyZWRdKS5pc1JlcXVpcmVkLAoKICAvKioKICAgICAqIERpc3BsYXkgbWF0Y2hpbmcgb3B0aW9ucyBieToKICAgICAqIGBzdGFydHNXaXRoYDogbW92ZXMgaXRlbXMgdGhhdCBzdGFydCB3aXRoIHNlYXJjaCB2YWx1ZSB0byB0b3Agb2YgdGhlIGxpc3Q7CiAgICAgKiBgbm9uZWA6IGRvbid0IGNoYW5nZSB0aGUgc29ydCBvcmRlciBvZiBpbml0aWFsIG9iamVjdAogICAgICovCiAgc29ydE1hdGNoZXNCeTogUHJvcFR5cGVzLm9uZU9mKFsibm9uZSIsICJzdGFydHNXaXRoIl0pLmlzUmVxdWlyZWQsCgogIC8qKgogICAgICogQ3JlYXRlcyBhbiBpbnB1dCBncm91cCB3aXRoIGVsZW1lbnQocykgY29taW5nIGJlZm9yZSBpbnB1dC4gSXQgd29uJ3Qgc2hvdyBpZiBgc2luZ2xlU2VsZWN0aW9uYCBpcyBzZXQgdG8gYGZhbHNlYC4KICAgICAqIGBzdHJpbmdgIHwgYFJlYWN0RWxlbWVudGAgb3IgYW4gYXJyYXkgb2YgdGhlc2UKICAgICAqLwogIHByZXBlbmQ6IFByb3BUeXBlcy5hbnksCgogIC8qKgogICAgICogQ3JlYXRlcyBhbiBpbnB1dCBncm91cCB3aXRoIGVsZW1lbnQocykgY29taW5nIGFmdGVyIGlucHV0LiBJdCB3b24ndCBzaG93IGlmIGBzaW5nbGVTZWxlY3Rpb25gIGlzIHNldCB0byBgZmFsc2VgLgogICAgICogYHN0cmluZ2AgfCBgUmVhY3RFbGVtZW50YCBvciBhbiBhcnJheSBvZiB0aGVzZQogICAgICovCiAgYXBwZW5kOiBQcm9wVHlwZXMuYW55LAoKICAvKioKICAgICAqIEEgc3BlY2lhbCBjaGFyYWN0ZXIgdG8gdXNlIGFzIGEgdmFsdWUgc2VwYXJhdG9yLiBUeXBpY2FsbHkgYSBjb21tYSBgLGAKICAgICAqLwogIGRlbGltaXRlcjogUHJvcFR5cGVzLnN0cmluZywKCiAgLyoqCiAgICAgKiBTcGVjaWZpZXMgdGhhdCB0aGUgaW5wdXQgc2hvdWxkIGhhdmUgZm9jdXMgd2hlbiB0aGUgY29tcG9uZW50IGxvYWRzCiAgICAgKi8KICBhdXRvRm9jdXM6IFByb3BUeXBlcy5ib29sLAogICJhcmlhLWxhYmVsIjogUHJvcFR5cGVzLnN0cmluZwp9OwoKdHJ5IHsKICBFdWlDb21ib0JveC5fX2RvY2dlbkluZm8gPSB7CiAgICBkZXNjcmlwdGlvbjogJycsCiAgICBkaXNwbGF5TmFtZTogJ0V1aUNvbWJvQm94JywKICAgIG1ldGhvZHM6IFtdLAogICAgcHJvcHM6IHsKICAgICAgJ2RhdGEtdGVzdC1zdWJqJzogewogICAgICAgIGRlZmF1bHRWYWx1ZTogbnVsbCwKICAgICAgICBkZXNjcmlwdGlvbjogJycsCiAgICAgICAgbmFtZTogJ2RhdGEtdGVzdC1zdWJqJywKICAgICAgICBwYXJlbnQ6IHsKICAgICAgICAgIGZpbGVOYW1lOiAnZXVpL3NyYy9jb21wb25lbnRzL2NvbWJvX2JveC9jb21ib19ib3gudHN4JywKICAgICAgICAgIG5hbWU6ICdfRXVpQ29tYm9Cb3hQcm9wcycKICAgICAgICB9LAogICAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICBuYW1lOiAnc3RyaW5nJwogICAgICAgIH0KICAgICAgfSwKICAgICAgYXN5bmM6IHsKICAgICAgICBkZWZhdWx0VmFsdWU6IHsKICAgICAgICAgIHZhbHVlOiAnZmFsc2UnCiAgICAgICAgfSwKICAgICAgICBkZXNjcmlwdGlvbjogJ1VwZGF0ZXMgdGhlIGxpc3Qgb2Ygb3B0aW9ucyBhc3luY2hyb25vdXNseScsCiAgICAgICAgbmFtZTogJ2FzeW5jJywKICAgICAgICBwYXJlbnQ6IHsKICAgICAgICAgIGZpbGVOYW1lOiAnZXVpL3NyYy9jb21wb25lbnRzL2NvbWJvX2JveC9jb21ib19ib3gudHN4JywKICAgICAgICAgIG5hbWU6ICdfRXVpQ29tYm9Cb3hQcm9wcycKICAgICAgICB9LAogICAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICBuYW1lOiAnYm9vbGVhbicKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGNsYXNzTmFtZTogewogICAgICAgIGRlZmF1bHRWYWx1ZTogbnVsbCwKICAgICAgICBkZXNjcmlwdGlvbjogJycsCiAgICAgICAgbmFtZTogJ2NsYXNzTmFtZScsCiAgICAgICAgcGFyZW50OiB7CiAgICAgICAgICBmaWxlTmFtZTogJ2V1aS9zcmMvY29tcG9uZW50cy9jb21ib19ib3gvY29tYm9fYm94LnRzeCcsCiAgICAgICAgICBuYW1lOiAnX0V1aUNvbWJvQm94UHJvcHMnCiAgICAgICAgfSwKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgdHlwZTogewogICAgICAgICAgbmFtZTogJ3N0cmluZycKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGNvbXByZXNzZWQ6IHsKICAgICAgICBkZWZhdWx0VmFsdWU6IHsKICAgICAgICAgIHZhbHVlOiAnZmFsc2UnCiAgICAgICAgfSwKICAgICAgICBkZXNjcmlwdGlvbjogJ1doZW4gYHRydWVgIGNyZWF0ZXMgYSBzaG9ydGVyIGhlaWdodCBpbnB1dCcsCiAgICAgICAgbmFtZTogJ2NvbXByZXNzZWQnLAogICAgICAgIHBhcmVudDogewogICAgICAgICAgZmlsZU5hbWU6ICdldWkvc3JjL2NvbXBvbmVudHMvY29tYm9fYm94L2NvbWJvX2JveC50c3gnLAogICAgICAgICAgbmFtZTogJ19FdWlDb21ib0JveFByb3BzJwogICAgICAgIH0sCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgIG5hbWU6ICdib29sZWFuJwogICAgICAgIH0KICAgICAgfSwKICAgICAgZnVsbFdpZHRoOiB7CiAgICAgICAgZGVmYXVsdFZhbHVlOiB7CiAgICAgICAgICB2YWx1ZTogJ2ZhbHNlJwogICAgICAgIH0sCiAgICAgICAgZGVzY3JpcHRpb246ICdXaGVuIGB0cnVlYCBleHBhbmRzIHRvIHRoZSBlbnRpcmUgd2lkdGggYXZhaWxhYmxlJywKICAgICAgICBuYW1lOiAnZnVsbFdpZHRoJywKICAgICAgICBwYXJlbnQ6IHsKICAgICAgICAgIGZpbGVOYW1lOiAnZXVpL3NyYy9jb21wb25lbnRzL2NvbWJvX2JveC9jb21ib19ib3gudHN4JywKICAgICAgICAgIG5hbWU6ICdfRXVpQ29tYm9Cb3hQcm9wcycKICAgICAgICB9LAogICAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICBuYW1lOiAnYm9vbGVhbicKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGlkOiB7CiAgICAgICAgZGVmYXVsdFZhbHVlOiBudWxsLAogICAgICAgIGRlc2NyaXB0aW9uOiAnJywKICAgICAgICBuYW1lOiAnaWQnLAogICAgICAgIHBhcmVudDogewogICAgICAgICAgZmlsZU5hbWU6ICdldWkvc3JjL2NvbXBvbmVudHMvY29tYm9fYm94L2NvbWJvX2JveC50c3gnLAogICAgICAgICAgbmFtZTogJ19FdWlDb21ib0JveFByb3BzJwogICAgICAgIH0sCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgIG5hbWU6ICdzdHJpbmcnCiAgICAgICAgfQogICAgICB9LAogICAgICBpbnB1dFJlZjogewogICAgICAgIGRlZmF1bHRWYWx1ZTogbnVsbCwKICAgICAgICBkZXNjcmlwdGlvbjogJycsCiAgICAgICAgbmFtZTogJ2lucHV0UmVmJywKICAgICAgICBwYXJlbnQ6IHsKICAgICAgICAgIGZpbGVOYW1lOiAnZXVpL3NyYy9jb21wb25lbnRzL2NvbWJvX2JveC9jb21ib19ib3gudHN4JywKICAgICAgICAgIG5hbWU6ICdfRXVpQ29tYm9Cb3hQcm9wcycKICAgICAgICB9LAogICAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICBuYW1lOiAnKGluc3RhbmNlOiBIVE1MSW5wdXRFbGVtZW50KSA9PiB2b2lkJwogICAgICAgIH0KICAgICAgfSwKICAgICAgaXNDbGVhcmFibGU6IHsKICAgICAgICBkZWZhdWx0VmFsdWU6IHsKICAgICAgICAgIHZhbHVlOiAndHJ1ZScKICAgICAgICB9LAogICAgICAgIGRlc2NyaXB0aW9uOiAnU2hvd3MgYSBidXR0b24gdGhhdCBxdWlja2x5IGNsZWFycyBhbnkgaW5wdXQnLAogICAgICAgIG5hbWU6ICdpc0NsZWFyYWJsZScsCiAgICAgICAgcGFyZW50OiB7CiAgICAgICAgICBmaWxlTmFtZTogJ2V1aS9zcmMvY29tcG9uZW50cy9jb21ib19ib3gvY29tYm9fYm94LnRzeCcsCiAgICAgICAgICBuYW1lOiAnX0V1aUNvbWJvQm94UHJvcHMnCiAgICAgICAgfSwKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgdHlwZTogewogICAgICAgICAgbmFtZTogJ2Jvb2xlYW4nCiAgICAgICAgfQogICAgICB9LAogICAgICBpc0Rpc2FibGVkOiB7CiAgICAgICAgZGVmYXVsdFZhbHVlOiBudWxsLAogICAgICAgIGRlc2NyaXB0aW9uOiAnRGlzYWJsZXMgdGhlIGlucHV0JywKICAgICAgICBuYW1lOiAnaXNEaXNhYmxlZCcsCiAgICAgICAgcGFyZW50OiB7CiAgICAgICAgICBmaWxlTmFtZTogJ2V1aS9zcmMvY29tcG9uZW50cy9jb21ib19ib3gvY29tYm9fYm94LnRzeCcsCiAgICAgICAgICBuYW1lOiAnX0V1aUNvbWJvQm94UHJvcHMnCiAgICAgICAgfSwKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgdHlwZTogewogICAgICAgICAgbmFtZTogJ2Jvb2xlYW4nCiAgICAgICAgfQogICAgICB9LAogICAgICBpc0ludmFsaWQ6IHsKICAgICAgICBkZWZhdWx0VmFsdWU6IG51bGwsCiAgICAgICAgZGVzY3JpcHRpb246ICcnLAogICAgICAgIG5hbWU6ICdpc0ludmFsaWQnLAogICAgICAgIHBhcmVudDogewogICAgICAgICAgZmlsZU5hbWU6ICdldWkvc3JjL2NvbXBvbmVudHMvY29tYm9fYm94L2NvbWJvX2JveC50c3gnLAogICAgICAgICAgbmFtZTogJ19FdWlDb21ib0JveFByb3BzJwogICAgICAgIH0sCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgIG5hbWU6ICdib29sZWFuJwogICAgICAgIH0KICAgICAgfSwKICAgICAgaXNMb2FkaW5nOiB7CiAgICAgICAgZGVmYXVsdFZhbHVlOiBudWxsLAogICAgICAgIGRlc2NyaXB0aW9uOiAnU3dhcHMgdGhlIGRyb3Bkb3duIG9wdGlvbnMgZm9yIGEgbG9hZGluZyBzcGlubmVyJywKICAgICAgICBuYW1lOiAnaXNMb2FkaW5nJywKICAgICAgICBwYXJlbnQ6IHsKICAgICAgICAgIGZpbGVOYW1lOiAnZXVpL3NyYy9jb21wb25lbnRzL2NvbWJvX2JveC9jb21ib19ib3gudHN4JywKICAgICAgICAgIG5hbWU6ICdfRXVpQ29tYm9Cb3hQcm9wcycKICAgICAgICB9LAogICAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICBuYW1lOiAnYm9vbGVhbicKICAgICAgICB9CiAgICAgIH0sCiAgICAgIG5vU3VnZ2VzdGlvbnM6IHsKICAgICAgICBkZWZhdWx0VmFsdWU6IG51bGwsCiAgICAgICAgZGVzY3JpcHRpb246ICJEb2Vzbid0IHNob3cgdGhlIHN1Z2dlc3Rpb25zIGxpc3QvZHJvcGRvd24iLAogICAgICAgIG5hbWU6ICdub1N1Z2dlc3Rpb25zJywKICAgICAgICBwYXJlbnQ6IHsKICAgICAgICAgIGZpbGVOYW1lOiAnZXVpL3NyYy9jb21wb25lbnRzL2NvbWJvX2JveC9jb21ib19ib3gudHN4JywKICAgICAgICAgIG5hbWU6ICdfRXVpQ29tYm9Cb3hQcm9wcycKICAgICAgICB9LAogICAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICBuYW1lOiAnYm9vbGVhbicKICAgICAgICB9CiAgICAgIH0sCiAgICAgIG9uQmx1cjogewogICAgICAgIGRlZmF1bHRWYWx1ZTogbnVsbCwKICAgICAgICBkZXNjcmlwdGlvbjogJycsCiAgICAgICAgbmFtZTogJ29uQmx1cicsCiAgICAgICAgcGFyZW50OiB7CiAgICAgICAgICBmaWxlTmFtZTogJ2V1aS9zcmMvY29tcG9uZW50cy9jb21ib19ib3gvY29tYm9fYm94LnRzeCcsCiAgICAgICAgICBuYW1lOiAnX0V1aUNvbWJvQm94UHJvcHMnCiAgICAgICAgfSwKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgdHlwZTogewogICAgICAgICAgbmFtZTogJyhldmVudDogRm9jdXNFdmVudDxIVE1MRGl2RWxlbWVudD4pID0+IHZvaWQnCiAgICAgICAgfQogICAgICB9LAogICAgICBvbkNoYW5nZTogewogICAgICAgIGRlZmF1bHRWYWx1ZTogbnVsbCwKICAgICAgICBkZXNjcmlwdGlvbjogJ0NhbGxlZCBldmVyeSB0aW1lIHRoZSBxdWVyeSBpbiB0aGUgY29tYm8gYm94IGlzIHBhcnNlZCcsCiAgICAgICAgbmFtZTogJ29uQ2hhbmdlJywKICAgICAgICBwYXJlbnQ6IHsKICAgICAgICAgIGZpbGVOYW1lOiAnZXVpL3NyYy9jb21wb25lbnRzL2NvbWJvX2JveC9jb21ib19ib3gudHN4JywKICAgICAgICAgIG5hbWU6ICdfRXVpQ29tYm9Cb3hQcm9wcycKICAgICAgICB9LAogICAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICBuYW1lOiAnKG9wdGlvbnM6IEV1aUNvbWJvQm94T3B0aW9uT3B0aW9uPFQ+W10pID0+IHZvaWQnCiAgICAgICAgfQogICAgICB9LAogICAgICBvbkZvY3VzOiB7CiAgICAgICAgZGVmYXVsdFZhbHVlOiBudWxsLAogICAgICAgIGRlc2NyaXB0aW9uOiAnJywKICAgICAgICBuYW1lOiAnb25Gb2N1cycsCiAgICAgICAgcGFyZW50OiB7CiAgICAgICAgICBmaWxlTmFtZTogJ2V1aS9zcmMvY29tcG9uZW50cy9jb21ib19ib3gvY29tYm9fYm94LnRzeCcsCiAgICAgICAgICBuYW1lOiAnX0V1aUNvbWJvQm94UHJvcHMnCiAgICAgICAgfSwKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgdHlwZTogewogICAgICAgICAgbmFtZTogJyhldmVudDogRm9jdXNFdmVudDxIVE1MRGl2RWxlbWVudD4pID0+IHZvaWQnCiAgICAgICAgfQogICAgICB9LAogICAgICBvbktleURvd246IHsKICAgICAgICBkZWZhdWx0VmFsdWU6IG51bGwsCiAgICAgICAgZGVzY3JpcHRpb246ICcnLAogICAgICAgIG5hbWU6ICdvbktleURvd24nLAogICAgICAgIHBhcmVudDogewogICAgICAgICAgZmlsZU5hbWU6ICdldWkvc3JjL2NvbXBvbmVudHMvY29tYm9fYm94L2NvbWJvX2JveC50c3gnLAogICAgICAgICAgbmFtZTogJ19FdWlDb21ib0JveFByb3BzJwogICAgICAgIH0sCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgIG5hbWU6ICcoZXZlbnQ6IEtleWJvYXJkRXZlbnQ8SFRNTERpdkVsZW1lbnQ+KSA9PiB2b2lkJwogICAgICAgIH0KICAgICAgfSwKICAgICAgb25TZWFyY2hDaGFuZ2U6IHsKICAgICAgICBkZWZhdWx0VmFsdWU6IG51bGwsCiAgICAgICAgZGVzY3JpcHRpb246ICdDYWxsZWQgZXZlcnkgdGltZSB0aGUgdGV4dCBxdWVyeSBpbiB0aGUgc2VhcmNoIGJveCBpcyBwYXJzZWQnLAogICAgICAgIG5hbWU6ICdvblNlYXJjaENoYW5nZScsCiAgICAgICAgcGFyZW50OiB7CiAgICAgICAgICBmaWxlTmFtZTogJ2V1aS9zcmMvY29tcG9uZW50cy9jb21ib19ib3gvY29tYm9fYm94LnRzeCcsCiAgICAgICAgICBuYW1lOiAnX0V1aUNvbWJvQm94UHJvcHMnCiAgICAgICAgfSwKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgdHlwZTogewogICAgICAgICAgbmFtZTogJyhzZWFyY2hWYWx1ZTogc3RyaW5nLCBoYXNNYXRjaGluZ09wdGlvbnM/OiBib29sZWFuKSA9PiB2b2lkJwogICAgICAgIH0KICAgICAgfSwKICAgICAgcGxhY2Vob2xkZXI6IHsKICAgICAgICBkZWZhdWx0VmFsdWU6IG51bGwsCiAgICAgICAgZGVzY3JpcHRpb246ICdTZXRzIHRoZSBwbGFjZWhvbGRlciBvZiB0aGUgaW5wdXQnLAogICAgICAgIG5hbWU6ICdwbGFjZWhvbGRlcicsCiAgICAgICAgcGFyZW50OiB7CiAgICAgICAgICBmaWxlTmFtZTogJ2V1aS9zcmMvY29tcG9uZW50cy9jb21ib19ib3gvY29tYm9fYm94LnRzeCcsCiAgICAgICAgICBuYW1lOiAnX0V1aUNvbWJvQm94UHJvcHMnCiAgICAgICAgfSwKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgdHlwZTogewogICAgICAgICAgbmFtZTogJ3N0cmluZycKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHJvd0hlaWdodDogewogICAgICAgIGRlZmF1bHRWYWx1ZTogbnVsbCwKICAgICAgICBkZXNjcmlwdGlvbjogJ0V2ZXJ5IG9wdGlvbiBtdXN0IGJlIHRoZSBzYW1lIGhlaWdodCBhbmQgbXVzdCBiZSBleHBsaWNpdGx5IHNldCBpZiB1c2luZyBhIGN1c3RvbSByZW5kZXInLAogICAgICAgIG5hbWU6ICdyb3dIZWlnaHQnLAogICAgICAgIHBhcmVudDogewogICAgICAgICAgZmlsZU5hbWU6ICdldWkvc3JjL2NvbXBvbmVudHMvY29tYm9fYm94L2NvbWJvX2JveC50c3gnLAogICAgICAgICAgbmFtZTogJ19FdWlDb21ib0JveFByb3BzJwogICAgICAgIH0sCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgIG5hbWU6ICdudW1iZXInCiAgICAgICAgfQogICAgICB9LAogICAgICBzaW5nbGVTZWxlY3Rpb246IHsKICAgICAgICBkZWZhdWx0VmFsdWU6IHsKICAgICAgICAgIHZhbHVlOiAnZmFsc2UnCiAgICAgICAgfSwKICAgICAgICBkZXNjcmlwdGlvbjogJ1doZW4gYHRydWVgIG9ubHkgYWxsb3dzIHRoZSB1c2VyIHRvIHNlbGVjdCBhIHNpbmdsZSBvcHRpb24uIFNldCB0byBgeyBhc1BsYWluVGV4dDogdHJ1ZSB9YCB0byBub3QgcmVuZGVyIGlucHV0IHNlbGVjdGlvbiBhcyBwaWxscycsCiAgICAgICAgbmFtZTogJ3NpbmdsZVNlbGVjdGlvbicsCiAgICAgICAgcGFyZW50OiB7CiAgICAgICAgICBmaWxlTmFtZTogJ2V1aS9zcmMvY29tcG9uZW50cy9jb21ib19ib3gvY29tYm9fYm94LnRzeCcsCiAgICAgICAgICBuYW1lOiAnX0V1aUNvbWJvQm94UHJvcHMnCiAgICAgICAgfSwKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgdHlwZTogewogICAgICAgICAgbmFtZTogJ2Jvb2xlYW4gfCBFdWlDb21ib0JveFNpbmdsZVNlbGVjdGlvblNoYXBlJwogICAgICAgIH0KICAgICAgfSwKICAgICAgc29ydE1hdGNoZXNCeTogewogICAgICAgIGRlZmF1bHRWYWx1ZTogewogICAgICAgICAgdmFsdWU6ICInbm9uZScgYXMgY29uc3QiCiAgICAgICAgfSwKICAgICAgICBkZXNjcmlwdGlvbjogJ0Rpc3BsYXkgbWF0Y2hpbmcgb3B0aW9ucyBieTpcbicgKyAnYHN0YXJ0c1dpdGhgOiBtb3ZlcyBpdGVtcyB0aGF0IHN0YXJ0IHdpdGggc2VhcmNoIHZhbHVlIHRvIHRvcCBvZiB0aGUgbGlzdDtcbicgKyAiYG5vbmVgOiBkb24ndCBjaGFuZ2UgdGhlIHNvcnQgb3JkZXIgb2YgaW5pdGlhbCBvYmplY3QiLAogICAgICAgIG5hbWU6ICdzb3J0TWF0Y2hlc0J5JywKICAgICAgICBwYXJlbnQ6IHsKICAgICAgICAgIGZpbGVOYW1lOiAnZXVpL3NyYy9jb21wb25lbnRzL2NvbWJvX2JveC9jb21ib19ib3gudHN4JywKICAgICAgICAgIG5hbWU6ICdfRXVpQ29tYm9Cb3hQcm9wcycKICAgICAgICB9LAogICAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICBuYW1lOiAnZW51bScsCiAgICAgICAgICByYXc6ICcibm9uZSIgfCAic3RhcnRzV2l0aCInLAogICAgICAgICAgdmFsdWU6IFt7CiAgICAgICAgICAgIHZhbHVlOiAnIm5vbmUiJwogICAgICAgICAgfSwgewogICAgICAgICAgICB2YWx1ZTogJyJzdGFydHNXaXRoIicKICAgICAgICAgIH1dCiAgICAgICAgfQogICAgICB9LAogICAgICBwcmVwZW5kOiB7CiAgICAgICAgZGVmYXVsdFZhbHVlOiB7CiAgICAgICAgICB2YWx1ZTogJ3VuZGVmaW5lZCcKICAgICAgICB9LAogICAgICAgIGRlc2NyaXB0aW9uOiAiQ3JlYXRlcyBhbiBpbnB1dCBncm91cCB3aXRoIGVsZW1lbnQocykgY29taW5nIGJlZm9yZSBpbnB1dC4gSXQgd29uJ3Qgc2hvdyBpZiBgc2luZ2xlU2VsZWN0aW9uYCBpcyBzZXQgdG8gYGZhbHNlYC5cbiIgKyAnYHN0cmluZ2AgfCBgUmVhY3RFbGVtZW50YCBvciBhbiBhcnJheSBvZiB0aGVzZScsCiAgICAgICAgbmFtZTogJ3ByZXBlbmQnLAogICAgICAgIHBhcmVudDogewogICAgICAgICAgZmlsZU5hbWU6ICdldWkvc3JjL2NvbXBvbmVudHMvY29tYm9fYm94L2NvbWJvX2JveC50c3gnLAogICAgICAgICAgbmFtZTogJ19FdWlDb21ib0JveFByb3BzJwogICAgICAgIH0sCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgIG5hbWU6ICdQcmVwZW5kQXBwZW5kVHlwZScKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGFwcGVuZDogewogICAgICAgIGRlZmF1bHRWYWx1ZTogewogICAgICAgICAgdmFsdWU6ICd1bmRlZmluZWQnCiAgICAgICAgfSwKICAgICAgICBkZXNjcmlwdGlvbjogIkNyZWF0ZXMgYW4gaW5wdXQgZ3JvdXAgd2l0aCBlbGVtZW50KHMpIGNvbWluZyBhZnRlciBpbnB1dC4gSXQgd29uJ3Qgc2hvdyBpZiBgc2luZ2xlU2VsZWN0aW9uYCBpcyBzZXQgdG8gYGZhbHNlYC5cbiIgKyAnYHN0cmluZ2AgfCBgUmVhY3RFbGVtZW50YCBvciBhbiBhcnJheSBvZiB0aGVzZScsCiAgICAgICAgbmFtZTogJ2FwcGVuZCcsCiAgICAgICAgcGFyZW50OiB7CiAgICAgICAgICBmaWxlTmFtZTogJ2V1aS9zcmMvY29tcG9uZW50cy9jb21ib19ib3gvY29tYm9fYm94LnRzeCcsCiAgICAgICAgICBuYW1lOiAnX0V1aUNvbWJvQm94UHJvcHMnCiAgICAgICAgfSwKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgdHlwZTogewogICAgICAgICAgbmFtZTogJ1ByZXBlbmRBcHBlbmRUeXBlJwogICAgICAgIH0KICAgICAgfSwKICAgICAgZGVsaW1pdGVyOiB7CiAgICAgICAgZGVmYXVsdFZhbHVlOiBudWxsLAogICAgICAgIGRlc2NyaXB0aW9uOiAnQSBzcGVjaWFsIGNoYXJhY3RlciB0byB1c2UgYXMgYSB2YWx1ZSBzZXBhcmF0b3IuIFR5cGljYWxseSBhIGNvbW1hIGAsYCcsCiAgICAgICAgbmFtZTogJ2RlbGltaXRlcicsCiAgICAgICAgcGFyZW50OiB7CiAgICAgICAgICBmaWxlTmFtZTogJ2V1aS9zcmMvY29tcG9uZW50cy9jb21ib19ib3gvY29tYm9fYm94LnRzeCcsCiAgICAgICAgICBuYW1lOiAnX0V1aUNvbWJvQm94UHJvcHMnCiAgICAgICAgfSwKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgdHlwZTogewogICAgICAgICAgbmFtZTogJ3N0cmluZycKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGF1dG9Gb2N1czogewogICAgICAgIGRlZmF1bHRWYWx1ZTogbnVsbCwKICAgICAgICBkZXNjcmlwdGlvbjogJ1NwZWNpZmllcyB0aGF0IHRoZSBpbnB1dCBzaG91bGQgaGF2ZSBmb2N1cyB3aGVuIHRoZSBjb21wb25lbnQgbG9hZHMnLAogICAgICAgIG5hbWU6ICdhdXRvRm9jdXMnLAogICAgICAgIHBhcmVudDogewogICAgICAgICAgZmlsZU5hbWU6ICdldWkvc3JjL2NvbXBvbmVudHMvY29tYm9fYm94L2NvbWJvX2JveC50c3gnLAogICAgICAgICAgbmFtZTogJ19FdWlDb21ib0JveFByb3BzJwogICAgICAgIH0sCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgIG5hbWU6ICdib29sZWFuJwogICAgICAgIH0KICAgICAgfSwKICAgICAgJ2FyaWEtbGFiZWwnOiB7CiAgICAgICAgZGVmYXVsdFZhbHVlOiBudWxsLAogICAgICAgIGRlc2NyaXB0aW9uOiAnJywKICAgICAgICBuYW1lOiAnYXJpYS1sYWJlbCcsCiAgICAgICAgcGFyZW50OiB7CiAgICAgICAgICBmaWxlTmFtZTogJ2V1aS9zcmMvY29tcG9uZW50cy9jb21tb24udHMnLAogICAgICAgICAgbmFtZTogJ0NvbW1vblByb3BzJwogICAgICAgIH0sCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgIG5hbWU6ICdzdHJpbmcnCiAgICAgICAgfQogICAgICB9LAogICAgICBvcHRpb25zOiB7CiAgICAgICAgZGVmYXVsdFZhbHVlOiB7CiAgICAgICAgICB2YWx1ZTogJ1tdJwogICAgICAgIH0sCiAgICAgICAgZGVzY3JpcHRpb246ICdBcnJheSBvZiBFdWlDb21ib0JveE9wdGlvbk9wdGlvbiBvYmplY3RzLiBTZWUgI0V1aUNvbWJvQm94T3B0aW9uT3B0aW9uJywKICAgICAgICBuYW1lOiAnb3B0aW9ucycsCiAgICAgICAgcGFyZW50OiB1bmRlZmluZWQsCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlLAogICAgICAgIHR5cGU6IHsKICAgICAgICAgIG5hbWU6ICdFdWlDb21ib0JveE9wdGlvbk9wdGlvbjxUPltdJwogICAgICAgIH0KICAgICAgfSwKICAgICAgcmVuZGVyT3B0aW9uOiB7CiAgICAgICAgZGVmYXVsdFZhbHVlOiBudWxsLAogICAgICAgIGRlc2NyaXB0aW9uOiAnJywKICAgICAgICBuYW1lOiAncmVuZGVyT3B0aW9uJywKICAgICAgICBwYXJlbnQ6IHVuZGVmaW5lZCwKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgdHlwZTogewogICAgICAgICAgbmFtZTogJyhvcHRpb246IEV1aUNvbWJvQm94T3B0aW9uT3B0aW9uPFQ+LCBzZWFyY2hWYWx1ZTogc3RyaW5nLCBPUFRJT05fQ09OVEVOVF9DTEFTU05BTUU6IHN0cmluZykgPT4gUmVhY3ROb2RlJwogICAgICAgIH0KICAgICAgfSwKICAgICAgY3VzdG9tT3B0aW9uVGV4dDogewogICAgICAgIGRlZmF1bHRWYWx1ZTogbnVsbCwKICAgICAgICBkZXNjcmlwdGlvbjogJ0NyZWF0ZXMgYSBjdXN0b20gdGV4dCBvcHRpb24uIFlvdSBjYW4gdXNlIGB7c2VhcmNoVmFsdWV9YCBpbnNpZGUgeW91ciBzdHJpbmcgdG8gYmV0dGVyIGN1c3RvbWl6ZSB5b3VyIHRleHQuXG4nICsgIkl0IHdvbid0IHNob3cgaWYgdGhlcmUncyBubyBvbkNyZWF0ZU9wdGlvbi4iLAogICAgICAgIG5hbWU6ICdjdXN0b21PcHRpb25UZXh0JywKICAgICAgICBwYXJlbnQ6IHVuZGVmaW5lZCwKICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgdHlwZTogewogICAgICAgICAgbmFtZTogJ3N0cmluZycKICAgICAgICB9CiAgICAgIH0sCiAgICAgIG9uQ3JlYXRlT3B0aW9uOiB7CiAgICAgICAgZGVmYXVsdFZhbHVlOiBudWxsLAogICAgICAgIGRlc2NyaXB0aW9uOiAnJywKICAgICAgICBuYW1lOiAnb25DcmVhdGVPcHRpb24nLAogICAgICAgIHBhcmVudDogdW5kZWZpbmVkLAogICAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICBuYW1lOiAnKHNlYXJjaFZhbHVlOiBzdHJpbmcsIG9wdGlvbnM6IEV1aUNvbWJvQm94T3B0aW9uT3B0aW9uPFQ+W10pID0+IGJvb2xlYW4gfCB2b2lkJwogICAgICAgIH0KICAgICAgfSwKICAgICAgc2VsZWN0ZWRPcHRpb25zOiB7CiAgICAgICAgZGVmYXVsdFZhbHVlOiB7CiAgICAgICAgICB2YWx1ZTogJ1tdJwogICAgICAgIH0sCiAgICAgICAgZGVzY3JpcHRpb246ICcnLAogICAgICAgIG5hbWU6ICdzZWxlY3RlZE9wdGlvbnMnLAogICAgICAgIHBhcmVudDogdW5kZWZpbmVkLAogICAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgICB0eXBlOiB7CiAgICAgICAgICBuYW1lOiAnRXVpQ29tYm9Cb3hPcHRpb25PcHRpb248VD5bXScKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBleHRlbmRlZEludGVyZmFjZXM6IFsnX0V1aUNvbWJvQm94UHJvcHMnLCAnSFRNTEF0dHJpYnV0ZXMnLCAnQXJpYUF0dHJpYnV0ZXMnLCAnRE9NQXR0cmlidXRlcyddCiAgfTsKfSBjYXRjaCAoZSkge30="},{"version":3,"sources":["D:/work/eui/src/components/combo_box/combo_box.tsx"],"names":["React","Component","classNames","findPopoverPosition","htmlIdGenerator","keys","EuiPortal","EuiComboBoxOptionsList","getMatchingOptions","flattenOptionGroups","getSelectedOptionForSearchValue","EuiComboBoxInput","getElementZIndex","initialSearchValue","EuiComboBox","activeOptionIndex","hasFocus","isListOpen","listElement","listPosition","listZIndex","undefined","matchingOptions","props","options","selectedOptions","async","Boolean","singleSelection","sortMatchesBy","searchValue","width","ref","comboBoxRefInstance","removeEventListener","onContainerBlur","addEventListener","comboBoxBounds","getBoundingClientRect","setState","autoSizeInputRefInstance","searchInputRefInstance","inputRef","document","body","listRefInstance","toggleButtonRefInstance","index","optionsRefInstances","event","target","clearActiveOption","state","_isMounted","listElementBounds","height","allowCrossAxis","anchor","popover","position","top","style","left","window","pageXOffset","amount","length","nextActiveOptionIndex","direction","isGroupLabelOption","onSearchChange","onRemoveOption","openList","isContainerBlur","onCreateOption","doesSearchMatchOnlyOption","onAddOption","isOptionCreated","clearSearchValue","closeList","label","toLowerCase","flattenOptions","map","option","trim","numberOfSelectedOptions","forEach","trimmedLabel","findIndex","onFocus","delimiter","split","addCustomOption","focusEvent","relatedTarget","explicitOriginalTarget","focusedInOptionsList","contains","focusedInInput","onBlur","hasActiveOption","setCustomOptions","key","ARROW_UP","preventDefault","stopPropagation","incrementActiveOptionIndex","ARROW_DOWN","BACKSPACE","removeLastOption","ESCAPE","ENTER","TAB","onKeyDown","addedOption","disabled","onChange","singleSelectionProp","changeOptions","concat","focus","requestAnimationFrame","indexOf","removedOption","filter","selectedOptionIndex","hasMatchingOptions","endsWith","newMatchingOptions","areOptionsDifferent","i","includes","setTimeout","copyInputStyles","updateMatchingOptionsIfDifferent","dataTestSubj","className","compressed","customOptionText","fullWidth","id","isClearable","isDisabled","isInvalid","isLoading","noSuggestions","placeholder","renderOption","rowHeight","prepend","append","autoFocus","rest","markAsInvalid","classes","value","selectedOption","join","optionsList","optionsListDataTestSubj","areAllOptionsSelected","listRefCallback","onOptionClick","onOptionEnterKey","onOptionListScroll","optionRefCallback","rootId","updatePosition","comboBoxRefCallback","autoSizeInputRefCallback","searchInputRefCallback","clearSelectedOptions","onComboBoxClick","onCloseListClick","onComboBoxFocus","onOpenListClick","toggleButtonRefCallback","nextProps","prevState","stateUpdate"],"mappings":"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","sourcesContent":["/*\n * Licensed to Elasticsearch B.V. under one or more contributor\n * license agreements. See the NOTICE file distributed with\n * this work for additional information regarding copyright\n * ownership. Elasticsearch B.V. licenses this file to you under\n * the Apache License, Version 2.0 (the \"License\"); you may\n * not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * Elements within EuiComboBox which would normally be tabbable (inputs, buttons) have been removed\n * from the tab order with tabindex={-1} so that we can control the keyboard navigation interface.\n */\n\n/* eslint-disable jsx-a11y/role-has-required-aria-props */\nimport React, { Component } from 'react';\nimport PropTypes from \"prop-types\";\nimport classNames from 'classnames';\nimport { findPopoverPosition, htmlIdGenerator, keys } from '../../services';\nimport { EuiPortal } from '../portal';\nimport { EuiComboBoxOptionsList } from './combo_box_options_list';\nimport { getMatchingOptions, flattenOptionGroups, getSelectedOptionForSearchValue } from './matching_options';\nimport { EuiComboBoxInput } from './combo_box_input/combo_box_input';\nimport { getElementZIndex } from '../../services/popover';\nvar initialSearchValue = '';\nexport class EuiComboBox extends Component {\n  static defaultProps = {\n    async: false,\n    compressed: false,\n    fullWidth: false,\n    isClearable: true,\n    options: [],\n    selectedOptions: [],\n    singleSelection: false,\n    prepend: undefined,\n    append: undefined,\n    sortMatchesBy: 'none'\n  };\n  state = {\n    activeOptionIndex: -1,\n    hasFocus: false,\n    isListOpen: false,\n    listElement: null,\n    listPosition: 'bottom',\n    listZIndex: undefined,\n    matchingOptions: getMatchingOptions(this.props.options, this.props.selectedOptions, initialSearchValue, this.props.async, Boolean(this.props.singleSelection), this.props.sortMatchesBy),\n    searchValue: initialSearchValue,\n    width: 0\n  };\n  _isMounted = false;\n  rootId = htmlIdGenerator(); // Refs\n\n  comboBoxRefInstance = null;\n  comboBoxRefCallback = ref => {\n    // IE11 doesn't support the `relatedTarget` event property for blur events\n    // but does add it for focusout. React doesn't support `onFocusOut` so here we are.\n    if (this.comboBoxRefInstance) {\n      this.comboBoxRefInstance.removeEventListener('focusout', this.onContainerBlur);\n    }\n\n    this.comboBoxRefInstance = ref;\n\n    if (this.comboBoxRefInstance) {\n      this.comboBoxRefInstance.addEventListener('focusout', this.onContainerBlur);\n      const comboBoxBounds = this.comboBoxRefInstance.getBoundingClientRect();\n      this.setState({\n        width: comboBoxBounds.width\n      });\n    }\n  };\n  autoSizeInputRefInstance = null;\n  autoSizeInputRefCallback = ref => {\n    this.autoSizeInputRefInstance = ref;\n  };\n  searchInputRefInstance = null;\n  searchInputRefCallback = ref => {\n    this.searchInputRefInstance = ref;\n    if (this.props.inputRef) this.props.inputRef(ref);\n  };\n  listRefInstance = null;\n  listRefCallback = ref => {\n    if (this.comboBoxRefInstance) {\n      // find the zIndex of the combobox relative to the page body\n      // and use that to depth-position the list box\n      // adds an extra `100` to provide some defense around neighboring elements' positioning\n      const listZIndex = getElementZIndex(this.comboBoxRefInstance, document.body) + 100;\n      this.setState({\n        listZIndex\n      });\n    }\n\n    this.listRefInstance = ref;\n  };\n  toggleButtonRefInstance = null;\n  toggleButtonRefCallback = ref => {\n    this.toggleButtonRefInstance = ref;\n  };\n  optionsRefInstances = [];\n  optionRefCallback = (index, ref) => {\n    this.optionsRefInstances[index] = ref;\n  };\n  openList = () => {\n    this.setState({\n      isListOpen: true\n    });\n  };\n  closeList = event => {\n    if (event && event.target === this.searchInputRefInstance) {\n      // really long search values / custom entries triggers a scroll event on the input\n      // which the EuiComboBoxOptionsList passes through here\n      return;\n    }\n\n    this.clearActiveOption();\n    this.setState({\n      listZIndex: undefined,\n      isListOpen: false\n    });\n  };\n  updatePosition = (listElement = this.state.listElement) => {\n    if (!this._isMounted) {\n      return;\n    }\n\n    if (!this.state.isListOpen) {\n      return;\n    }\n\n    if (!listElement) {\n      return;\n    } // it's possible that updateListPosition is called when listElement is becoming visible, but isn't yet\n\n\n    const listElementBounds = listElement.getBoundingClientRect();\n\n    if (listElementBounds.width === 0 || listElementBounds.height === 0) {\n      return;\n    }\n\n    if (!this.comboBoxRefInstance) {\n      return;\n    }\n\n    const comboBoxBounds = this.comboBoxRefInstance.getBoundingClientRect();\n    const {\n      position,\n      top\n    } = findPopoverPosition({\n      allowCrossAxis: false,\n      anchor: this.comboBoxRefInstance,\n      popover: listElement,\n      position: 'bottom'\n    });\n\n    if (this.listRefInstance) {\n      this.listRefInstance.style.top = `${top}px`; // listElement doesn't have its width set until after updating the position\n      // which means the popover service won't know about the correct width\n      // however, we already know where to position the element\n\n      this.listRefInstance.style.left = `${comboBoxBounds.left + window.pageXOffset}px`;\n      this.listRefInstance.style.width = `${comboBoxBounds.width}px`;\n    } // Cache for future calls.\n\n\n    this.setState({\n      listElement,\n      listPosition: position,\n      width: comboBoxBounds.width\n    });\n  };\n  incrementActiveOptionIndex = amount => {\n    // If there are no options available, do nothing.\n    if (!this.state.matchingOptions.length) {\n      return;\n    }\n\n    this.setState(({\n      activeOptionIndex,\n      matchingOptions\n    }) => {\n      let nextActiveOptionIndex;\n\n      if (activeOptionIndex < 0) {\n        // If this is the beginning of the user's keyboard navigation of the menu, then we'll focus\n        // either the first or last item.\n        nextActiveOptionIndex = amount < 0 ? matchingOptions.length - 1 : 0;\n      } else {\n        nextActiveOptionIndex = activeOptionIndex + amount;\n\n        if (nextActiveOptionIndex < 0) {\n          nextActiveOptionIndex = matchingOptions.length - 1;\n        } else if (nextActiveOptionIndex === matchingOptions.length) {\n          nextActiveOptionIndex = 0;\n        }\n      } // Group titles are included in option list but are not selectable\n      // Skip group title options\n\n\n      const direction = amount > 0 ? 1 : -1;\n\n      while (matchingOptions[nextActiveOptionIndex].isGroupLabelOption) {\n        nextActiveOptionIndex = nextActiveOptionIndex + direction;\n\n        if (nextActiveOptionIndex < 0) {\n          nextActiveOptionIndex = matchingOptions.length - 1;\n        } else if (nextActiveOptionIndex === matchingOptions.length) {\n          nextActiveOptionIndex = 0;\n        }\n      }\n\n      return {\n        activeOptionIndex: nextActiveOptionIndex\n      };\n    });\n  };\n  hasActiveOption = () => {\n    return this.state.activeOptionIndex > -1 && this.state.activeOptionIndex < this.state.matchingOptions.length;\n  };\n  clearActiveOption = () => {\n    this.setState({\n      activeOptionIndex: -1\n    });\n  };\n  clearSearchValue = () => {\n    this.onSearchChange('');\n  };\n  removeLastOption = () => {\n    if (!this.props.selectedOptions.length) {\n      return;\n    } // Backspace will be used to delete the input, not a pill.\n\n\n    if (this.state.searchValue.length) {\n      return;\n    } // Delete last pill.\n\n\n    this.onRemoveOption(this.props.selectedOptions[this.props.selectedOptions.length - 1]);\n\n    if (Boolean(this.props.singleSelection) && !this.state.isListOpen) {\n      this.openList();\n    }\n  };\n  addCustomOption = (isContainerBlur, searchValue) => {\n    const {\n      onCreateOption,\n      options,\n      selectedOptions,\n      singleSelection\n    } = this.props;\n    const {\n      matchingOptions\n    } = this.state;\n\n    if (this.doesSearchMatchOnlyOption()) {\n      this.onAddOption(matchingOptions[0], isContainerBlur);\n      return;\n    }\n\n    if (!onCreateOption) {\n      return;\n    } // Don't bother trying to create an option if the user hasn't typed anything.\n\n\n    if (!searchValue) {\n      return;\n    } // Don't create the value if it's already been selected.\n\n\n    if (getSelectedOptionForSearchValue(searchValue, selectedOptions)) {\n      return;\n    } // Add new custom pill if this is custom input, even if it partially matches an option.\n\n\n    const isOptionCreated = onCreateOption(searchValue, flattenOptionGroups(options)); // Expect the consumer to be explicit in rejecting a custom option.\n\n    if (isOptionCreated === false) {\n      return;\n    }\n\n    this.clearSearchValue();\n\n    if (Boolean(singleSelection)) {\n      // Adding a custom option to a single select that does not appear in the list of options\n      this.closeList();\n    }\n  };\n  doesSearchMatchOnlyOption = () => {\n    const {\n      searchValue\n    } = this.state;\n\n    if (this.state.matchingOptions.length !== 1) {\n      return false;\n    }\n\n    return this.state.matchingOptions[0].label.toLowerCase() === searchValue.toLowerCase();\n  };\n  areAllOptionsSelected = () => {\n    const {\n      options,\n      selectedOptions,\n      async\n    } = this.props; // Assume if this is async then there could be infinite options.\n\n    if (async) {\n      return false;\n    }\n\n    const flattenOptions = flattenOptionGroups(options).map(option => {\n      return { ...option,\n        label: option.label.trim().toLowerCase()\n      };\n    });\n    let numberOfSelectedOptions = 0;\n    selectedOptions.forEach(({\n      label\n    }) => {\n      const trimmedLabel = label.trim().toLowerCase();\n      if (flattenOptions.findIndex(option => option.label === trimmedLabel) !== -1) numberOfSelectedOptions += 1;\n    });\n    return flattenOptions.length === numberOfSelectedOptions;\n  };\n  onComboBoxFocus = event => {\n    if (this.props.onFocus) {\n      this.props.onFocus(event);\n    }\n\n    this.openList();\n    this.setState({\n      hasFocus: true\n    });\n  };\n  setCustomOptions = isContainerBlur => {\n    const {\n      searchValue\n    } = this.state;\n    const {\n      delimiter\n    } = this.props;\n\n    if (delimiter) {\n      searchValue.split(delimiter).forEach(option => {\n        if (option.length > 0) this.addCustomOption(isContainerBlur, option);\n      });\n    } else {\n      this.addCustomOption(isContainerBlur, searchValue);\n    }\n  };\n  onContainerBlur = event => {\n    // close the options list, unless the use clicked on an option\n\n    /**\n     * FireFox returns `relatedTarget` as `null` for security reasons, but provides a proprietary `explicitOriginalTarget`.\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Event/explicitOriginalTarget\n     */\n    const focusEvent = event;\n    const relatedTarget = focusEvent.relatedTarget || focusEvent.explicitOriginalTarget;\n    const focusedInOptionsList = relatedTarget && this.listRefInstance && this.listRefInstance.contains(relatedTarget);\n    const focusedInInput = relatedTarget && this.comboBoxRefInstance && this.comboBoxRefInstance.contains(relatedTarget);\n\n    if (!focusedInOptionsList && !focusedInInput) {\n      this.closeList();\n\n      if (this.props.onBlur) {\n        this.props.onBlur(event);\n      }\n\n      this.setState({\n        hasFocus: false\n      }); // If the user tabs away or changes focus to another element, take whatever input they've\n      // typed and convert it into a pill, to prevent the combo box from looking like a text input.\n\n      if (!this.hasActiveOption()) {\n        this.setCustomOptions(true);\n      }\n    }\n  };\n  onKeyDown = event => {\n    switch (event.key) {\n      case keys.ARROW_UP:\n        event.preventDefault();\n        event.stopPropagation();\n\n        if (this.state.isListOpen) {\n          this.incrementActiveOptionIndex(-1);\n        } else {\n          this.openList();\n        }\n\n        break;\n\n      case keys.ARROW_DOWN:\n        event.preventDefault();\n        event.stopPropagation();\n\n        if (this.state.isListOpen) {\n          this.incrementActiveOptionIndex(1);\n        } else {\n          this.openList();\n        }\n\n        break;\n\n      case keys.BACKSPACE:\n        event.stopPropagation();\n        this.removeLastOption();\n        break;\n\n      case keys.ESCAPE:\n        if (this.state.isListOpen) {\n          event.preventDefault();\n          event.stopPropagation();\n          this.closeList();\n        }\n\n        break;\n\n      case keys.ENTER:\n        event.preventDefault();\n        event.stopPropagation();\n\n        if (this.hasActiveOption()) {\n          this.onAddOption(this.state.matchingOptions[this.state.activeOptionIndex]);\n        } else {\n          this.setCustomOptions(false);\n        }\n\n        break;\n\n      case keys.TAB:\n        // Disallow tabbing when the user is navigating the options.\n        if (this.hasActiveOption() && this.state.isListOpen) {\n          event.preventDefault();\n          event.stopPropagation();\n        }\n\n        break;\n\n      default:\n        if (this.props.onKeyDown) {\n          this.props.onKeyDown(event);\n        }\n\n    }\n  };\n  onOptionEnterKey = option => {\n    this.onAddOption(option);\n  };\n  onOptionClick = option => {\n    this.onAddOption(option);\n  };\n  onAddOption = (addedOption, isContainerBlur) => {\n    if (addedOption.disabled) {\n      return;\n    }\n\n    const {\n      onChange,\n      selectedOptions,\n      singleSelection: singleSelectionProp\n    } = this.props;\n    const singleSelection = Boolean(singleSelectionProp);\n    const changeOptions = singleSelection ? [addedOption] : selectedOptions.concat(addedOption);\n\n    if (onChange) {\n      onChange(changeOptions);\n    }\n\n    this.clearSearchValue();\n    this.clearActiveOption();\n\n    if (!isContainerBlur) {\n      if (this.searchInputRefInstance) {\n        this.searchInputRefInstance.focus();\n      }\n    }\n\n    if (singleSelection) {\n      requestAnimationFrame(() => this.closeList());\n    } else {\n      this.setState({\n        activeOptionIndex: this.state.matchingOptions.indexOf(addedOption)\n      });\n    }\n  };\n  onRemoveOption = removedOption => {\n    const {\n      onChange,\n      selectedOptions\n    } = this.props;\n\n    if (onChange) {\n      onChange(selectedOptions.filter(option => option !== removedOption));\n    }\n\n    this.clearActiveOption();\n  };\n  clearSelectedOptions = () => {\n    const {\n      onChange\n    } = this.props;\n\n    if (onChange) {\n      onChange([]);\n    } // Clicking the clear button will also cause it to disappear. This would result in focus\n    // shifting unexpectedly to the body element so we set it to the input which is more reasonable,\n\n\n    if (this.searchInputRefInstance) {\n      this.searchInputRefInstance.focus();\n    }\n\n    if (!this.state.isListOpen) {\n      this.openList();\n    }\n  };\n  onComboBoxClick = () => {\n    // When the user clicks anywhere on the box, enter the interaction state.\n    if (this.searchInputRefInstance) {\n      this.searchInputRefInstance.focus();\n    } // If the user does this from a state in which an option has focus, then we need to reset it or clear it.\n\n\n    if (Boolean(this.props.singleSelection) && this.props.selectedOptions.length === 1) {\n      const selectedOptionIndex = this.state.matchingOptions.findIndex(option => option.label === this.props.selectedOptions[0].label && option.key === this.props.selectedOptions[0].key);\n      this.setState({\n        activeOptionIndex: selectedOptionIndex\n      });\n    } else {\n      this.clearActiveOption();\n    }\n  };\n  onOpenListClick = () => {\n    if (this.searchInputRefInstance) {\n      this.searchInputRefInstance.focus();\n    }\n\n    if (!this.state.isListOpen) {\n      this.openList();\n    }\n  };\n  onOptionListScroll = () => {\n    if (this.searchInputRefInstance) {\n      this.searchInputRefInstance.focus();\n    }\n  };\n  onCloseListClick = () => {\n    this.closeList();\n  };\n  onSearchChange = searchValue => {\n    const {\n      onSearchChange,\n      delimiter\n    } = this.props;\n\n    if (onSearchChange) {\n      const hasMatchingOptions = this.state.matchingOptions.length > 0;\n      onSearchChange(searchValue, hasMatchingOptions);\n    }\n\n    this.setState({\n      searchValue\n    }, () => {\n      if (searchValue && this.state.isListOpen === false) this.openList();\n    });\n\n    if (delimiter && searchValue.endsWith(delimiter)) {\n      this.setCustomOptions(false);\n    }\n  };\n\n  componentDidMount() {\n    this._isMounted = true; // TODO: This will need to be called once the actual stylesheet loads.\n\n    setTimeout(() => {\n      if (this.autoSizeInputRefInstance) {\n        this.autoSizeInputRefInstance.copyInputStyles();\n      }\n    }, 100);\n  }\n\n  static getDerivedStateFromProps(nextProps, prevState) {\n    const {\n      options,\n      selectedOptions,\n      singleSelection,\n      sortMatchesBy\n    } = nextProps;\n    const {\n      activeOptionIndex,\n      searchValue\n    } = prevState; // Calculate and cache the options which match the searchValue, because we use this information\n    // in multiple places and it would be expensive to calculate repeatedly.\n\n    const matchingOptions = getMatchingOptions(options, selectedOptions, searchValue, nextProps.async, Boolean(singleSelection), sortMatchesBy);\n    const stateUpdate = {\n      matchingOptions\n    };\n\n    if (activeOptionIndex >= matchingOptions.length) {\n      stateUpdate.activeOptionIndex = -1;\n    }\n\n    return stateUpdate;\n  }\n\n  updateMatchingOptionsIfDifferent = newMatchingOptions => {\n    const {\n      matchingOptions,\n      activeOptionIndex\n    } = this.state;\n    const {\n      singleSelection,\n      selectedOptions\n    } = this.props;\n    let areOptionsDifferent = false;\n\n    if (matchingOptions.length !== newMatchingOptions.length) {\n      areOptionsDifferent = true;\n    } else {\n      for (let i = 0; i < matchingOptions.length; i++) {\n        if (matchingOptions[i].label !== newMatchingOptions[i].label) {\n          areOptionsDifferent = true;\n          break;\n        }\n      }\n    }\n\n    if (areOptionsDifferent) {\n      this.optionsRefInstances = [];\n      let nextActiveOptionIndex = activeOptionIndex; // ensure that the currently selected single option is active if it is in the matchingOptions\n\n      if (Boolean(singleSelection) && selectedOptions.length === 1) {\n        if (newMatchingOptions.includes(selectedOptions[0])) {\n          nextActiveOptionIndex = newMatchingOptions.indexOf(selectedOptions[0]);\n        }\n      }\n\n      this.setState({\n        matchingOptions: newMatchingOptions,\n        activeOptionIndex: nextActiveOptionIndex\n      });\n\n      if (!newMatchingOptions.length) {\n        // Prevent endless setState -> componentWillUpdate -> setState loop.\n        if (this.hasActiveOption()) {\n          this.clearActiveOption();\n        }\n      }\n    }\n  };\n\n  componentDidUpdate() {\n    const {\n      options,\n      selectedOptions,\n      singleSelection,\n      sortMatchesBy\n    } = this.props;\n    const {\n      searchValue\n    } = this.state; // React 16.3 has a bug (fixed in 16.4) where getDerivedStateFromProps\n    // isn't called after a state change, and we track `searchValue` in state\n    // instead we need to react to a change in searchValue here\n\n    this.updateMatchingOptionsIfDifferent(getMatchingOptions(options, selectedOptions, searchValue, this.props.async, Boolean(singleSelection), sortMatchesBy));\n  }\n\n  componentWillUnmount() {\n    this._isMounted = false;\n  }\n\n  render() {\n    const {\n      'data-test-subj': dataTestSubj,\n      async,\n      className,\n      compressed,\n      customOptionText,\n      fullWidth,\n      id,\n      inputRef,\n      isClearable,\n      isDisabled,\n      isInvalid,\n      isLoading,\n      noSuggestions,\n      onBlur,\n      onChange,\n      onCreateOption,\n      onSearchChange,\n      options,\n      placeholder,\n      renderOption,\n      rowHeight,\n      selectedOptions,\n      singleSelection,\n      prepend,\n      sortMatchesBy,\n      delimiter,\n      append,\n      autoFocus,\n      ...rest\n    } = this.props;\n    const {\n      activeOptionIndex,\n      hasFocus,\n      isListOpen,\n      listPosition,\n      searchValue,\n      width,\n      matchingOptions\n    } = this.state; // Visually indicate the combobox is in an invalid state if it has lost focus but there is text entered in the input.\n    // When custom options are disabled and the user leaves the combo box after entering text that does not match any\n    // options, this tells the user that they've entered invalid input.\n\n    const markAsInvalid = isInvalid || (hasFocus === false || isListOpen === false) && searchValue;\n    const classes = classNames('euiComboBox', className, {\n      'euiComboBox--compressed': compressed,\n      'euiComboBox--fullWidth': fullWidth,\n      'euiComboBox-isDisabled': isDisabled,\n      'euiComboBox-isInvalid': markAsInvalid,\n      'euiComboBox-isOpen': isListOpen\n    });\n    const value = selectedOptions.map(selectedOption => selectedOption.label).join(', ');\n    let optionsList;\n\n    if (!noSuggestions && isListOpen) {\n      const optionsListDataTestSubj = dataTestSubj ? `${dataTestSubj}-optionsList` : undefined;\n      optionsList = <EuiPortal>\n          <EuiComboBoxOptionsList zIndex={this.state.listZIndex} activeOptionIndex={this.state.activeOptionIndex} areAllOptionsSelected={this.areAllOptionsSelected()} customOptionText={customOptionText} data-test-subj={optionsListDataTestSubj} fullWidth={fullWidth} isLoading={isLoading} listRef={this.listRefCallback} matchingOptions={matchingOptions} onCloseList={this.closeList} onCreateOption={onCreateOption} onOptionClick={this.onOptionClick} onOptionEnterKey={this.onOptionEnterKey} onScroll={this.onOptionListScroll} optionRef={this.optionRefCallback} options={options} position={listPosition} singleSelection={singleSelection} renderOption={renderOption} rootId={this.rootId} rowHeight={rowHeight} scrollToIndex={activeOptionIndex} searchValue={searchValue} selectedOptions={selectedOptions} updatePosition={this.updatePosition} width={width} delimiter={delimiter} getSelectedOptionForSearchValue={getSelectedOptionForSearchValue} />\n        </EuiPortal>;\n    }\n\n    return (\n      /**\n       * Re: jsx-a11y/interactive-supports-focus\n       * Focus is managed and is placed on the textbox element (`EuiComboBoxInput`)\n       *\n       * Re: jsx-a11y/role-has-required-aria-props\n       * Expansion is managed and required `aria-controls` prop is placed on the textbox element (`EuiComboBoxInput`)\n       *\n       * Reference for both: https://www.w3.org/TR/2017/REC-wai-aria-1.1-20171214/#combobox,\n       * which verifies that this implementation follows the spec.\n       */\n      // eslint-disable-next-line jsx-a11y/interactive-supports-focus\n      <div {...rest} aria-expanded={isListOpen} aria-haspopup=\"listbox\" className={classes} data-test-subj={dataTestSubj} onKeyDown={this.onKeyDown} ref={this.comboBoxRefCallback} role=\"combobox\">\n        <EuiComboBoxInput autoSizeInputRef={this.autoSizeInputRefCallback} compressed={compressed} focusedOptionId={this.hasActiveOption() ? this.rootId(`_option-${this.state.activeOptionIndex}`) : undefined} fullWidth={fullWidth} hasSelectedOptions={selectedOptions.length > 0} id={id} inputRef={this.searchInputRefCallback} isDisabled={isDisabled} isListOpen={isListOpen} noIcon={!!noSuggestions} onChange={this.onSearchChange} onClear={isClearable && !isDisabled ? this.clearSelectedOptions : undefined} onClick={this.onComboBoxClick} onCloseListClick={this.onCloseListClick} onFocus={this.onComboBoxFocus} onOpenListClick={this.onOpenListClick} onRemoveOption={this.onRemoveOption} placeholder={placeholder} rootId={this.rootId} searchValue={searchValue} selectedOptions={selectedOptions} singleSelection={singleSelection} toggleButtonRef={this.toggleButtonRefCallback} updatePosition={this.updatePosition} value={value} append={singleSelection ? append : undefined} prepend={singleSelection ? prepend : undefined} isLoading={isLoading} autoFocus={autoFocus} />\n        {optionsList}\n      </div>\n    );\n  }\n\n}\nEuiComboBox.propTypes = {\n  \"data-test-subj\": PropTypes.string,\n\n  /**\n     * Updates the list of options asynchronously\n     */\n  async: PropTypes.bool.isRequired,\n  className: PropTypes.string,\n\n  /**\n     * When `true` creates a shorter height input\n     */\n  compressed: PropTypes.bool.isRequired,\n\n  /**\n     * When `true` expands to the entire width available\n     */\n  fullWidth: PropTypes.bool.isRequired,\n  id: PropTypes.string,\n  inputRef: PropTypes.any,\n\n  /**\n     * Shows a button that quickly clears any input\n     */\n  isClearable: PropTypes.bool.isRequired,\n\n  /**\n     * Disables the input\n     */\n  isDisabled: PropTypes.bool,\n  isInvalid: PropTypes.bool,\n\n  /**\n     * Swaps the dropdown options for a loading spinner\n     */\n  isLoading: PropTypes.bool,\n\n  /**\n     * Doesn't show the suggestions list/dropdown\n     */\n  noSuggestions: PropTypes.bool,\n  onBlur: PropTypes.any,\n\n  /**\n     * Called every time the query in the combo box is parsed\n     */\n  onChange: PropTypes.func,\n  onFocus: PropTypes.any,\n  onKeyDown: PropTypes.any,\n\n  /**\n     * Called every time the text query in the search box is parsed\n     */\n  onSearchChange: PropTypes.func,\n\n  /**\n     * Sets the placeholder of the input\n     */\n  placeholder: PropTypes.string,\n\n  /**\n     * Every option must be the same height and must be explicitly set if using a custom render\n     */\n  rowHeight: PropTypes.number,\n\n  /**\n     * When `true` only allows the user to select a single option. Set to `{ asPlainText: true }` to not render input selection as pills\n     */\n  singleSelection: PropTypes.oneOfType([PropTypes.bool.isRequired, PropTypes.shape({\n    asPlainText: PropTypes.bool\n  }).isRequired]).isRequired,\n\n  /**\n     * Display matching options by:\n     * `startsWith`: moves items that start with search value to top of the list;\n     * `none`: don't change the sort order of initial object\n     */\n  sortMatchesBy: PropTypes.oneOf([\"none\", \"startsWith\"]).isRequired,\n\n  /**\n     * Creates an input group with element(s) coming before input. It won't show if `singleSelection` is set to `false`.\n     * `string` | `ReactElement` or an array of these\n     */\n  prepend: PropTypes.any,\n\n  /**\n     * Creates an input group with element(s) coming after input. It won't show if `singleSelection` is set to `false`.\n     * `string` | `ReactElement` or an array of these\n     */\n  append: PropTypes.any,\n\n  /**\n     * A special character to use as a value separator. Typically a comma `,`\n     */\n  delimiter: PropTypes.string,\n\n  /**\n     * Specifies that the input should have focus when the component loads\n     */\n  autoFocus: PropTypes.bool,\n  \"aria-label\": PropTypes.string\n};\n\ntry {\n  EuiComboBox.__docgenInfo = {\n    description: '',\n    displayName: 'EuiComboBox',\n    methods: [],\n    props: {\n      'data-test-subj': {\n        defaultValue: null,\n        description: '',\n        name: 'data-test-subj',\n        parent: {\n          fileName: 'eui/src/components/combo_box/combo_box.tsx',\n          name: '_EuiComboBoxProps'\n        },\n        required: false,\n        type: {\n          name: 'string'\n        }\n      },\n      async: {\n        defaultValue: {\n          value: 'false'\n        },\n        description: 'Updates the list of options asynchronously',\n        name: 'async',\n        parent: {\n          fileName: 'eui/src/components/combo_box/combo_box.tsx',\n          name: '_EuiComboBoxProps'\n        },\n        required: false,\n        type: {\n          name: 'boolean'\n        }\n      },\n      className: {\n        defaultValue: null,\n        description: '',\n        name: 'className',\n        parent: {\n          fileName: 'eui/src/components/combo_box/combo_box.tsx',\n          name: '_EuiComboBoxProps'\n        },\n        required: false,\n        type: {\n          name: 'string'\n        }\n      },\n      compressed: {\n        defaultValue: {\n          value: 'false'\n        },\n        description: 'When `true` creates a shorter height input',\n        name: 'compressed',\n        parent: {\n          fileName: 'eui/src/components/combo_box/combo_box.tsx',\n          name: '_EuiComboBoxProps'\n        },\n        required: false,\n        type: {\n          name: 'boolean'\n        }\n      },\n      fullWidth: {\n        defaultValue: {\n          value: 'false'\n        },\n        description: 'When `true` expands to the entire width available',\n        name: 'fullWidth',\n        parent: {\n          fileName: 'eui/src/components/combo_box/combo_box.tsx',\n          name: '_EuiComboBoxProps'\n        },\n        required: false,\n        type: {\n          name: 'boolean'\n        }\n      },\n      id: {\n        defaultValue: null,\n        description: '',\n        name: 'id',\n        parent: {\n          fileName: 'eui/src/components/combo_box/combo_box.tsx',\n          name: '_EuiComboBoxProps'\n        },\n        required: false,\n        type: {\n          name: 'string'\n        }\n      },\n      inputRef: {\n        defaultValue: null,\n        description: '',\n        name: 'inputRef',\n        parent: {\n          fileName: 'eui/src/components/combo_box/combo_box.tsx',\n          name: '_EuiComboBoxProps'\n        },\n        required: false,\n        type: {\n          name: '(instance: HTMLInputElement) => void'\n        }\n      },\n      isClearable: {\n        defaultValue: {\n          value: 'true'\n        },\n        description: 'Shows a button that quickly clears any input',\n        name: 'isClearable',\n        parent: {\n          fileName: 'eui/src/components/combo_box/combo_box.tsx',\n          name: '_EuiComboBoxProps'\n        },\n        required: false,\n        type: {\n          name: 'boolean'\n        }\n      },\n      isDisabled: {\n        defaultValue: null,\n        description: 'Disables the input',\n        name: 'isDisabled',\n        parent: {\n          fileName: 'eui/src/components/combo_box/combo_box.tsx',\n          name: '_EuiComboBoxProps'\n        },\n        required: false,\n        type: {\n          name: 'boolean'\n        }\n      },\n      isInvalid: {\n        defaultValue: null,\n        description: '',\n        name: 'isInvalid',\n        parent: {\n          fileName: 'eui/src/components/combo_box/combo_box.tsx',\n          name: '_EuiComboBoxProps'\n        },\n        required: false,\n        type: {\n          name: 'boolean'\n        }\n      },\n      isLoading: {\n        defaultValue: null,\n        description: 'Swaps the dropdown options for a loading spinner',\n        name: 'isLoading',\n        parent: {\n          fileName: 'eui/src/components/combo_box/combo_box.tsx',\n          name: '_EuiComboBoxProps'\n        },\n        required: false,\n        type: {\n          name: 'boolean'\n        }\n      },\n      noSuggestions: {\n        defaultValue: null,\n        description: \"Doesn't show the suggestions list/dropdown\",\n        name: 'noSuggestions',\n        parent: {\n          fileName: 'eui/src/components/combo_box/combo_box.tsx',\n          name: '_EuiComboBoxProps'\n        },\n        required: false,\n        type: {\n          name: 'boolean'\n        }\n      },\n      onBlur: {\n        defaultValue: null,\n        description: '',\n        name: 'onBlur',\n        parent: {\n          fileName: 'eui/src/components/combo_box/combo_box.tsx',\n          name: '_EuiComboBoxProps'\n        },\n        required: false,\n        type: {\n          name: '(event: FocusEvent<HTMLDivElement>) => void'\n        }\n      },\n      onChange: {\n        defaultValue: null,\n        description: 'Called every time the query in the combo box is parsed',\n        name: 'onChange',\n        parent: {\n          fileName: 'eui/src/components/combo_box/combo_box.tsx',\n          name: '_EuiComboBoxProps'\n        },\n        required: false,\n        type: {\n          name: '(options: EuiComboBoxOptionOption<T>[]) => void'\n        }\n      },\n      onFocus: {\n        defaultValue: null,\n        description: '',\n        name: 'onFocus',\n        parent: {\n          fileName: 'eui/src/components/combo_box/combo_box.tsx',\n          name: '_EuiComboBoxProps'\n        },\n        required: false,\n        type: {\n          name: '(event: FocusEvent<HTMLDivElement>) => void'\n        }\n      },\n      onKeyDown: {\n        defaultValue: null,\n        description: '',\n        name: 'onKeyDown',\n        parent: {\n          fileName: 'eui/src/components/combo_box/combo_box.tsx',\n          name: '_EuiComboBoxProps'\n        },\n        required: false,\n        type: {\n          name: '(event: KeyboardEvent<HTMLDivElement>) => void'\n        }\n      },\n      onSearchChange: {\n        defaultValue: null,\n        description: 'Called every time the text query in the search box is parsed',\n        name: 'onSearchChange',\n        parent: {\n          fileName: 'eui/src/components/combo_box/combo_box.tsx',\n          name: '_EuiComboBoxProps'\n        },\n        required: false,\n        type: {\n          name: '(searchValue: string, hasMatchingOptions?: boolean) => void'\n        }\n      },\n      placeholder: {\n        defaultValue: null,\n        description: 'Sets the placeholder of the input',\n        name: 'placeholder',\n        parent: {\n          fileName: 'eui/src/components/combo_box/combo_box.tsx',\n          name: '_EuiComboBoxProps'\n        },\n        required: false,\n        type: {\n          name: 'string'\n        }\n      },\n      rowHeight: {\n        defaultValue: null,\n        description: 'Every option must be the same height and must be explicitly set if using a custom render',\n        name: 'rowHeight',\n        parent: {\n          fileName: 'eui/src/components/combo_box/combo_box.tsx',\n          name: '_EuiComboBoxProps'\n        },\n        required: false,\n        type: {\n          name: 'number'\n        }\n      },\n      singleSelection: {\n        defaultValue: {\n          value: 'false'\n        },\n        description: 'When `true` only allows the user to select a single option. Set to `{ asPlainText: true }` to not render input selection as pills',\n        name: 'singleSelection',\n        parent: {\n          fileName: 'eui/src/components/combo_box/combo_box.tsx',\n          name: '_EuiComboBoxProps'\n        },\n        required: false,\n        type: {\n          name: 'boolean | EuiComboBoxSingleSelectionShape'\n        }\n      },\n      sortMatchesBy: {\n        defaultValue: {\n          value: \"'none' as const\"\n        },\n        description: 'Display matching options by:\\n' + '`startsWith`: moves items that start with search value to top of the list;\\n' + \"`none`: don't change the sort order of initial object\",\n        name: 'sortMatchesBy',\n        parent: {\n          fileName: 'eui/src/components/combo_box/combo_box.tsx',\n          name: '_EuiComboBoxProps'\n        },\n        required: false,\n        type: {\n          name: 'enum',\n          raw: '\"none\" | \"startsWith\"',\n          value: [{\n            value: '\"none\"'\n          }, {\n            value: '\"startsWith\"'\n          }]\n        }\n      },\n      prepend: {\n        defaultValue: {\n          value: 'undefined'\n        },\n        description: \"Creates an input group with element(s) coming before input. It won't show if `singleSelection` is set to `false`.\\n\" + '`string` | `ReactElement` or an array of these',\n        name: 'prepend',\n        parent: {\n          fileName: 'eui/src/components/combo_box/combo_box.tsx',\n          name: '_EuiComboBoxProps'\n        },\n        required: false,\n        type: {\n          name: 'PrependAppendType'\n        }\n      },\n      append: {\n        defaultValue: {\n          value: 'undefined'\n        },\n        description: \"Creates an input group with element(s) coming after input. It won't show if `singleSelection` is set to `false`.\\n\" + '`string` | `ReactElement` or an array of these',\n        name: 'append',\n        parent: {\n          fileName: 'eui/src/components/combo_box/combo_box.tsx',\n          name: '_EuiComboBoxProps'\n        },\n        required: false,\n        type: {\n          name: 'PrependAppendType'\n        }\n      },\n      delimiter: {\n        defaultValue: null,\n        description: 'A special character to use as a value separator. Typically a comma `,`',\n        name: 'delimiter',\n        parent: {\n          fileName: 'eui/src/components/combo_box/combo_box.tsx',\n          name: '_EuiComboBoxProps'\n        },\n        required: false,\n        type: {\n          name: 'string'\n        }\n      },\n      autoFocus: {\n        defaultValue: null,\n        description: 'Specifies that the input should have focus when the component loads',\n        name: 'autoFocus',\n        parent: {\n          fileName: 'eui/src/components/combo_box/combo_box.tsx',\n          name: '_EuiComboBoxProps'\n        },\n        required: false,\n        type: {\n          name: 'boolean'\n        }\n      },\n      'aria-label': {\n        defaultValue: null,\n        description: '',\n        name: 'aria-label',\n        parent: {\n          fileName: 'eui/src/components/common.ts',\n          name: 'CommonProps'\n        },\n        required: false,\n        type: {\n          name: 'string'\n        }\n      },\n      options: {\n        defaultValue: {\n          value: '[]'\n        },\n        description: 'Array of EuiComboBoxOptionOption objects. See #EuiComboBoxOptionOption',\n        name: 'options',\n        parent: undefined,\n        required: false,\n        type: {\n          name: 'EuiComboBoxOptionOption<T>[]'\n        }\n      },\n      renderOption: {\n        defaultValue: null,\n        description: '',\n        name: 'renderOption',\n        parent: undefined,\n        required: false,\n        type: {\n          name: '(option: EuiComboBoxOptionOption<T>, searchValue: string, OPTION_CONTENT_CLASSNAME: string) => ReactNode'\n        }\n      },\n      customOptionText: {\n        defaultValue: null,\n        description: 'Creates a custom text option. You can use `{searchValue}` inside your string to better customize your text.\\n' + \"It won't show if there's no onCreateOption.\",\n        name: 'customOptionText',\n        parent: undefined,\n        required: false,\n        type: {\n          name: 'string'\n        }\n      },\n      onCreateOption: {\n        defaultValue: null,\n        description: '',\n        name: 'onCreateOption',\n        parent: undefined,\n        required: false,\n        type: {\n          name: '(searchValue: string, options: EuiComboBoxOptionOption<T>[]) => boolean | void'\n        }\n      },\n      selectedOptions: {\n        defaultValue: {\n          value: '[]'\n        },\n        description: '',\n        name: 'selectedOptions',\n        parent: undefined,\n        required: false,\n        type: {\n          name: 'EuiComboBoxOptionOption<T>[]'\n        }\n      }\n    },\n    extendedInterfaces: ['_EuiComboBoxProps', 'HTMLAttributes', 'AriaAttributes', 'DOMAttributes']\n  };\n} catch (e) {}"]}]}