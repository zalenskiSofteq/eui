{"remainingRequest":"D:\\work\\eui\\node_modules\\babel-loader\\lib\\index.js??ref--4-1!D:\\work\\eui\\src\\components\\search_bar\\query\\execute_ast.ts","dependencies":[{"path":"D:\\work\\eui\\src\\components\\search_bar\\query\\execute_ast.ts","mtime":1649070093753},{"path":"D:\\work\\eui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1636976621750},{"path":"D:\\work\\eui\\node_modules\\babel-loader\\lib\\index.js","mtime":1649070120649}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZXZlcnkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maWx0ZXIiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5yZWR1Y2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zb21lIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmtleXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5tYXRjaCI7Cgp2YXIgX25hbWVUb09wZXJhdG9yTWFwOwoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgeyBpZiAoa2V5IGluIG9iaikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOyB9IGVsc2UgeyBvYmpba2V5XSA9IHZhbHVlOyB9IHJldHVybiBvYmo7IH0KCi8qCiAqIExpY2Vuc2VkIHRvIEVsYXN0aWNzZWFyY2ggQi5WLiB1bmRlciBvbmUgb3IgbW9yZSBjb250cmlidXRvcgogKiBsaWNlbnNlIGFncmVlbWVudHMuIFNlZSB0aGUgTk9USUNFIGZpbGUgZGlzdHJpYnV0ZWQgd2l0aAogKiB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24gcmVnYXJkaW5nIGNvcHlyaWdodAogKiBvd25lcnNoaXAuIEVsYXN0aWNzZWFyY2ggQi5WLiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyCiAqIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOyB5b3UgbWF5CiAqIG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwppbXBvcnQgeyBnZXQgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy9vYmplY3RzJzsKaW1wb3J0IHsgaXNTdHJpbmcsIGlzQXJyYXkgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy9wcmVkaWNhdGUnOwppbXBvcnQgeyBlcSwgZXhhY3QsIGd0LCBndGUsIGx0LCBsdGUgfSBmcm9tICcuL29wZXJhdG9ycyc7CmltcG9ydCB7IEFTVCB9IGZyb20gJy4vYXN0JzsKdmFyIEVYUExBSU5fRklFTEQgPSAnX19leHBsYWluJzsKdmFyIG5hbWVUb09wZXJhdG9yTWFwID0gKF9uYW1lVG9PcGVyYXRvck1hcCA9IHt9LCBfZGVmaW5lUHJvcGVydHkoX25hbWVUb09wZXJhdG9yTWFwLCBBU1QuT3BlcmF0b3IuRVEsIGVxKSwgX2RlZmluZVByb3BlcnR5KF9uYW1lVG9PcGVyYXRvck1hcCwgQVNULk9wZXJhdG9yLkVYQUNULCBleGFjdCksIF9kZWZpbmVQcm9wZXJ0eShfbmFtZVRvT3BlcmF0b3JNYXAsIEFTVC5PcGVyYXRvci5HVCwgZ3QpLCBfZGVmaW5lUHJvcGVydHkoX25hbWVUb09wZXJhdG9yTWFwLCBBU1QuT3BlcmF0b3IuR1RFLCBndGUpLCBfZGVmaW5lUHJvcGVydHkoX25hbWVUb09wZXJhdG9yTWFwLCBBU1QuT3BlcmF0b3IuTFQsIGx0KSwgX2RlZmluZVByb3BlcnR5KF9uYW1lVG9PcGVyYXRvck1hcCwgQVNULk9wZXJhdG9yLkxURSwgbHRlKSwgX25hbWVUb09wZXJhdG9yTWFwKTsKCnZhciBkZWZhdWx0SXNDbGF1c2VNYXRjaGVyID0gZnVuY3Rpb24gZGVmYXVsdElzQ2xhdXNlTWF0Y2hlcihpdGVtLCBjbGF1c2UsIGV4cGxhaW4pIHsKICB2YXIgdHlwZSA9IGNsYXVzZS50eXBlLAogICAgICBmbGFnID0gY2xhdXNlLmZsYWcsCiAgICAgIG1hdGNoID0gY2xhdXNlLm1hdGNoOwogIHZhciB2YWx1ZSA9IGdldChpdGVtLCBjbGF1c2UuZmxhZyk7CiAgdmFyIG11c3QgPSBBU1QuTWF0Y2guaXNNdXN0Q2xhdXNlKGNsYXVzZSk7CiAgdmFyIGhpdCA9ICEhdmFsdWUgPT09IG11c3Q7CgogIGlmIChleHBsYWluICYmIGhpdCkgewogICAgZXhwbGFpbi5wdXNoKHsKICAgICAgaGl0OiBoaXQsCiAgICAgIHR5cGU6IHR5cGUsCiAgICAgIGZsYWc6IGZsYWcsCiAgICAgIG1hdGNoOiBtYXRjaAogICAgfSk7CiAgfQoKICByZXR1cm4gaGl0Owp9OwoKdmFyIGZpZWxkQ2xhdXNlTWF0Y2hlciA9IGZ1bmN0aW9uIGZpZWxkQ2xhdXNlTWF0Y2hlcihpdGVtLCBmaWVsZCkgewogIHZhciBjbGF1c2VzID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiBbXTsKICB2YXIgZXhwbGFpbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAzID8gYXJndW1lbnRzWzNdIDogdW5kZWZpbmVkOwogIHJldHVybiBjbGF1c2VzLmV2ZXJ5KGZ1bmN0aW9uIChjbGF1c2UpIHsKICAgIHZhciB0eXBlID0gY2xhdXNlLnR5cGUsCiAgICAgICAgdmFsdWUgPSBjbGF1c2UudmFsdWUsCiAgICAgICAgbWF0Y2ggPSBjbGF1c2UubWF0Y2g7CiAgICB2YXIgb3BlcmF0b3IgPSBuYW1lVG9PcGVyYXRvck1hcFtjbGF1c2Uub3BlcmF0b3JdOwoKICAgIGlmICghb3BlcmF0b3IpIHsKICAgICAgLy8gdW5rbm93biBtYXRjaGVyCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGlmICghQVNULk1hdGNoLmlzTXVzdChtYXRjaCkpIHsKICAgICAgb3BlcmF0b3IgPSBmdW5jdGlvbiBvcGVyYXRvcih2YWx1ZSwgdG9rZW4pIHsKICAgICAgICByZXR1cm4gIW5hbWVUb09wZXJhdG9yTWFwW2NsYXVzZS5vcGVyYXRvcl0odmFsdWUsIHRva2VuKTsKICAgICAgfTsKICAgIH0KCiAgICB2YXIgaXRlbVZhbHVlID0gZ2V0KGl0ZW0sIGZpZWxkKTsKICAgIHZhciBoaXQgPSBpc0FycmF5KHZhbHVlKSA/IHZhbHVlLnNvbWUoZnVuY3Rpb24gKHYpIHsKICAgICAgcmV0dXJuIG9wZXJhdG9yKGl0ZW1WYWx1ZSwgdik7CiAgICB9KSA6IG9wZXJhdG9yKGl0ZW1WYWx1ZSwgdmFsdWUpOwoKICAgIGlmIChleHBsYWluICYmIGhpdCkgewogICAgICBleHBsYWluLnB1c2goewogICAgICAgIGhpdDogaGl0LAogICAgICAgIHR5cGU6IHR5cGUsCiAgICAgICAgZmllbGQ6IGZpZWxkLAogICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICBtYXRjaDogbWF0Y2gsCiAgICAgICAgb3BlcmF0b3I6IG9wZXJhdG9yCiAgICAgIH0pOwogICAgfQoKICAgIHJldHVybiBoaXQ7CiAgfSk7Cn07IC8vIFlvdSBtaWdodCB0aGluayB0aGF0IHdlIGNvdWxkIHNwZWNpZnkgYGl0ZW06IFRgIGhlcmUgYW5kIGRvIHNvbWV0aGluZwovLyB3aXRoIGBrZXlvZmAsIGJ1dCB0aGF0IHdvdWxkbid0IHdvcmsgd2l0aCBgbmVzdGVkLmZpZWxkLm5hbWVgCgoKdmFyIGV4dHJhY3RTdHJpbmdGaWVsZHNGcm9tSXRlbSA9IGZ1bmN0aW9uIGV4dHJhY3RTdHJpbmdGaWVsZHNGcm9tSXRlbShpdGVtKSB7CiAgcmV0dXJuIE9iamVjdC5rZXlzKGl0ZW0pLnJlZHVjZShmdW5jdGlvbiAoZmllbGRzLCBrZXkpIHsKICAgIGlmIChpc1N0cmluZyhpdGVtW2tleV0pKSB7CiAgICAgIGZpZWxkcy5wdXNoKGtleSk7CiAgICB9CgogICAgcmV0dXJuIGZpZWxkczsKICB9LCBbXSk7Cn07Cgp2YXIgdGVybUNsYXVzZU1hdGNoZXIgPSBmdW5jdGlvbiB0ZXJtQ2xhdXNlTWF0Y2hlcihpdGVtLCBmaWVsZHMpIHsKICB2YXIgY2xhdXNlcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogW107CiAgdmFyIGV4cGxhaW4gPSBhcmd1bWVudHMubGVuZ3RoID4gMyA/IGFyZ3VtZW50c1szXSA6IHVuZGVmaW5lZDsKICB2YXIgc2VhcmNoYWJsZUZpZWxkcyA9IGZpZWxkcyB8fCBleHRyYWN0U3RyaW5nRmllbGRzRnJvbUl0ZW0oaXRlbSk7CiAgcmV0dXJuIGNsYXVzZXMuZXZlcnkoZnVuY3Rpb24gKGNsYXVzZSkgewogICAgdmFyIHR5cGUgPSBjbGF1c2UudHlwZSwKICAgICAgICB2YWx1ZSA9IGNsYXVzZS52YWx1ZSwKICAgICAgICBtYXRjaCA9IGNsYXVzZS5tYXRjaDsKICAgIHZhciBpc011c3RDbGF1c2UgPSBBU1QuTWF0Y2guaXNNdXN0Q2xhdXNlKGNsYXVzZSk7CiAgICB2YXIgZXF1YWxzID0gbmFtZVRvT3BlcmF0b3JNYXBbQVNULk9wZXJhdG9yLkVRXTsKICAgIHZhciBjb250YWluc01hdGNoZXMgPSBzZWFyY2hhYmxlRmllbGRzLnNvbWUoZnVuY3Rpb24gKGZpZWxkKSB7CiAgICAgIHZhciBpdGVtVmFsdWUgPSBnZXQoaXRlbSwgZmllbGQpOwogICAgICB2YXIgaXNNYXRjaCA9IGVxdWFscyhpdGVtVmFsdWUsIHZhbHVlKTsKCiAgICAgIGlmIChleHBsYWluKSB7CiAgICAgICAgLy8gSWYgdGVzdGluZyBmb3IgdGhlIHByZXNlbmNlIG9mIGEgdGVybSwgdGhlbiB3ZSByZWNvcmQgYSBtYXRjaCBhcyBhIG1hdGNoLgogICAgICAgIC8vIElmIHRlc3RpbmcgZm9yIHRoZSBhYnNlbmNlIG9mIGEgdGVybSwgdGhlbiB3ZSBpbnZlcnQgdGhpcyBsb2dpYzogd2UgcmVjb3JkIGEKICAgICAgICAvLyBub24tbWF0Y2ggYXMgYSBtYXRjaC4KICAgICAgICB2YXIgaGl0ID0gaXNNdXN0Q2xhdXNlICYmIGlzTWF0Y2ggfHwgIWlzTXVzdENsYXVzZSAmJiAhaXNNYXRjaDsKCiAgICAgICAgaWYgKGhpdCkgewogICAgICAgICAgZXhwbGFpbi5wdXNoKHsKICAgICAgICAgICAgaGl0OiBoaXQsCiAgICAgICAgICAgIHR5cGU6IHR5cGUsCiAgICAgICAgICAgIGZpZWxkOiBmaWVsZCwKICAgICAgICAgICAgbWF0Y2g6IG1hdGNoLAogICAgICAgICAgICB2YWx1ZTogdmFsdWUKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIGlzTWF0Y2g7CiAgICB9KTsKCiAgICBpZiAoaXNNdXN0Q2xhdXNlKSB7CiAgICAgIC8vIElmIHdlJ3JlIHRlc3RpbmcgZm9yIHRoZSBwcmVzZW5jZSBvZiBhIHRlcm0sIHRoZW4gd2Ugb25seSBuZWVkIDEgZmllbGQgdG8gbWF0Y2guCiAgICAgIHJldHVybiBjb250YWluc01hdGNoZXM7CiAgICB9IC8vIElmIHdlJ3JlIHRlc3RpbmcgZm9yIHRoZSBhYnNlbmNlIG9mIGEgdGVybSwgd2UgY2FuJ3QgaGF2ZSBhbnkgbWF0Y2hpbmcgZmllbGRzIGF0IGFsbC4KCgogICAgcmV0dXJuICFjb250YWluc01hdGNoZXM7CiAgfSk7Cn07CgpleHBvcnQgdmFyIGNyZWF0ZUZpbHRlciA9IGZ1bmN0aW9uIGNyZWF0ZUZpbHRlcihhc3QsIGRlZmF1bHRGaWVsZHMpIHsKICB2YXIgaXNDbGF1c2VNYXRjaGVyID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiBkZWZhdWx0SXNDbGF1c2VNYXRjaGVyOwogIHZhciBleHBsYWluID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgJiYgYXJndW1lbnRzWzNdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbM10gOiBmYWxzZTsKICAvLyBSZXR1cm4gaXRlbXMgd2hpY2ggcGFzcyBBTEwgY29uZGl0aW9uczogbWF0Y2hlcyB0aGUgdGVybXMgZW50ZXJlZCwgdGhlIHNwZWNpZmllZCBmaWVsZCB2YWx1ZXMsCiAgLy8gYW5kIHRoZSBzcGVjaWZpZWQgImlzIiBjbGF1c2VzLgogIHJldHVybiBmdW5jdGlvbiAoaXRlbSkgewogICAgdmFyIGV4cGxhaW5MaW5lcyA9IGV4cGxhaW4gPyBbXSA6IHVuZGVmaW5lZDsKCiAgICBpZiAoZXhwbGFpbkxpbmVzKSB7CiAgICAgIC8vIEB0cy1pZ25vcmUgdGVjaG5pY2FsbHksIHdlIGNvdWxkIHJlcXVpcmUgVCB0byBleHRlbmQgYHsgX19leHBsYWluPzogRXhwbGFpbltdIH1gIGJ1dCB0aGF0IHNlZW1zCiAgICAgIC8vIGxpa2UgYSByaWRpY3Vsb3VzIHJlcXVpcmVtZW50IG9uIHRoZSBjYWxsZXIuCiAgICAgIGl0ZW1bRVhQTEFJTl9GSUVMRF0gPSBleHBsYWluTGluZXM7CiAgICB9CgogICAgdmFyIHRlcm1DbGF1c2VzID0gYXN0LmdldFRlcm1DbGF1c2VzKCk7CiAgICB2YXIgZmllbGRzID0gYXN0LmdldEZpZWxkTmFtZXMoKTsKICAgIHZhciBpc0NsYXVzZXMgPSBhc3QuZ2V0SXNDbGF1c2VzKCk7CiAgICB2YXIgZ3JvdXBDbGF1c2VzID0gYXN0LmdldEdyb3VwQ2xhdXNlcygpOwogICAgdmFyIGlzVGVybU1hdGNoID0gdGVybUNsYXVzZU1hdGNoZXIoaXRlbSwgZGVmYXVsdEZpZWxkcywgdGVybUNsYXVzZXMsIGV4cGxhaW5MaW5lcyk7CgogICAgaWYgKCFpc1Rlcm1NYXRjaCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgdmFyIGlzRmllbGRzTWF0Y2ggPSBmaWVsZHMuZXZlcnkoZnVuY3Rpb24gKGZpZWxkKSB7CiAgICAgIHJldHVybiBmaWVsZENsYXVzZU1hdGNoZXIoaXRlbSwgZmllbGQsIGFzdC5nZXRGaWVsZENsYXVzZXMoZmllbGQpLCBleHBsYWluTGluZXMpOwogICAgfSk7CgogICAgaWYgKCFpc0ZpZWxkc01hdGNoKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICB2YXIgaXNJc01hdGNoID0gaXNDbGF1c2VzLmV2ZXJ5KGZ1bmN0aW9uIChjbGF1c2UpIHsKICAgICAgcmV0dXJuIGlzQ2xhdXNlTWF0Y2hlcihpdGVtLCBjbGF1c2UsIGV4cGxhaW5MaW5lcyk7CiAgICB9KTsKCiAgICBpZiAoIWlzSXNNYXRjaCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgdmFyIGlzR3JvdXBNYXRjaCA9IGdyb3VwQ2xhdXNlcy5ldmVyeShmdW5jdGlvbiAoY2xhdXNlKSB7CiAgICAgIHZhciBtYXRjaGVzR3JvdXAgPSBjbGF1c2UudmFsdWUuc29tZShmdW5jdGlvbiAoY2xhdXNlKSB7CiAgICAgICAgaWYgKEFTVC5UZXJtLmlzSW5zdGFuY2UoY2xhdXNlKSkgewogICAgICAgICAgcmV0dXJuIHRlcm1DbGF1c2VNYXRjaGVyKGl0ZW0sIGRlZmF1bHRGaWVsZHMsIFtjbGF1c2VdLCBleHBsYWluTGluZXMpOwogICAgICAgIH0KCiAgICAgICAgaWYgKEFTVC5GaWVsZC5pc0luc3RhbmNlKGNsYXVzZSkpIHsKICAgICAgICAgIHJldHVybiBmaWVsZENsYXVzZU1hdGNoZXIoaXRlbSwgY2xhdXNlLmZpZWxkLCBbY2xhdXNlXSwgZXhwbGFpbkxpbmVzKTsKICAgICAgICB9CgogICAgICAgIGlmIChBU1QuSXMuaXNJbnN0YW5jZShjbGF1c2UpKSB7CiAgICAgICAgICByZXR1cm4gaXNDbGF1c2VNYXRjaGVyKGl0ZW0sIGNsYXVzZSwgZXhwbGFpbkxpbmVzKTsKICAgICAgICB9CgogICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5rbm93biBxdWVyeSBjbGF1c2UgdHlwZSBpbiBncm91cCwgWyIuY29uY2F0KGNsYXVzZS50eXBlLCAiXSIpKTsKICAgICAgfSk7CiAgICAgIHJldHVybiBBU1QuTWF0Y2guaXNNdXN0Q2xhdXNlKGNsYXVzZSkgPyBtYXRjaGVzR3JvdXAgOiAhbWF0Y2hlc0dyb3VwOwogICAgfSk7CiAgICByZXR1cm4gaXNHcm91cE1hdGNoOwogIH07Cn07CmV4cG9ydCBmdW5jdGlvbiBleGVjdXRlQXN0KGFzdCwgaXRlbXMpIHsKICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDoge307CiAgdmFyIGlzQ2xhdXNlTWF0Y2hlciA9IG9wdGlvbnMuaXNDbGF1c2VNYXRjaGVyLAogICAgICBkZWZhdWx0RmllbGRzID0gb3B0aW9ucy5kZWZhdWx0RmllbGRzLAogICAgICBleHBsYWluID0gb3B0aW9ucy5leHBsYWluOwogIHZhciBmaWx0ZXIgPSBjcmVhdGVGaWx0ZXIoYXN0LCBkZWZhdWx0RmllbGRzLCBpc0NsYXVzZU1hdGNoZXIsIGV4cGxhaW4pOwogIHJldHVybiBpdGVtcy5maWx0ZXIoZmlsdGVyKTsKfQ=="},{"version":3,"sources":["D:/work/eui/src/components/search_bar/query/execute_ast.ts"],"names":["get","isString","isArray","eq","exact","gt","gte","lt","lte","AST","EXPLAIN_FIELD","nameToOperatorMap","Operator","EQ","EXACT","GT","GTE","LT","LTE","defaultIsClauseMatcher","item","clause","explain","type","flag","match","value","must","Match","isMustClause","hit","push","fieldClauseMatcher","field","clauses","every","operator","isMust","token","itemValue","some","v","extractStringFieldsFromItem","Object","keys","reduce","fields","key","termClauseMatcher","searchableFields","equals","containsMatches","isMatch","createFilter","ast","defaultFields","isClauseMatcher","explainLines","undefined","termClauses","getTermClauses","getFieldNames","isClauses","getIsClauses","groupClauses","getGroupClauses","isTermMatch","isFieldsMatch","getFieldClauses","isIsMatch","isGroupMatch","matchesGroup","Term","isInstance","Field","Is","Error","executeAst","items","options","filter"],"mappings":"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","sourcesContent":["/*\n * Licensed to Elasticsearch B.V. under one or more contributor\n * license agreements. See the NOTICE file distributed with\n * this work for additional information regarding copyright\n * ownership. Elasticsearch B.V. licenses this file to you under\n * the Apache License, Version 2.0 (the \"License\"); you may\n * not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { get } from '../../../services/objects';\nimport { isString, isArray } from '../../../services/predicate';\nimport {\n  ClauseValue,\n  eq,\n  exact,\n  FieldValue,\n  gt,\n  gte,\n  lt,\n  lte,\n} from './operators';\nimport {\n  _AST,\n  AST,\n  Clause,\n  FieldClause,\n  IsClause,\n  MatchType,\n  TermClause,\n  Value,\n} from './ast';\n\nconst EXPLAIN_FIELD = '__explain';\n\nconst nameToOperatorMap = {\n  [AST.Operator.EQ]: eq,\n  [AST.Operator.EXACT]: exact,\n  [AST.Operator.GT]: gt,\n  [AST.Operator.GTE]: gte,\n  [AST.Operator.LT]: lt,\n  [AST.Operator.LTE]: lte,\n};\n\ninterface Explain {\n  hit: boolean;\n  type: Clause['type'];\n  field?: string;\n  value?: Value | Value[];\n  flag?: string;\n  match?: MatchType;\n  operator?: any; // It's not really worth specifying this at the moment\n}\n\nconst defaultIsClauseMatcher = <T>(\n  item: T,\n  clause: IsClause,\n  explain?: Explain[]\n) => {\n  const { type, flag, match } = clause;\n  const value = get(item, clause.flag);\n  const must = AST.Match.isMustClause(clause);\n  const hit = !!value === must;\n  if (explain && hit) {\n    explain.push({ hit, type, flag, match });\n  }\n  return hit;\n};\n\nconst fieldClauseMatcher = <T>(\n  item: T,\n  field: string,\n  clauses: FieldClause[] = [],\n  explain?: Explain[]\n) => {\n  return clauses.every((clause) => {\n    const { type, value, match } = clause;\n    let operator = nameToOperatorMap[clause.operator];\n    if (!operator) {\n      // unknown matcher\n      return true;\n    }\n    if (!AST.Match.isMust(match)) {\n      operator = (value: FieldValue, token: ClauseValue) =>\n        !nameToOperatorMap[clause.operator](value, token);\n    }\n    const itemValue = get(item, field);\n    const hit = isArray(value)\n      ? value.some((v) => operator(itemValue, v))\n      : operator(itemValue, value);\n    if (explain && hit) {\n      explain.push({ hit, type, field, value, match, operator });\n    }\n    return hit;\n  });\n};\n\n// You might think that we could specify `item: T` here and do something\n// with `keyof`, but that wouldn't work with `nested.field.name`\nconst extractStringFieldsFromItem = (item: any) => {\n  return Object.keys(item).reduce((fields, key) => {\n    if (isString(item[key])) {\n      fields.push(key);\n    }\n    return fields;\n  }, [] as string[]);\n};\n\nconst termClauseMatcher = <T>(\n  item: T,\n  fields: string[] | undefined,\n  clauses: TermClause[] = [],\n  explain?: Explain[]\n) => {\n  const searchableFields = fields || extractStringFieldsFromItem(item);\n  return clauses.every((clause) => {\n    const { type, value, match } = clause;\n    const isMustClause = AST.Match.isMustClause(clause);\n    const equals = nameToOperatorMap[AST.Operator.EQ];\n\n    const containsMatches = searchableFields.some((field) => {\n      const itemValue = get(item, field);\n      const isMatch = equals(itemValue, value);\n\n      if (explain) {\n        // If testing for the presence of a term, then we record a match as a match.\n        // If testing for the absence of a term, then we invert this logic: we record a\n        // non-match as a match.\n        const hit = (isMustClause && isMatch) || (!isMustClause && !isMatch);\n        if (hit) {\n          explain.push({ hit, type, field, match, value });\n        }\n      }\n\n      return isMatch;\n    });\n\n    if (isMustClause) {\n      // If we're testing for the presence of a term, then we only need 1 field to match.\n      return containsMatches;\n    }\n\n    // If we're testing for the absence of a term, we can't have any matching fields at all.\n    return !containsMatches;\n  });\n};\n\nexport const createFilter = <T extends {}>(\n  ast: _AST,\n  defaultFields: string[] | undefined,\n  isClauseMatcher = defaultIsClauseMatcher,\n  explain = false\n) => {\n  // Return items which pass ALL conditions: matches the terms entered, the specified field values,\n  // and the specified \"is\" clauses.\n  return (item: T) => {\n    const explainLines = explain ? ([] as Explain[]) : undefined;\n\n    if (explainLines) {\n      // @ts-ignore technically, we could require T to extend `{ __explain?: Explain[] }` but that seems\n      // like a ridiculous requirement on the caller.\n      item[EXPLAIN_FIELD] = explainLines;\n    }\n\n    const termClauses = ast.getTermClauses();\n    const fields = ast.getFieldNames();\n    const isClauses = ast.getIsClauses();\n    const groupClauses = ast.getGroupClauses();\n\n    const isTermMatch = termClauseMatcher(\n      item,\n      defaultFields,\n      termClauses,\n      explainLines\n    );\n    if (!isTermMatch) {\n      return false;\n    }\n\n    const isFieldsMatch = fields.every((field) =>\n      fieldClauseMatcher(item, field, ast.getFieldClauses(field), explainLines)\n    );\n    if (!isFieldsMatch) {\n      return false;\n    }\n\n    const isIsMatch = isClauses.every((clause) =>\n      isClauseMatcher(item, clause, explainLines)\n    );\n    if (!isIsMatch) {\n      return false;\n    }\n\n    const isGroupMatch = groupClauses.every((clause) => {\n      const matchesGroup = clause.value.some((clause) => {\n        if (AST.Term.isInstance(clause)) {\n          return termClauseMatcher(item, defaultFields, [clause], explainLines);\n        }\n        if (AST.Field.isInstance(clause)) {\n          return fieldClauseMatcher(item, clause.field, [clause], explainLines);\n        }\n        if (AST.Is.isInstance(clause)) {\n          return isClauseMatcher(item, clause, explainLines);\n        }\n        throw new Error(`Unknown query clause type in group, [${clause.type}]`);\n      });\n      return AST.Match.isMustClause(clause) ? matchesGroup : !matchesGroup;\n    });\n\n    return isGroupMatch;\n  };\n};\n\ninterface Options {\n  isClauseMatcher?: typeof defaultIsClauseMatcher;\n  defaultFields?: string[];\n  explain?: boolean;\n}\n\nexport function executeAst<T>(\n  ast: _AST,\n  items: T[],\n  options: Options = {}\n): T[] {\n  const { isClauseMatcher, defaultFields, explain } = options;\n  const filter = createFilter(ast, defaultFields, isClauseMatcher, explain);\n  return items.filter(filter);\n}\n"]}]}